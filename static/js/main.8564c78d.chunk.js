(this.webpackJsonpexuo=this.webpackJsonpexuo||[]).push([[0],{203:function(e,t,n){e.exports=n(312)},312:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),i=n(13),r=n.n(i),c=function(){return Ut().graph},l=o.a.createContext(null),d=l.Provider,s=function(){var e=o.a.useContext(l);if(e)return e;throw Error("Cannot use active Node before setup")},u=n(40),p=n(191),m=n(5),g=n(366),f=function(e){return m.i.model("EdgeMap",{edgeMap:m.i.map(m.i.array(m.i.safeReference(m.i.late(e),{acceptsUndefined:!1})))}).actions((function(e){return{hasEdge:function(t,n){var a,o;return n?Boolean(null===(a=e.edgeMap.get(t))||void 0===a?void 0:a.includes(n)):Boolean(null===(o=e.edgeMap.get(t))||void 0===o?void 0:o.length)}}})).actions((function(e){return{addEdge:function(t,n){var a;return e.edgeMap.has(t)||e.edgeMap.set(t,[]),null===(a=e.edgeMap.get(t))||void 0===a||a.push(n),n},removeEdge:function(t,n){var a;null===(a=e.edgeMap.get(t))||void 0===a||a.remove(n)},reorderEdge:function(t,n,a,o){var i=e.edgeMap.get(t);if(i){var r=o;void 0===r&&(r=i.indexOf(n));var c=i[r];if(c!==n)throw Error("Invalid reorder target");i.splice(r,1),i.splice(a,0,c)}},getEdgeTag:function(t){return e.edgeMap.get(t)}}}))},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return m.i.compose.apply(m.i,Object(p.a)([m.i.model({id:m.i.identifier})].concat(e))).named("Node")},b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m.i.model("Graph",Object.fromEntries(Object.keys(e).map((function(t){var n=e[t];if(Object(m.f)(n)&&Object(m.e)(n.properties.id))return[t,m.i.map(e[t])];throw Error("Model '".concat(t,"' requires 'id' identifier"))})))).actions((function(n){return{createNode:function(){var a,o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Node",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e[i])throw Error("No model named '".concat(i,"'"));var c=e[i].create(Object(u.a)({id:null!==(a=null===(o=t.getId)||void 0===o?void 0:o.call(t))&&void 0!==a?a:Object(g.a)()},r));return n[i].put(c),c}}}))},h=v(f((function(){return h}))),E=(b({Node:h}),n(17)),y=n(27),j=n(112),N=n.n(j),O=n(23),k=n(158),w=n(159);function C(){return(C=Object(k.a)(N.a.mark((function e(t){var n,a,o,i;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new w.a("default"),a=Object.keys(Object(m.b)(t).properties),o=Object.fromEntries(a.map((function(e){return[e,"id"]}))),n.version(1).stores(o),i=function(e){e.forEach((function(e){var a=e.path.split("/").slice(1),o=Object(E.a)(a,3),i=o[0],r=o[1],c=o[2];if("add"===e.op)n.table(i).put(Object(m.d)(t[i].get(r)));else{if("replace"!==e.op&&"remove"!==e.op)throw Error("Unknown patch op '".concat(e.op,"'"));if(c){var l=t[i].get(r)[c];Object(m.g)(l)&&(l=Object(m.d)(l)),n.table(i).update(r,Object(O.a)({},c,l))}else n.table(i).delete(r)}}))},e.abrupt("return",Promise.all(a.map((function(e){return n.table(e).toArray().then((function(t){return[e,Object.fromEntries(t.map((function(e){return[e.id,e]})))]}))}))).then((function(e){Object(m.a)(t,Object.fromEntries(e));var n,a=[];Object(m.h)(t,(function(e){a.push(e),n&&clearTimeout(n),n=setTimeout((function(){i(a),a=[]}),1e3),a.length>1e3&&(i(a),a=[])}))})));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=m.i.union(m.i.null,m.i.boolean,m.i.string,m.i.number,m.i.array(m.i.late((function(){return x}))),m.i.map(m.i.late((function(){return x})))),S=v([f((function(){return m.i.union(m.i.late((function(){return S})),I)}))]).props({content:m.i.union(m.i.string,x)}).actions((function(e){return{setContent:function(t){e.content=t},initView:function(t){return e.view||e.addEdge("view",e.graphRoot.createNode("View",t)),e.view}}})).views((function(e){return{get childCount(){var t,n;return null!==(t=null===(n=e.edgeMap.get("child"))||void 0===n?void 0:n.length)&&void 0!==t?t:0},get graphRoot(){return Object(m.c)(e,T)},get view(){if(e.edgeMap.size){var t=e.edgeMap.get("view");if(t&&t.length)return t[0]}}}})),M=v(m.i.model("Config",{name:m.i.maybe(m.i.string),items:m.i.map(x)}).actions((function(e){return{set:function(t,n){e.items.set(t,n)},get:function(t){return e.items.get(t)}}}))),B=m.i.model("ViewItem",{expanded:m.i.optional(m.i.boolean,!1)}).actions((function(e){return{setExpanded:function(t){e.expanded=t}}})),I=v(m.i.model("View",{items:m.i.map(B)}).views((function(e){return{getItem:function(t){if(e.items.size)return e.items.get(t)}}})).actions((function(e){return{initItem:function(t){var n=e.getItem(t);return n||(n=B.create(),e.items.set(t,n),e.getItem(t))}}}))),T=b({Node:S,Config:M,View:I}).actions((function(e){return{setActiveMode:function(t){var n=e.activeModes;(null===n||void 0===n?void 0:n.includes(t))||(n.push(t),"select"===t&&n.remove("edit"),"edit"===t&&(n.remove("select"),e.clearSelectedNodes()))},unsetActiveMode:function(t){var n=e.activeModes;(null===n||void 0===n?void 0:n.includes(t))&&n.remove(t)},toggleActiveMode:function(t){var n=e.activeModes;n&&(n.includes(t)?(n.remove(t),"select"===t&&e.clearSelectedNodes()):(n.push(t),"select"===t&&n.remove("edit"),"edit"===t&&(n.remove("select"),e.clearSelectedNodes())))}}})).actions((function(e){function t(t,n){var a=Object(u.a)({},e.Node.get(t).toJSON()),o=a.edgeMap.parent;if(delete a.edgeMap,o){var i=o.filter((function(e){return n.includes(e)}));i.length&&(a.edgeMap={parent:i})}return a}return{selectNode:function(t,n){var a=e.selectedNodes,o=a.get(n.id);o?o.includes(t.id)||o.push(t.id):a.set(n.id,[t.id])},deselectNode:function(t,n){var a=e.selectedNodes,o=a.get(n.id);o&&(o.remove(t.id),0===o.length&&a.delete(n.id))},toggleSelectNode:function(t,n){var a=e.Config.get("system").get("selectedNodes");if(a){var o=a.get(n.id);o?o.includes(t.id)?(o.remove(t.id),0===o.length&&a.delete(n.id)):o.push(t.id):a.set(n.id,[t.id])}},clearSelectedNodes:function(){var t;null===(t=e.Config.get("system").get("selectedNodes"))||void 0===t||t.clear(),0===e.selectedNodes.size&&e.unsetActiveMode("select")},deleteSelectedNodes:function(){e.selectedNodes.forEach((function(t){return t.forEach((function(t){return e.Node.delete(t)}))})),e.clearSelectedNodes()},moveSelectedNodes:function(t){var n,a=Object(y.a)(e.selectedNodes);try{for(a.s();!(n=a.n()).done;){var o,i=Object(E.a)(n.value,2),r=i[0],c=i[1],l=e.Node.get(r),d=Object(y.a)(c);try{for(d.s();!(o=d.n()).done;){var s=o.value,u=e.Node.get(s);u&&(u.removeEdge("parent",l),l.removeEdge("child",u),u.addEdge("parent",t),t.addEdge("child",u))}}catch(p){d.e(p)}finally{d.f()}}}catch(p){a.e(p)}finally{a.f()}e.clearSelectedNodes()},copySelectedNodes:function(){},linkSelectedNodes:function(t){var n,a=Object(y.a)(e.selectedNodes.values());try{for(a.s();!(n=a.n()).done;){var o,i=n.value,r=Object(y.a)(i);try{for(r.s();!(o=r.n()).done;){var c=o.value,l=e.Node.get(c);l&&(l.addEdge("parent",t),t.addEdge("child",l))}}catch(d){r.e(d)}finally{r.f()}}}catch(d){a.e(d)}finally{a.f()}e.clearSelectedNodes()},unlinkSelectedNodes:function(){var t,n=Object(y.a)(e.selectedNodes);try{for(n.s();!(t=n.n()).done;){var a,o=Object(E.a)(t.value,2),i=o[0],r=o[1],c=e.Node.get(i),l=Object(y.a)(r);try{for(l.s();!(a=l.n()).done;){var d=a.value,s=e.Node.get(d);s&&(s.removeEdge("parent",c),c.removeEdge("child",s))}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}e.clearSelectedNodes()},removeSelectedNodes:function(){var t,n=Object(y.a)(e.selectedNodes);try{for(n.s();!(t=n.n()).done;){var a,o=Object(E.a)(t.value,2),i=o[0],r=o[1],c=e.Node.get(i),l=Object(y.a)(r);try{for(l.s();!(a=l.n()).done;){var d=a.value,s=e.Node.get(d);s&&(s.removeEdge("parent",c),c.removeEdge("child",s),0===s.edgeMap.get("parent").size&&e.deleteNode(s))}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}e.clearSelectedNodes()},exportSelectedItems:function(){var n=Object.values(e.selectedNodes.toJSON()).flatMap((function(e){return e})),a=Object.fromEntries(n.map((function(e){return[e,t(e,n)]})));return new Blob([JSON.stringify(a,null,2)],{type:"application/json"})},exportAllItems:function(){return new Blob([JSON.stringify(Object(m.d)(e),null,2)],{type:"application/json"})},importItems:function(t){t.text().then((function(e){return JSON.parse(e)})).then((function(t){return Object(m.a)(e,t)})).catch((function(e){throw Error("Import error ".concat(e))}))}}})).actions((function(e){return{afterCreate:function(){(function(e){return C.apply(this,arguments)})(e).then((function(){if(!e.rootNode){var t=e.createNode("Node",{content:"Locus"});Object(m.a)(e.Config,{system:{id:"system",items:{rootNodeId:t.id,selectedNodes:{},lastSelectedNodeId:"",activeModes:[]}}})}})).catch((function(e){console.error("Persist error",e)}))},createChild:function(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Node",o=e.createNode(a,n);return t.addEdge("child",o),o.addEdge("parent",t),o},deleteNode:function(t){e.Node.delete(t.id)}}})).views((function(e){return{get rootNode(){var t=e.Config.get("system");return e.Node.get(null===t||void 0===t?void 0:t.get("rootNodeId"))},get activeModes(){var t=e.Config.get("system");return null===t||void 0===t?void 0:t.get("activeModes")},get selectedNodes(){var t=e.Config.get("system");return null===t||void 0===t?void 0:t.get("selectedNodes")},get lastSelectedNode(){var t=e.Config.get("system");return e.Node.get(null===t||void 0===t?void 0:t.get("lastSelectedNodeId"))},get selectedNodeCount(){var t,n=0,a=Object(y.a)(e.selectedNodes);try{for(a.s();!(t=a.n()).done;){n+=Object(E.a)(t.value,2)[1].length}}catch(o){a.e(o)}finally{a.f()}return n}}})),A=n(19),R=n(316),L=n(343),D=n(371),z=n(320),F=n(349),P=n(350),W=n(351),U=n(356),K=n(20),G=n(178),J=n.n(G),V=n(177),q=n.n(V),H=n(37),X=n(369),Y=n(370),$=n(96),Q=n(100),Z=n(364),_=n(352),ee=n(344),te=Object(L.a)((function(e){return Object(D.a)({root:{},appBar:{},actions:{width:"100%",color:e.palette.text.secondary,backgroundColor:e.palette.background.default,padding:e.spacing(0,2,0,2)},children:{}})})),ne=function(e){var t=e.title,n=e.actions,a=e.className,i=e.children,r=te();return o.a.createElement(Z.a,{className:[r.root,a].join(" ")},o.a.createElement(ee.a,{elevation:0,position:"sticky",className:r.appBar},o.a.createElement(se,{title:t}),n),o.a.createElement(Z.a,{className:r.children},i))},ae=n(345),oe=n(346),ie=n(164),re=n.n(ie),ce=n(165),le=n.n(ce),de=Object(L.a)((function(e){return Object(D.a)({root:{color:e.palette.text.secondary,backgroundColor:e.palette.background.default,padding:e.spacing(0,2,0,2)},backButton:{cursor:"pointer","&[disabled]":{visibility:"hidden",pointerEvents:"none"},"&:hover":{color:e.palette.primary.main},transition:e.transitions.create(["color","background"],{duration:e.transitions.duration.shortest})},hide:{visibility:"hidden",mouseEvents:"none"},settingsButton:{},title:{flexGrow:1,textAlign:"center",overflowX:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",color:e.palette.text.primary}})})),se=function(e){var t,n=e.title,a=e.showBackButton,i=e.showSettingsButton,r=e.className,c=(e.children,de()),l=null!==(t=null===n||void 0===n?void 0:n.indexOf("\n"))&&void 0!==t?t:-1;return o.a.createElement(ae.a,{className:[c.root,r].join(" ")},o.a.createElement(oe.a,{disabled:je(),edge:"start","aria-label":"back",onClick:function(){return window.history.back()},className:[c.backButton,a?"":c.hide].join(" ")},o.a.createElement(re.a,null)),n&&o.a.createElement(Q.a,{variant:"h6",component:"h1",className:c.title},l>0?n.slice(0,n.indexOf("\n")):n),o.a.createElement(oe.a,{disabled:!0,edge:"end",component:H.a,to:Oe("/settings"),"aria-label":"settings",className:[c.settingsButton,i?"":c.hide].join(" ")},o.a.createElement(le.a,{fontSize:"small"})))};se.defaultProps={title:"Exuo",showBackButton:!0,showSettingsButton:!1};var ue=n(347),pe=n(348),me=n(367),ge=n(166),fe=n.n(ge),ve=n(113),be=n.n(ve),he=n(167),Ee=n.n(he),ye=Object(A.a)((function(){var e,t=c();return o.a.createElement(ne,null,o.a.createElement(R.a,{subheader:o.a.createElement(ue.a,null,"Global")},o.a.createElement(z.a,null,o.a.createElement(pe.a,null,o.a.createElement(be.a,null)),o.a.createElement(F.a,{id:"switch-list-label-dividers",primary:"Dividers"}),o.a.createElement(P.a,null,o.a.createElement(me.a,{disabled:!0,edge:"end",inputProps:{"aria-labelledby":"switch-list-label-list-dividers"}})))),o.a.createElement(R.a,{subheader:o.a.createElement(ue.a,null,"Lists")},o.a.createElement(z.a,null,o.a.createElement(pe.a,null,o.a.createElement(fe.a,null)),o.a.createElement(F.a,{id:"switch-list-label-checkboxes",primary:"Checkboxes"}),o.a.createElement(P.a,null,o.a.createElement(me.a,{checked:null!==(e=t.listCheckboxSetting)&&void 0!==e&&e,onChange:function(){return t.toggleListCheckboxSetting()},edge:"end",inputProps:{"aria-labelledby":"switch-list-label-list-checkboxes"}}))),o.a.createElement(z.a,null,o.a.createElement(pe.a,null,o.a.createElement(be.a,null)),o.a.createElement(F.a,{id:"switch-list-label-dividers",primary:"Dividers"}),o.a.createElement(P.a,null,o.a.createElement(me.a,{disabled:!0,edge:"end",inputProps:{"aria-labelledby":"switch-list-label-list-dividers"}}))),o.a.createElement(z.a,null,o.a.createElement(pe.a,null,o.a.createElement(Ee.a,null)),o.a.createElement(F.a,{id:"switch-list-label-bluetooth",primary:"Show Extra Edge Types"}),o.a.createElement(P.a,null,o.a.createElement(me.a,{disabled:!0,edge:"end",inputProps:{"aria-labelledby":"switch-list-label-bluetooth"}})))))}));var je=function(){return window.location.pathname===Oe("/")||window.location.pathname===Oe()},Ne=Object(A.a)((function(e){var t=e.id,n=o.a.useState(null),a=Object(E.a)(n,2),i=a[0],r=a[1],l=o.a.useState(!1),d=Object(E.a)(l,2),s=d[0],u=d[1],p=Object(H.c)(),m=c();return o.a.createElement(ne,null,o.a.createElement(Q.a,{align:"center"},"Someone wants to share content with you.",o.a.createElement("br",null),"Do not accept if you do not trust them."),o.a.createElement(Z.a,{mt:1,textAlign:"center"},i?o.a.createElement(Q.a,{color:"error"},i):o.a.createElement(W.a,{disabled:s,onClick:function(){u(!0),m.seekPeerConnection(t).then((function(e){p(Oe("/node/".concat(e.id)))})).catch((function(e){r(e)}))},color:"primary"},s?o.a.createElement(_.a,{size:24}):"Accept")))}));function Oe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"/exuo"+e}var ke=function(e){var t=e.component,n=Object($.a)(e,["component"]);return o.a.createElement(t,n)},we=Object(A.a)((function(){return c().rootNode?o.a.createElement(H.b,{basepath:"/exuo"},o.a.createElement(ke,{path:"/",component:zt}),o.a.createElement(ke,{path:":type/:id",component:zt}),o.a.createElement(ke,{path:"peer/:id",component:Ne}),o.a.createElement(ke,{path:"settings",component:ye})):null})),Ce=(v(m.i.model("Note",{content:m.i.maybe(x)}).actions((function(e){return{setContent:function(t){e.content=t}}}))),n(353)),xe=n(354),Se=n(355),Me=n(317),Be=n(171),Ie=n.n(Be),Te=n(170),Ae=n.n(Te),Re=n(172),Le=n.n(Re),De=n(173),ze=n.n(De),Fe=n(174),Pe=n.n(Fe),We=n(175),Ue=n.n(We),Ke=n(169),Ge=n.n(Ke),Je=n(168),Ve=n.n(Je),qe=n(22),He=(n(310),[{label:"UL",style:"unordered-list-item",icon:o.a.createElement(Ve.a,null)},{label:"OL",style:"ordered-list-item",icon:o.a.createElement(Ge.a,null)},{label:"Blockquote",style:"blockquote",icon:o.a.createElement(Ae.a,null)},{label:"Code Block",style:"code-block",icon:o.a.createElement(Ie.a,null)}]),Xe=[{label:"Bold",style:"BOLD",icon:o.a.createElement(Le.a,null)},{label:"Italic",style:"ITALIC",icon:o.a.createElement(ze.a,null)},{label:"Underline",style:"UNDERLINE",icon:o.a.createElement(Pe.a,null)},{label:"Monospace",style:"CODE",icon:o.a.createElement(Ue.a,null)}],Ye=function(e){switch(e.getType()){case"blockquote":return"RichEditor-blockquote";default:return""}},$e=function(e){var t=e.onToggle,n=e.style,a=e.active,i=e.label,r=e.icon,c=function(e){e.preventDefault(),t(n)},l="RichEditor-styleButton";return a&&(l+=" RichEditor-activeButton"),r?o.a.createElement(oe.a,{size:"small",onMouseDown:c,className:l},r):o.a.createElement(W.a,{size:"small",startIcon:r||void 0,onMouseDown:c,className:l},r?"":i)},Qe=function(e){var t=e.editorState,n=e.onToggle,a=t.getSelection(),i=t.getCurrentContent().getBlockForKey(a.getStartKey()).getType();return o.a.createElement("div",null,He.map((function(e){return o.a.createElement($e,{key:e.label,active:e.style===i,label:e.label,icon:e.icon,onToggle:n,style:e.style})})))},Ze=function(e){var t=e.editorState,n=e.onToggle,a=t.getCurrentInlineStyle();return o.a.createElement("div",null,Xe.map((function(e){return o.a.createElement($e,{key:e.label,active:a.has(e.style),label:e.label,icon:e.icon,onToggle:n,style:e.style})})))},_e=Object(L.a)((function(e){return Object(D.a)({root:{width:"100%"},wrapper:{".multiLine &":{boxShadow:"0 0 ".concat(e.spacing(2),"px ").concat(e.spacing(2),"px ").concat(e.palette.background.default)},background:"\n        linear-gradient(\n          to top,\n          ".concat(Object(K.c)(e.palette.background.default,0),",\n          ").concat(Object(K.c)(e.palette.background.default,1),"             ").concat(e.spacing(1)/2,"px calc(100% - ").concat(e.spacing(1)/2,"px),\n          ").concat(Object(K.c)(e.palette.background.default,0),"\n        ),\n        linear-gradient(\n          to right,\n          ").concat(e.palette.primary.main,",\n          ").concat(e.palette.secondary.main," \n        )\n      ")},backdrop:{backgroundColor:Object(K.c)(e.palette.background.default,.8)},inputWrapper:{outline:"none",maxHeight:"50vh",overflowY:"auto","& .DraftEditor-editorContainer":{border:0,"& > [contentEditable=true]":{padding:e.spacing(1,2,1,2)},"& [data-contents=true] > [data-block=true]":Object(u.a)(Object(u.a)({},e.typography.body2),{},{"&:first-child":Object(u.a)({},e.typography.body1)})}},toolbar:{justifyContent:"center","&>div:first-child":{marginRight:e.spacing(4)}}})})),et=o.a.forwardRef((function(e,t){var n=e.note,a=e.text,i=e.rawContent,r=e.placeholder,c=e.autoFocus,l=e.showBackdrop,d=e.showControls,s=e.showRichTextControls,u=e.className,p=e.wrapperClassName,m=e.inputClassName,g=e.onValue,f=e.onClickAway,v=e.onEscape,b=_e(),h=o.a.useRef(null),j=o.a.useRef(null),N=o.a.useRef(null),O=null===n||void 0===n?void 0:n.nodeContent,k=o.a.useMemo((function(){return O&&Object(qe.convertFromRaw)(JSON.parse(O))||i&&Object(qe.convertFromRaw)(i)}),[O,i]),w=o.a.useState((function(){var e;return qe.EditorState.createWithContent(k||qe.ContentState.createFromText(null!==(e=null!==a&&void 0!==a?a:null===n||void 0===n?void 0:n.content)&&void 0!==e?e:""))})),C=Object(E.a)(w,2),x=C[0],S=C[1],M=Object(Ce.a)("(pointer: coarse) and (hover: none)"),B=o.a.useState(!M),I=Object(E.a)(B,2),T=I[0],A=I[1],R=o.a.useState(1),L=Object(E.a)(R,2),D=L[0],z=L[1];o.a.useEffect((function(){c&&S(qe.EditorState.moveFocusToEnd(x))}),[D]);var F=function(e){var t=x.getCurrentContent(),a=Object(qe.convertToRaw)(t);n&&(n.setRawContentState(a),n.setContent(t.getFirstBlock().getText())),(null===g||void 0===g?void 0:g(n||function(e){if("string"===typeof e)return!0;var t,n=Object(y.a)(e.blocks);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(a.depth||"unstyled"!==a.type||a.inlineStyleRanges.length)return!1}}catch(o){n.e(o)}finally{n.f()}return!0}(a)?t.getPlainText():a,e))&&(z(D+1),S(qe.EditorState.forceSelection(qe.EditorState.push(qe.EditorState.moveFocusToEnd(x),qe.ContentState.createFromText(""),"remove-range"),t.getSelectionAfter())))},P=x.getCurrentContent().getBlocksAsArray().length;return o.a.createElement("div",{ref:t,className:[b.root,P>1?"multiLine":null,u].join(" ")},o.a.createElement(xe.a,{ref:N,open:Boolean(P>1&&l),className:b.backdrop,transitionDuration:1500}),o.a.createElement(Se.a,{mouseEvent:"onMouseDown",touchEvent:"onTouchStart",onClickAway:function(e){f?f():F(e)}},o.a.createElement(Me.a,{in:!0,timeout:300},o.a.createElement("div",{ref:h,className:[b.wrapper,p].join(" ")},o.a.createElement("div",{tabIndex:-1,className:[b.inputWrapper,m].join(" ")},o.a.createElement(qe.Editor,{key:D,ref:j,blockStyleFn:Ye,editorState:x,handleKeyCommand:function(e,t){var n=qe.RichUtils.handleKeyCommand(t,e);return n?(S(n),"handled"):"not-handled"},keyBindingFn:function(e){return 13===e.keyCode?T&&!e.shiftKey||!T&&e.shiftKey?(F(),null):(A(!1),Object(qe.getDefaultKeyBinding)(e)):27===e.keyCode?(null===v||void 0===v||v(),null):Object(qe.getDefaultKeyBinding)(e)},onChange:S,placeholder:r,spellCheck:!0})),P>1&&d&&o.a.createElement(ae.a,{variant:"dense",className:b.toolbar},s&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Ze,{editorState:x,onToggle:function(e){S(qe.RichUtils.toggleInlineStyle(x,e))}}),o.a.createElement(Qe,{editorState:x,onToggle:function(e){S(qe.RichUtils.toggleBlockType(x,e))}})))))))}));et.defaultProps={showBackdrop:!1,showControls:!1,showRichTextControls:!0};var tt=Object(L.a)((function(e){var t;return Object(D.a)({listItemContainer:(t={borderTop:".1px solid ".concat(e.palette.divider),background:e.palette.background.default},Object(O.a)(t,"&.isEditing, &.isEditing + li,  &.isEditing + .MuiCollapse-container > .MuiCollapse-wrapper > .MuiCollapse-wrapperInner > .MuiList-root > .MuiListItem-container:first-child",{borderTop:".1px solid transparent",background:"unset !important"}),Object(O.a)(t,"transition",e.transitions.create(["color","background","border"],{duration:e.transitions.duration.shortest})),Object(O.a)(t,"cursor","pointer"),Object(O.a)(t,"&:hover",{color:e.palette.primary.main,background:e.palette.background.paper}),Object(O.a)(t,"&.isEditing, .editMode &, .selectMode &",{cursor:"default",color:"unset"}),t),listItem:{position:"relative","&.Mui-selected":{background:"\n          linear-gradient(\n            to top,\n            ".concat(Object(K.c)(e.palette.background.default,0),",\n            ").concat(Object(K.c)(e.palette.background.default,.9),"               ").concat(e.spacing(1)/2,"px calc(100% - ").concat(e.spacing(1)/2,"px),\n            ").concat(Object(K.c)(e.palette.background.default,0),"\n          ),\n          linear-gradient(\n            to right,\n            ").concat(e.palette.primary.main,",\n            ").concat(e.palette.secondary.main," \n          )\n        "),"&:hover":{color:"unset"},"& a:hover":{color:"unset"}}},childList:{marginLeft:e.spacing(4),padding:0},itemText:{margin:0,".isDragging &":{opacity:0},"&, & .MuiListItemText-secondary":{overflowX:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},"& .MuiListItemText-primary":{display:"inline"},"& .MuiListItemText-secondary":{paddingLeft:e.spacing(1)},"&.expand":{"& .MuiListItemText-secondary":{display:"block",paddingLeft:0}}},listItemSelectCheckbox:{padding:e.spacing(0,1,0,1),"&:hover, &.Mui-checked:hover":{backgroundColor:"unset"}},listItemIcon:{minWidth:"auto"},noteEditor:{marginBottom:e.spacing(8)+1,zIndex:e.zIndex.appBar,cursor:"default",position:"absolute",top:0,left:0},noteEditorInput:{cursor:"text"},secondaryActions:{display:"none",".isDragging &":{opacity:0},"&.hasChild, .selectMode &":{display:"unset"},right:0},edgeArrow:{cursor:"default",color:e.palette.text.hint,"&:hover":{background:"inherit"},".isExpanded &":{color:e.palette.text.primary},".selectMode &":{cursor:"pointer","&:hover":{color:e.palette.primary.main}},transition:e.transitions.create(["color"],{duration:e.transitions.duration.shortest}),minWidth:"unset",paddingRight:e.spacing(2),paddingLeft:e.spacing(2)}})})),nt=Object(A.a)((function(e){var t,n,a,i,r,l,d,u=e.node,p=e.parentNode,m=e.expandSecondaryTypography,g=e.className,f=e.index,v=e.moveItem,b=e.onContextMenu,h=tt(),j=o.a.useRef(null),N=Object(H.c)(),O=c(),k=O.activeModes,w=s(),C=w.view,x=o.a.useState(!1),S=Object(E.a)(x,2),M=S[0],B=S[1],I=null===(t=O.selectedNodes.get(p.id))||void 0===t?void 0:t.includes(u.id),T=null!==(n=null===C||void 0===C||null===(a=C.getItem("".concat(p.id,"/").concat(u.id)))||void 0===a?void 0:a.expanded)&&void 0!==n&&n,A=Object(X.a)({accept:"Node"+p.id,hover:function(e,t){var n;if(j.current){var a=e.index,o=f;if(a!==o){var i=null===(n=j.current)||void 0===n?void 0:n.getBoundingClientRect(),r=i.height/2,c=t.getClientOffset().y-i.top;a<o&&c<r||a>o&&c>r||(e.index=o,v(e,a,o))}}}}),R=Object(E.a)(A,2)[1],L=Object(Y.a)({canDrag:function(){return!M},item:{type:"Node"+p.id,path:"".concat(p.id,"/").concat(u.id),parentNode:p,childNode:u,index:f},collect:function(e){return{isDragging:e.isDragging()}}}),D=Object(E.a)(L,2),K=D[0].isDragging,G=D[1],V=null===(i=u.content)||void 0===i||null===(r=i.toJSON)||void 0===r?void 0:r.call(i);if("string"===typeof u.content){var $=u.content.indexOf("\n");l=$>0?u.content.slice(0,$):u.content,d=$>0?u.content.slice($+1):void 0}else if(null===V||void 0===V?void 0:V.blocks){var Q,Z=Object(y.a)(V.blocks);try{for(Z.s();!(Q=Z.n()).done;){var _=Q.value;if(""!==_.text)if(l){if(d)break;d=_.text}else l=_.text}}catch(ee){Z.e(ee)}finally{Z.f()}}else l=u.id;return G(R(j)),o.a.createElement(o.a.Fragment,null,o.a.createElement(z.a,{ref:j,onClick:function(e){e.preventDefault(),M||(e.altKey?(O.setActiveMode("edit"),B(!0)):e.shiftKey?(B(!1),O.setActiveMode("select"),O.toggleSelectNode(u,p)):e.metaKey?N(Oe("/node/".concat(u.id,"/"))):k.includes("select")?O.toggleSelectNode(u,p):k.includes("edit")?B(!0):N(Oe("/node/".concat(u.id,"/"))))},selected:I,className:h.listItem,ContainerProps:{onContextMenu:b,className:[h.listItemContainer,T?"isExpanded":"",K?"isDragging":"",M?"isEditing":"",g].join(" ")}},M&&o.a.createElement(et,{autoFocus:!0,text:V?void 0:u.content,rawContent:V,className:h.noteEditor,inputClassName:h.noteEditorInput,onValue:function(e){B(!1),e&&("string"===typeof e||Object.keys(e).includes("blocks"))&&u.setContent(e)},onEscape:function(){B(!1)}}),o.a.createElement(F.a,{primary:l,secondary:d,className:[h.itemText,m?"expand":""].join(" ")}),o.a.createElement(P.a,{className:[h.secondaryActions,u.childCount>0?"hasChild":""].join(" ")},o.a.createElement(W.a,{size:"small",onClick:function(e){k.includes("select")||e.metaKey?N(Oe("/node/".concat(u.id,"/"))):function(){var e=w.initView().initItem("".concat(p.id,"/").concat(u.id));e.setExpanded(!e.expanded)}()},className:h.edgeArrow,endIcon:T?o.a.createElement(q.a,null):o.a.createElement(J.a,null)},u.childCount>0&&u.childCount))),u.childCount>0&&o.a.createElement(U.a,{in:T,timeout:"auto",unmountOnExit:!0},o.a.createElement(ot,{node:u,edgeTag:"child",className:h.childList})))}));nt.defaultProps={expandSecondaryTypography:!0};var at=Object(L.a)((function(e){return Object(D.a)({list:{padding:0,"&.outer":{borderBottom:".1px solid ".concat(e.palette.divider),"& > li:first-child":{border:0}}}})})),ot=Object(A.a)((function(e){var t=e.node,n=e.edgeTag,a=e.outer,i=e.className,r=at(),l=t.edgeMap.get(n),d=c().activeModes,s=o.a.useCallback((function(e,t,n){e.parentNode.reorderEdge("child",e.childNode,n,t)}),[]);return(null===l||void 0===l?void 0:l.length)?o.a.createElement(R.a,{"aria-label":"edge list",className:[r.list,a?"outer":null,a&&d.includes("edit")?"editMode":null,a&&d.includes("select")?"selectMode":null,i].join(" ")},l.map((function(e,a){return o.a.createElement(nt,{key:"".concat(t.id,"-").concat(n,"-").concat(e.id),index:a,node:e,parentNode:t,moveItem:s})}))):null})),it=(n(368),Object(L.a)((function(e){return Object(D.a)({root:Object(u.a)({display:"inline-block",margin:0,padding:e.spacing(1,2,1,2),overflowX:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},e.typography.body1)})})),n(188)),rt=n.n(it),ct=n(187),lt=n.n(ct),dt=n(186),st=n.n(dt),ut=n(189),pt=n.n(ut),mt=n(357),gt=n(314),ft=n(358),vt=n(359),bt=n(181),ht=n.n(bt),Et=n(182),yt=n.n(Et),jt=n(185),Nt=n.n(jt),Ot=n(184),kt=n.n(Ot),wt=n(183),Ct=n.n(wt),xt=n(179),St=n.n(xt),Mt=Object(L.a)((function(e){return Object(D.a)({root:{display:"inherit",position:"relative"},buttonGroup:{"& .MuiButtonGroup-groupedTextHorizontal":{borderRight:"unset"},"& .MuiButtonGroup-grouped":{minWidth:"unset"}},selectCount:{color:e.palette.primary.main,fontSize:12,position:"absolute",right:-e.spacing(1)},selectButton:{},deleteButton:{color:e.palette.error.main},popper:{"& svg":{marginRight:e.spacing(1)}},paper:{border:".1px solid ".concat(e.palette.divider)},selectMenu:{outline:0}})})),Bt=Object(A.a)((function(e){e.node;var t=e.className,n=e.onClick,a=Object($.a)(e,["node","className","onClick"]),i=c(),r=s(),l=Mt(),d=o.a.useRef(null),u=i.selectedNodeCount,p=o.a.useState(!1),m=Object(E.a)(p,2),g=m[0],f=m[1],v=o.a.useState(!1),b=Object(E.a)(v,2),h=b[0],y=b[1];return o.a.useEffect((function(){var e=function(e){"Alt"===e.key&&y(!0)},t=function(e){"Alt"===e.key&&y(!1)};return document.addEventListener("keydown",e),document.addEventListener("keyup",t),function(){document.removeEventListener("keydown",e),document.removeEventListener("keyup",t)}})),o.a.createElement("div",{className:[l.root,t].join(" ")},u>0&&o.a.createElement("span",{className:l.selectCount},u),o.a.createElement(oe.a,Object.assign({color:"primary",ref:d,onClick:function(e){e.altKey?function(e,t){var n=URL.createObjectURL(e),a=document.createElement("a");a.href=n,a.download=null!==t&&void 0!==t?t:"",a.setAttribute("style","'display: 'none'"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n)}(i.exportAllItems()):i.selectedNodes.size?f(!0):n(e)},className:l.selectButton},a),o.a.createElement(St.a,null)),o.a.createElement(mt.a,{open:g,anchorEl:d.current,role:void 0,disablePortal:!0,className:l.popper},(function(e){e.placement;return o.a.createElement(Se.a,{mouseEvent:"onMouseDown",touchEvent:"onTouchStart",onClickAway:function(e){e.preventDefault(),f(!1)}},o.a.createElement(gt.a,{elevation:0,className:l.paper},o.a.createElement(ft.a,{dense:!0,className:l.selectMenu},o.a.createElement(vt.a,{divider:!0,onClick:function(){i.removeSelectedNodes(),f(!1)},className:l.deleteButton},o.a.createElement(ht.a,null),"Remove"),h?o.a.createElement(vt.a,{onClick:function(){i.linkSelectedNodes(r),f(!1)}},o.a.createElement(yt.a,null),"Link here"):o.a.createElement(vt.a,{disabled:!0,onClick:function(){f(!1)}},o.a.createElement(Ct.a,null),"Copy here"),o.a.createElement(vt.a,{divider:!0,onClick:function(){i.moveSelectedNodes(r),f(!1)}},o.a.createElement(kt.a,null),"Move here"),o.a.createElement(vt.a,{onClick:function(){i.clearSelectedNodes(),f(!1)}},o.a.createElement(Nt.a,null),"Clear selection"))))})))})),It=Object(L.a)((function(e){var t;return Object(D.a)({root:{},toolbar:(t={justifyContent:"space-evenly"},Object(O.a)(t,e.breakpoints.up("sm"),{justifyContent:"center"}),Object(O.a)(t,"minHeight",e.spacing(8)),Object(O.a)(t,"background","\n        linear-gradient(\n          to bottom,\n          ".concat(Object(K.c)(e.palette.background.default,.8),",\n          ").concat(Object(K.c)(e.palette.background.default,1)," 80%\n        )")),t),insertButton:{color:e.palette.background.default,boxShadow:"unset",margin:e.spacing(0,1,0,1),background:"\n        radial-gradient(\n          circle at bottom,\n          ".concat(e.palette.secondary.main,",\n          ").concat(e.palette.primary.main," 75%\n        )"),"&:hover, &:focus":{boxShadow:"unset",background:"\n        radial-gradient(\n          circle at bottom,\n          ".concat(Object(K.b)(e.palette.secondary.main,.3),",\n          ").concat(e.palette.primary.main," 75%\n        )")},"&:active":{boxShadow:"unset",background:"\n        radial-gradient(\n          circle at bottom,\n          ".concat(Object(K.b)(e.palette.secondary.main,.3),",\n          ").concat(e.palette.primary.main," 75%\n        )")}}})})),Tt=Object(A.a)((function(e){var t,n=e.node,a=e.className,i=It(),r=c(),l=n.childCount>0,d=null!==(t=r.selectedNodes.size)&&void 0!==t?t:0;return o.a.createElement(Z.a,{className:[i.root,a].join(" ")},o.a.createElement(ae.a,{className:i.toolbar},o.a.createElement(oe.a,{disabled:!0,color:r.activeModes.includes("edit")?"primary":void 0,onClick:function(){return r.toggleActiveMode("edit")}},o.a.createElement(st.a,null)),o.a.createElement(oe.a,{disabled:!l,color:r.activeModes.includes("edit")?"primary":void 0,onClick:function(){return r.toggleActiveMode("edit")}},o.a.createElement(lt.a,null)),o.a.createElement(oe.a,{color:"primary",onClick:function(e){e.altKey?function(e,t){var n=document.createElement("input");n.type="file",n.accept=e,n.setAttribute("style","display: none"),n.oninput=function(){var e;(null===(e=n.files)||void 0===e?void 0:e.length)&&t(n.files)},document.body.appendChild(n),n.click(),document.body.removeChild(n)}(".json",(function(e){return r.importItems(e[0])})):r.setActiveMode("insert")},className:i.insertButton},o.a.createElement(rt.a,null)),o.a.createElement(Bt,{disabled:!(l||d>0),node:n,color:r.activeModes.includes("select")?"primary":void 0,onClick:function(){r.toggleActiveMode("select")}}),o.a.createElement(oe.a,{disabled:!0,color:r.activeModes.includes("edit")?"primary":void 0,onClick:function(){return r.toggleActiveMode("edit")}},o.a.createElement(pt.a,null)),!1))})),At=Object(L.a)((function(e){return Object(D.a)({root:{textAlign:"center",position:"relative",paddingBottom:e.spacing(8)},appBar:{zIndex:e.zIndex.appBar+1,position:"sticky",borderBottom:".1px solid ".concat(e.palette.divider),background:"\n        linear-gradient(\n          to top,\n          ".concat(Object(K.c)(e.palette.background.default,.8),",\n          ").concat(Object(K.c)(e.palette.background.default,1)," 80%\n        )")},titleBar:{background:"unset"},children:{},textEditor:{position:"sticky",zIndex:e.zIndex.appBar,bottom:e.spacing(8)+1},actions:Object(O.a)({borderTop:".1px solid ".concat(e.palette.divider),zIndex:e.zIndex.appBar+1,position:"fixed",bottom:0,left:"50%",width:"100%",transform:"translateX(-50%)"},e.breakpoints.up("sm"),{maxWidth:"900px"})})})),Rt=Object(A.a)((function(e){var t,n,a,i=e.node,r=e.className,l=e.children,d=At(),s=Object(H.c)(),u=c(),p=null===(t=i.content)||void 0===t||null===(n=t.toJSON)||void 0===n?void 0:n.call(t);if("string"===typeof i.content)a=i.content;else if(p){var m,g;a=null===(m=p.blocks)||void 0===m||null===(g=m[0])||void 0===g?void 0:g.text}else a=i.id;return o.a.createElement(Z.a,{className:[d.root,r].join(" ")},o.a.createElement(ee.a,{elevation:0,className:d.appBar},o.a.createElement(se,{title:a,className:d.titleBar})),o.a.createElement(Z.a,{className:[d.children,u.activeModes.includes("insert")?"fade":""].join(" ")},l),u.activeModes.includes("insert")&&o.a.createElement(et,{autoFocus:!0,className:d.textEditor,onValue:function(e,t){if(e){var n=u.createChild(i,{content:e});if(!(null===t||void 0===t?void 0:t.ctrlKey))return!0;s(Oe("/node/".concat(n.id,"/")))}else u.toggleActiveMode("insert")},onEscape:function(){u.unsetActiveMode("insert")}}),o.a.createElement(Tt,{node:i,className:[d.actions,u.activeModes.includes("insert")?"fade":""].join(" ")}))})),Lt=n(360),Dt=n(190),zt=Object(A.a)((function(e){var t=e.id,n=c(),a=n.Node.get(t),i=null!==a&&void 0!==a?a:n.rootNode;return i?o.a.createElement(Lt.a,{backend:Dt.a},o.a.createElement(d,{value:i},o.a.createElement(Rt,{node:i},o.a.createElement(ot,{node:i,edgeTag:"child",outer:!0})))):null})),Ft=(n(365),Object(L.a)((function(e){return Object(D.a)({root:{display:"inherit",position:"relative"},buttonGroup:{"& .MuiButtonGroup-groupedTextHorizontal":{borderRight:"unset"},"& .MuiButtonGroup-grouped":{minWidth:"unset"}},selectCount:{color:e.palette.primary.main,fontSize:12,position:"absolute",right:-e.spacing(1)},selectButton:{},deleteButton:{color:e.palette.error.main},popper:{"& svg":{marginRight:e.spacing(1)}},paper:{border:".1px solid ".concat(e.palette.divider)},selectMenu:{outline:0}})})),m.i.model("Store",{graph:T,location:m.i.optional(m.i.string,"/")}).actions((function(e){return{setLocation:function(t){e.location=t}}})).create({graph:T.create()})),Pt=o.a.createContext(Ft),Wt=function(e){var t=e.children;return o.a.createElement(Pt.Provider,{value:Ft},t)};function Ut(){var e=o.a.useContext(Pt);if(e)return e;throw Error("Cannot use store before setup")}Object(A.a)((function(e){var t=e.id,n=(e.type,Ut()),a=n.graph.Node.get(t),i=n.graph.rootNode;return a&&(i=a),i?o.a.createElement(Rt,{node:i},o.a.createElement(ot,{node:i,edgeTag:"child"})):null}));var Kt=Object(L.a)((function(e){return Object(D.a)({root:{},item:{},itemText:{}})})),Gt=(Object(A.a)((function(e){var t=Kt(),n=c(),a=e.node;if("string"===typeof a&&(a=n.Node.get(e.node)),!Object(m.g)(a))return o.a.createElement(o.a.Fragment,null);var i=Object(m.b)(a),r=Object.keys(i.properties);return o.a.createElement("form",{onSubmit:function(){console.log("submit")}},o.a.createElement(R.a,{className:t.root},r.map((function(e){return o.a.createElement(z.a,{dense:!0,button:!0,key:e,className:t.item},o.a.createElement(F.a,{primary:e,id:"list-content-".concat(e),className:t.itemText}))}))))})),n(361)),Jt=n(362),Vt=n(363),qt=function(e){var t=e.children,n=Object(Ce.a)("(prefers-color-scheme: dark)"),a=o.a.useMemo((function(){var e={type:n?"dark":"light",primary:{main:"#FF2EA2"},secondary:{main:"#FF8F00"},divider:n?"#1b1b1b":"#e0e0e0",background:{default:n?"#000000":"#ffffff",paper:n?"#101010":"#f8f8f8"},text:{primary:n?"#dddddd":"#212121",secondary:n?"#aaaaaa":"#595959"}};return Object(Gt.a)({palette:e,typography:{fontFamily:["-apple-system","system-ui","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(", ")},shape:{borderRadius:6},props:{MuiButton:{disableElevation:!0},MuiButtonGroup:{disableElevation:!0}},overrides:{MuiButtonBase:{root:{cursor:"default"}},MuiCssBaseline:{"@global":{"*::selection":{backgroundColor:Object(K.c)(e.text.primary,n?.3:.2)},html:{userSelect:"none",overscrollBehavior:"none","-webkit-touch-callout":"none",height:"100%",margin:"auto",maxWidth:"900px"},body:{height:"100%"}}}}})}),[n]);return o.a.createElement(Jt.a,{theme:a},o.a.createElement(Vt.a,null),t)},Ht=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Xt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(Wt,null,o.a.createElement(qt,null,o.a.createElement(we,null)))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/exuo",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/exuo","/service-worker.js");Ht?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Xt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Xt(t,e)}))}}()}},[[203,1,2]]]);
//# sourceMappingURL=main.8564c78d.chunk.js.map