{"version":3,"sources":["graph/utils.ts","graph/models/factories.ts","store/persist.ts","graph/models/Unknown.ts","graph/models/Node.ts","graph/models/Config.ts","graph/models/View.ts","graph/models/Graph.ts","common/Layout.tsx","common/TitleBar.tsx","common/Settings.tsx","common/utils.tsx","peer/PeerConnector.tsx","route.tsx","note/models/Note.ts","note/NoteEditor.tsx","graph/components/NodeListItem.tsx","graph/components/EdgeList.tsx","graph/components/LabelEditor.tsx","select/SelectButton.tsx","graph/components/NodeActions.tsx","graph/components/NodeLayout.tsx","graph/components/NodeViewer.tsx","store/StoreProvider.tsx","graph/components/NodeContextMenu.tsx","store/models/Store.ts","store/useStore.ts","store/components/InstanceViewer.tsx","store/components/PropertyEditor.tsx","theme.tsx","serviceWorker.ts","index.tsx"],"names":["useGraph","useStore","graph","activeContext","React","createContext","ActiveProvider","Provider","useActive","active","useContext","Error","edgeMapFactory","getEdgeType","types","model","edgeMap","map","array","safeReference","late","acceptsUndefined","actions","self","hasEdge","tag","target","Boolean","get","includes","length","addEdge","has","set","push","removeEdge","remove","reorderEdge","newIndex","currentIndex","edges","index","undefined","indexOf","item","splice","getEdgeTag","nodeFactory","models","compose","id","identifier","concat","named","graphFactory","nodeModels","options","Object","fromEntries","keys","key","isModelType","isIdentifierType","properties","createNode","modelName","props","node","create","getId","uuid","put","NodeBase","Node","instance","a","db","Dexie","tableNames","getMembers","tableConfig","name","version","stores","flushBuffer","buffer","forEach","patch","path","split","slice","typeName","propertyName","op","table","getSnapshot","propertyValue","isStateTreeNode","update","delete","Promise","all","toArray","then","rows","r","resolved","applySnapshot","timeout","onPatch","clearTimeout","setTimeout","Unknown","union","null","boolean","string","number","View","content","setContent","initView","value","view","graphRoot","views","getParentOfType","Graph","size","edgeTag","Config","maybe","items","ViewItem","expanded","optional","setExpanded","getItem","initItem","setActiveMode","mode","activeModes","clearSelectedNodes","unsetActiveMode","toggleActiveMode","processExportNode","itemId","allIds","json","toJSON","parentIds","parent","localIds","filter","selectNode","parentNode","nodes","selectedNodes","container","deselectNode","toggleSelectNode","nodeIds","clear","deleteSelectedNodes","nodeId","moveSelectedNodes","accessorId","accessor","copySelectedNodes","linkSelectedNodes","values","unlinkSelectedNodes","removeSelectedNodes","deleteNode","exportSelectedItems","itemIds","flatMap","snapshot","Blob","JSON","stringify","type","exportAllItems","importItems","file","text","parse","catch","error","afterCreate","persist","rootNode","system","rootNodeId","lastSelectedNodeId","e","console","createChild","edgeProps","edgeType","child","config","count","useStyles","makeStyles","theme","createStyles","root","appBar","width","color","palette","secondary","backgroundColor","background","default","padding","spacing","children","Layout","title","className","classes","Box","join","AppBar","elevation","position","backButton","cursor","visibility","pointerEvents","primary","main","transition","transitions","duration","shortest","hide","mouseEvents","settingsButton","flexGrow","textAlign","overflowX","whiteSpace","textOverflow","TitleBar","showBackButton","showSettingsButton","newlinePosition","Toolbar","IconButton","disabled","isRootPath","edge","aria-label","onClick","window","history","back","Typography","variant","component","Link","to","makeUrl","fontSize","defaultProps","Settings","observer","List","subheader","ListSubheader","ListItem","ListItemIcon","ListItemText","ListItemSecondaryAction","Switch","inputProps","checked","listCheckboxSetting","onChange","toggleListCheckboxSetting","location","pathname","PeerConnector","useState","peerError","setPeerError","hasAccepted","setHasAccepted","navigate","useNavigate","align","mt","Button","seekPeerConnection","CircularProgress","process","Route","Component","Router","basepath","NodeViewer","BLOCK_TYPES","label","style","icon","INLINE_STYLES","getBlockStyle","block","getType","StyleButton","onToggle","onToggleWrap","preventDefault","onMouseDown","startIcon","BlockStyleControls","editorState","selection","getSelection","blockType","getCurrentContent","getBlockForKey","getStartKey","InlineStyleControls","currentStyle","getCurrentInlineStyle","wrapper","boxShadow","fade","backdrop","inputWrapper","outline","maxHeight","overflowY","border","typography","body2","body1","toolbar","justifyContent","marginRight","NoteEditor","forwardRef","ref","note","rawContent","placeholder","autoFocus","showBackdrop","showControls","showRichTextControls","wrapperClassName","inputClassName","onValue","onClickAway","onEscape","containerRef","useRef","editorRef","backdropRef","nodeContent","contentState","useMemo","convertFromRaw","EditorState","createWithContent","ContentState","createFromText","setEditorState","isMobile","useMediaQuery","submitOnReturn","setSubmitOnReturn","setKey","useEffect","moveFocusToEnd","handleValue","event","convertToRaw","setRawContentState","getFirstBlock","getText","blocks","depth","inlineStyleRanges","isPlainText","getPlainText","forceSelection","getSelectionAfter","blockCount","getBlocksAsArray","Backdrop","open","transitionDuration","ClickAwayListener","mouseEvent","touchEvent","Fade","in","tabIndex","blockStyleFn","handleKeyCommand","command","newState","RichUtils","keyBindingFn","keyCode","shiftKey","getDefaultKeyBinding","spellCheck","inlineStyle","toggleInlineStyle","toggleBlockType","listItemContainer","borderTop","divider","paper","listItem","childList","marginLeft","itemText","margin","opacity","display","paddingLeft","listItemSelectCheckbox","listItemIcon","minWidth","noteEditor","marginBottom","zIndex","top","left","noteEditorInput","secondaryActions","right","edgeArrow","hint","paddingRight","NodeListItem","primaryText","secondaryText","expandSecondaryTypography","moveItem","onContextMenu","listItemRef","modes","isEditing","setIsEditing","isSelected","isExpanded","useDrop","accept","hover","monitor","current","dragIndex","hoverIndex","hoverBoundingRect","getBoundingClientRect","hoverMiddleY","height","hoverClientY","getClientOffset","y","drop","useDrag","canDrag","childNode","collect","isDragging","drag","newlineIndex","altKey","metaKey","selected","ContainerProps","childCount","toggleExpand","endIcon","Collapse","unmountOnExit","EdgeList","list","borderBottom","outer","useCallback","buttonGroup","borderRight","selectCount","selectButton","deleteButton","popper","selectMenu","SelectButton","extraProps","anchorRef","selectedCount","selectedNodeCount","setOpen","showAltMenu","setShowAltMenu","downHandler","upHandler","document","addEventListener","removeEventListener","blob","url","URL","createObjectURL","el","createElement","href","download","setAttribute","body","appendChild","click","removeChild","revokeObjectURL","saveBlob","Popper","anchorEl","role","disablePortal","placement","Paper","MenuList","dense","MenuItem","breakpoints","up","insertButton","emphasize","NodeActions","hasChildren","callback","oninput","files","selectFile","paddingBottom","titleBar","textEditor","bottom","transform","maxWidth","NodeLayout","titleText","ctrlKey","lookup","DndProvider","backend","HTML5Backend","store","setLocation","storeContext","StoreProvider","members","onSubmit","log","button","ThemeProvider","prefersDarkMode","createMuiTheme","fontFamily","shape","borderRadius","MuiButton","disableElevation","MuiButtonGroup","overrides","MuiButtonBase","MuiCssBaseline","html","userSelect","overscrollBehavior","CssBaseline","isLocalhost","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","getElementById","origin","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.8564c78d.chunk.js","sourcesContent":["/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\n\nimport { useStore } from 'store'\nimport { Graph, Node } from 'graph'\n\nexport const useGraph = (): Instance<typeof Graph> => useStore().graph\n\nexport const activeContext = React.createContext<Instance<typeof Node> | null>(\n  null,\n)\n\nexport const ActiveProvider = activeContext.Provider\n\nexport const useActive = (): Instance<typeof Node> => {\n  const active = React.useContext(activeContext)\n  if (active) {\n    return active\n  } else {\n    throw Error('Cannot use active Node before setup')\n  }\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  IAnyModelType,\n  IAnyType,\n  Instance,\n  isIdentifierType,\n  SnapshotIn,\n  isModelType,\n  types,\n} from 'mobx-state-tree'\nimport { v4 as uuid } from 'uuid'\n\nexport type ModelOrUnion = IAnyModelType | IAnyType\nexport type EdgeResolver = () => ModelOrUnion\nexport type ModelTable = Record<string, IAnyModelType>\n\nexport const edgeMapFactory = (getEdgeType: EdgeResolver): IAnyModelType =>\n  types\n    .model('EdgeMap', {\n      edgeMap: types.map(\n        types.array(\n          types.safeReference(types.late(getEdgeType), {\n            acceptsUndefined: false,\n          }),\n        ),\n      ),\n    })\n    .actions(self => ({\n      hasEdge(tag: string, target?: Instance<IAnyModelType>): boolean {\n        if (target) {\n          return Boolean(self.edgeMap.get(tag)?.includes(target))\n        } else {\n          return Boolean(self.edgeMap.get(tag)?.length)\n        }\n      },\n    }))\n    .actions(self => ({\n      addEdge<T extends Instance<IAnyModelType>>(tag: string, target: T): T {\n        if (!self.edgeMap.has(tag)) {\n          self.edgeMap.set(tag, [])\n        }\n\n        self.edgeMap.get(tag)?.push(target)\n\n        return target\n      },\n\n      removeEdge(tag: string, target: Instance<IAnyModelType>): void {\n        self.edgeMap.get(tag)?.remove(target)\n      },\n\n      reorderEdge(\n        tag: string,\n        target: Instance<IAnyModelType>,\n        newIndex: number,\n        currentIndex?: number,\n      ) {\n        const edges = self.edgeMap.get(tag)\n        if (!edges) return\n\n        let index = currentIndex\n        if (index === undefined) {\n          index = edges.indexOf(target)\n        }\n\n        const item = edges[index]\n        if (item !== target) {\n          throw Error('Invalid reorder target')\n        }\n\n        edges.splice(index, 1)\n        edges.splice(newIndex, 0, item)\n\n        return\n      },\n\n      getEdgeTag(tag: string): void | Array<Instance<IAnyModelType>> {\n        return self.edgeMap.get(tag)\n      },\n    }))\n\nexport const nodeFactory = (\n  models: IAnyModelType | Array<IAnyModelType> = [],\n): IAnyModelType =>\n  types\n    .compose(\n      // @ts-ignore\n      ...[\n        types.model({\n          id: types.identifier,\n        }),\n      ].concat(models),\n    )\n    .named('Node')\n\ninterface GraphFactoryOptions {\n  getId?: () => string\n}\n\nexport const graphFactory = (\n  nodeModels: ModelTable,\n  options: GraphFactoryOptions = {},\n): IAnyModelType =>\n  types\n    .model(\n      'Graph',\n      Object.fromEntries(\n        Object.keys(nodeModels).map(key => {\n          const model = nodeModels[key]\n\n          if (isModelType(model) && isIdentifierType(model.properties.id)) {\n            return [key, types.map(nodeModels[key])]\n          }\n\n          // Can't add an identifier because the model may be referenced\n          throw Error(`Model '${key}' requires 'id' identifier`)\n        }),\n      ),\n    )\n    .actions(self => ({\n      createNode(\n        modelName = 'Node',\n        props: SnapshotIn<IAnyModelType> = {},\n      ): Instance<IAnyModelType> {\n        if (!nodeModels[modelName]) {\n          throw Error(`No model named '${modelName}'`)\n        }\n\n        const node = nodeModels[modelName].create({\n          id: options.getId?.() ?? uuid(),\n          ...props,\n        })\n\n        self[modelName].put(node)\n\n        return node\n      },\n    }))\n\nexport const NodeBase = nodeFactory(edgeMapFactory(() => NodeBase))\nexport const GraphBase = graphFactory({ Node: NodeBase })\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  Instance,\n  onPatch,\n  getSnapshot,\n  getMembers,\n  applySnapshot,\n  IAnyModelType,\n  IJsonPatch,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport Dexie from 'dexie'\n\nconst bufferLimit = 1000\nconst flushWait = 1000\n\nexport async function persist(\n  instance: Instance<IAnyModelType>,\n): Promise<void> {\n  const db = new Dexie('default')\n  const tableNames = Object.keys(getMembers(instance).properties)\n  const tableConfig = Object.fromEntries(tableNames.map(name => [name, 'id']))\n\n  db.version(1).stores(tableConfig)\n\n  const flushBuffer = (buffer: Array<IJsonPatch>): void => {\n    buffer.forEach(patch => {\n      const [typeName, id, propertyName] = patch.path.split('/').slice(1)\n\n      if (patch.op === 'add') {\n        db.table(typeName).put(getSnapshot(instance[typeName].get(id)))\n      } else if (patch.op === 'replace' || patch.op === 'remove') {\n        if (propertyName) {\n          let propertyValue = instance[typeName].get(id)[propertyName]\n\n          if (isStateTreeNode(propertyValue)) {\n            propertyValue = getSnapshot(propertyValue)\n          }\n\n          db.table(typeName).update(id, {\n            [propertyName]: propertyValue,\n          })\n        } else {\n          db.table(typeName).delete(id)\n        }\n      } else {\n        throw Error(`Unknown patch op '${patch.op}'`)\n      }\n    })\n  }\n\n  return Promise.all(\n    tableNames.map(name =>\n      db\n        .table(name)\n        .toArray()\n        .then(rows => [name, Object.fromEntries(rows.map(r => [r.id, r]))]),\n    ),\n  ).then(resolved => {\n    applySnapshot(instance, Object.fromEntries(resolved))\n\n    let buffer: Array<IJsonPatch> = []\n    let timeout: ReturnType<typeof setTimeout>\n\n    onPatch(instance, patch => {\n      buffer.push(patch)\n\n      if (timeout) {\n        clearTimeout(timeout)\n      }\n\n      timeout = setTimeout(() => {\n        flushBuffer(buffer)\n        buffer = []\n      }, flushWait)\n\n      if (buffer.length > bufferLimit) {\n        flushBuffer(buffer)\n        buffer = []\n      }\n    })\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, IAnyType } from 'mobx-state-tree'\n\nexport const Unknown = types.union(\n  types.null,\n  types.boolean,\n  types.string,\n  types.number,\n  types.array(types.late((): IAnyType => Unknown)),\n  types.map(types.late((): IAnyType => Unknown)),\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  types,\n  IAnyType,\n  Instance,\n  getParentOfType,\n  SnapshotIn,\n} from 'mobx-state-tree'\n\nimport { nodeFactory, edgeMapFactory, View, Graph } from 'graph'\n\n// Avoid circular dependency\nimport { Unknown } from 'graph/models/Unknown'\n\nexport const Node = nodeFactory([\n  edgeMapFactory(() =>\n    types.union(\n      types.late((): IAnyType => Node),\n      View,\n    ),\n  ),\n])\n  .props({\n    content: types.union(types.string, Unknown),\n  })\n\n  .actions(self => ({\n    setContent(content: string | Instance<typeof Unknown>): void {\n      self.content = content\n    },\n\n    initView(value?: SnapshotIn<typeof View>): Instance<typeof View> | void {\n      const view = self.view\n\n      if (!view) {\n        self.addEdge('view', self.graphRoot.createNode('View', value))\n      }\n\n      return self.view\n    },\n  }))\n\n  .views(self => ({\n    get childCount(): number {\n      return self.edgeMap.get('child')?.length ?? 0\n    },\n\n    get graphRoot(): Instance<typeof Graph> {\n      return getParentOfType(self, Graph)\n    },\n\n    get view(): Instance<typeof View> | void {\n      if (self.edgeMap.size) {\n        const edgeTag = self.edgeMap.get('view')\n        if (edgeTag && edgeTag.length) {\n          return edgeTag[0]\n        }\n      }\n\n      return undefined\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, SnapshotIn, Instance } from 'mobx-state-tree'\n\nimport { nodeFactory } from 'graph'\nimport { Unknown } from './Unknown'\n\nconst ConfigBase = types\n  .model('Config', {\n    name: types.maybe(types.string),\n    items: types.map(Unknown),\n  })\n  .actions(self => ({\n    set(key: string, value: SnapshotIn<typeof Unknown>): void {\n      self.items.set(key, value)\n    },\n\n    get(key: string): Instance<typeof Unknown> {\n      return self.items.get(key)\n    },\n  }))\n\nexport const Config = nodeFactory(ConfigBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, Instance } from 'mobx-state-tree'\n\nimport { nodeFactory } from 'graph'\n\nconst ViewItem = types\n  .model('ViewItem', {\n    expanded: types.optional(types.boolean, false),\n  })\n\n  .actions(self => ({\n    setExpanded(value: boolean) {\n      self.expanded = value\n    },\n  }))\n\nconst ViewBase = types\n  .model('View', {\n    items: types.map(ViewItem),\n  })\n\n  .views(self => ({\n    getItem(path: string): Instance<typeof ViewItem> | void {\n      if (self.items.size) {\n        return self.items.get(path)\n      }\n    },\n  }))\n\n  .actions(self => ({\n    initItem(path: string): Instance<typeof ViewItem> | void {\n      let item = self.getItem(path)\n      if (item) return item\n\n      item = ViewItem.create()\n      self.items.set(path, item)\n\n      return self.getItem(path)\n    },\n  }))\n\nexport const View = nodeFactory(ViewBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  types,\n  Instance,\n  applySnapshot,\n  SnapshotIn,\n  SnapshotOut,\n  IAnyModelType,\n  getSnapshot,\n} from 'mobx-state-tree'\n\nimport { persist } from 'store/persist'\n\nimport { graphFactory } from './factories'\nimport { Node } from './Node'\nimport { Config } from './Config'\nimport { View } from './View'\n\nexport const Graph = graphFactory({\n  Node,\n  Config,\n  View,\n})\n  .actions(self => ({\n    // TODO mode and select stuff don't belong here\n\n    setActiveMode(mode: string) {\n      const activeModes = self.activeModes\n      if (!activeModes?.includes(mode)) {\n        activeModes.push(mode)\n\n        if (mode === 'select') {\n          activeModes.remove('edit')\n        }\n\n        if (mode === 'edit') {\n          activeModes.remove('select')\n          self.clearSelectedNodes()\n        }\n      }\n    },\n\n    unsetActiveMode(mode: string) {\n      const activeModes = self.activeModes\n      if (activeModes?.includes(mode)) {\n        activeModes.remove(mode)\n      }\n    },\n\n    toggleActiveMode(mode: string) {\n      const activeModes = self.activeModes\n\n      if (!activeModes) {\n        return\n      }\n\n      if (activeModes.includes(mode)) {\n        activeModes.remove(mode)\n\n        if (mode === 'select') {\n          self.clearSelectedNodes()\n        }\n      } else {\n        activeModes.push(mode)\n\n        if (mode === 'select') {\n          activeModes.remove('edit')\n        }\n\n        if (mode === 'edit') {\n          activeModes.remove('select')\n          self.clearSelectedNodes()\n        }\n      }\n    },\n  }))\n\n  .actions(self => {\n    function processExportNode(\n      itemId: string,\n      allIds: Array<string>,\n    ): SnapshotIn<typeof Node> {\n      const json = { ...self['Node'].get(itemId).toJSON() }\n      const parentIds = json.edgeMap.parent\n\n      delete json.edgeMap\n\n      if (parentIds) {\n        const localIds = parentIds.filter((id: string) => allIds.includes(id))\n        if (localIds.length) {\n          json.edgeMap = { parent: localIds }\n        }\n      }\n\n      return json\n    }\n\n    return {\n      selectNode(\n        node: Instance<typeof Node>,\n        parentNode: Instance<typeof Node>,\n      ): void {\n        const nodes = self.selectedNodes\n        const container = nodes.get(parentNode.id)\n\n        if (container) {\n          if (!container.includes(node.id)) {\n            container.push(node.id)\n          }\n        } else {\n          nodes.set(parentNode.id, [node.id])\n        }\n      },\n\n      deselectNode(\n        node: Instance<typeof Node>,\n        parentNode: Instance<typeof Node>,\n      ): void {\n        const nodes = self.selectedNodes\n        const container = nodes.get(parentNode.id)\n\n        if (!container) return\n\n        container.remove(node.id)\n\n        if (container.length === 0) {\n          nodes.delete(parentNode.id)\n        }\n      },\n\n      toggleSelectNode(\n        node: Instance<typeof Node>,\n        parentNode: Instance<typeof Node>,\n      ): void {\n        const selectedNodes = self.Config.get('system').get('selectedNodes')\n        if (!selectedNodes) {\n          return\n        }\n\n        const nodeIds = selectedNodes.get(parentNode.id)\n\n        if (nodeIds) {\n          if (nodeIds.includes(node.id)) {\n            nodeIds.remove(node.id)\n            if (nodeIds.length === 0) {\n              selectedNodes.delete(parentNode.id)\n            }\n          } else {\n            nodeIds.push(node.id)\n          }\n        } else {\n          selectedNodes.set(parentNode.id, [node.id])\n        }\n      },\n\n      clearSelectedNodes(): void {\n        self.Config.get('system').get('selectedNodes')?.clear()\n        if (self.selectedNodes.size === 0) {\n          self.unsetActiveMode('select')\n        }\n      },\n\n      deleteSelectedNodes(): void {\n        self.selectedNodes.forEach((nodeIds: Array<string>) =>\n          nodeIds.forEach((nodeId: string) => self.Node.delete(nodeId)),\n        )\n\n        self.clearSelectedNodes()\n      },\n\n      moveSelectedNodes(target: Instance<typeof Node>): void {\n        for (const [accessorId, nodeIds] of self.selectedNodes) {\n          const accessor = self.Node.get(accessorId)\n          for (const nodeId of nodeIds) {\n            const node = self.Node.get(nodeId)\n            if (node) {\n              node.removeEdge('parent', accessor)\n              accessor.removeEdge('child', node)\n\n              node.addEdge('parent', target)\n              target.addEdge('child', node)\n            }\n          }\n        }\n\n        self.clearSelectedNodes()\n      },\n\n      copySelectedNodes(): void {\n        //\n      },\n\n      linkSelectedNodes(target: Instance<typeof Node>): void {\n        for (const nodeIds of self.selectedNodes.values()) {\n          for (const nodeId of nodeIds) {\n            const node = self.Node.get(nodeId)\n            if (node) {\n              node.addEdge('parent', target)\n              target.addEdge('child', node)\n            }\n          }\n        }\n\n        self.clearSelectedNodes()\n      },\n\n      unlinkSelectedNodes(): void {\n        for (const [accessorId, nodeIds] of self.selectedNodes) {\n          const accessor = self.Node.get(accessorId)\n          for (const nodeId of nodeIds) {\n            const node = self.Node.get(nodeId)\n            if (node) {\n              node.removeEdge('parent', accessor)\n              accessor.removeEdge('child', node)\n            }\n          }\n        }\n\n        self.clearSelectedNodes()\n      },\n\n      removeSelectedNodes(): void {\n        for (const [accessorId, nodeIds] of self.selectedNodes) {\n          const accessor = self.Node.get(accessorId)\n          for (const nodeId of nodeIds) {\n            const node = self.Node.get(nodeId)\n            if (node) {\n              node.removeEdge('parent', accessor)\n              accessor.removeEdge('child', node)\n              if (node.edgeMap.get('parent').size === 0) {\n                self.deleteNode(node)\n              }\n            }\n          }\n        }\n\n        self.clearSelectedNodes()\n      },\n\n      exportSelectedItems(): Blob {\n        const itemIds = Object.values(self.selectedNodes.toJSON()).flatMap(\n          value => value,\n        ) as Array<string>\n\n        const snapshot = Object.fromEntries(\n          itemIds.map(id => [id, processExportNode(id, itemIds)]),\n        )\n\n        return new Blob([JSON.stringify(snapshot, null, 2)], {\n          type: 'application/json',\n        })\n      },\n\n      exportAllItems(): Blob | void {\n        return new Blob([JSON.stringify(getSnapshot(self), null, 2)], {\n          type: 'application/json',\n        })\n      },\n\n      importItems(file: File): void {\n        file\n          .text()\n          .then(text => JSON.parse(text))\n          .then(json => applySnapshot(self, json))\n          .catch(error => {\n            throw Error(`Import error ${error}`)\n          })\n      },\n    }\n  })\n\n  .actions(self => ({\n    afterCreate() {\n      persist(self)\n        .then(() => {\n          if (!self.rootNode) {\n            const rootNode = self.createNode('Node', { content: 'Locus' })\n            applySnapshot(self.Config, {\n              system: {\n                id: 'system',\n                items: {\n                  rootNodeId: rootNode.id,\n                  selectedNodes: {},\n                  lastSelectedNodeId: '',\n                  activeModes: [],\n                },\n              },\n            })\n          }\n        })\n        .catch(e => {\n          console.error('Persist error', e)\n        })\n    },\n\n    createChild<T extends IAnyModelType>(\n      node: Instance<typeof Node>,\n      edgeProps: SnapshotIn<T>,\n      edgeType = 'Node',\n    ): Instance<typeof Node> {\n      const child = self.createNode(edgeType, edgeProps)\n\n      node.addEdge('child', child)\n      child.addEdge('parent', node)\n\n      return child\n    },\n\n    deleteNode(node: Instance<typeof Node>) {\n      self.Node.delete(node.id)\n    },\n  }))\n\n  .views(self => ({\n    get rootNode() {\n      const config = self.Config.get('system')\n      return self.Node.get(config?.get('rootNodeId'))\n    },\n\n    get activeModes() {\n      const config = self.Config.get('system')\n      return config?.get('activeModes')\n    },\n\n    get selectedNodes() {\n      const config = self.Config.get('system')\n      return config?.get('selectedNodes')\n    },\n\n    get lastSelectedNode() {\n      const config = self.Config.get('system')\n      return self.Node.get(config?.get('lastSelectedNodeId'))\n    },\n\n    get selectedNodeCount() {\n      let count = 0\n\n      for (const [, value] of self.selectedNodes) {\n        count += value.length\n      }\n\n      return count\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { AppBar, Box } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { TitleBar } from 'common'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    appBar: {},\n    actions: {\n      width: '100%',\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    children: {},\n  }),\n)\n\ninterface LayoutProps {\n  title?: string\n  actions?: React.ReactElement\n  className?: string\n}\n\nexport const Layout: React.FunctionComponent<LayoutProps> = ({\n  title,\n  actions,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  return (\n    <Box className={[classes.root, className].join(' ')}>\n      <AppBar elevation={0} position=\"sticky\" className={classes.appBar}>\n        <TitleBar title={title} />\n        {actions}\n      </AppBar>\n      <Box className={classes.children}>{children}</Box>\n    </Box>\n  )\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Typography, Toolbar, IconButton } from '@material-ui/core'\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Link } from '@reach/router'\n\nimport { makeUrl } from 'route'\nimport { isRootPath } from 'common'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n\n    backButton: {\n      cursor: 'pointer',\n      '&[disabled]': {\n        visibility: 'hidden',\n        pointerEvents: 'none',\n      },\n\n      '&:hover': {\n        color: theme.palette.primary.main,\n      },\n\n      transition: theme.transitions.create(['color', 'background'], {\n        duration: theme.transitions.duration.shortest,\n      }),\n    },\n\n    hide: {\n      visibility: 'hidden',\n      mouseEvents: 'none',\n    },\n\n    settingsButton: {},\n\n    title: {\n      flexGrow: 1,\n      textAlign: 'center',\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      color: theme.palette.text.primary,\n    },\n  }),\n)\n\ninterface TitleBarProps {\n  title?: string\n  showBackButton?: boolean\n  showSettingsButton?: boolean\n  className?: string\n}\n\nexport const TitleBar: React.FunctionComponent<TitleBarProps> = ({\n  title,\n  showBackButton,\n  showSettingsButton,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  const newlinePosition = title?.indexOf('\\n') ?? -1\n\n  return (\n    <Toolbar className={[classes.root, className].join(' ')}>\n      <IconButton\n        disabled={isRootPath()}\n        edge=\"start\"\n        aria-label=\"back\"\n        onClick={() => window.history.back()}\n        className={[\n          classes.backButton,\n          showBackButton ? '' : classes.hide,\n        ].join(' ')}\n      >\n        <ChevronLeftIcon />\n      </IconButton>\n\n      {title && (\n        <Typography variant=\"h6\" component=\"h1\" className={classes.title}>\n          {newlinePosition > 0 ? title.slice(0, title.indexOf('\\n')) : title}\n        </Typography>\n      )}\n\n      <IconButton\n        disabled\n        edge=\"end\"\n        component={Link}\n        to={makeUrl(`/settings`)}\n        aria-label=\"settings\"\n        className={[\n          classes.settingsButton,\n          showSettingsButton ? '' : classes.hide,\n        ].join(' ')}\n      >\n        {<SettingsIcon fontSize=\"small\" />}\n      </IconButton>\n    </Toolbar>\n  )\n}\n\nTitleBar.defaultProps = {\n  title: 'Exuo',\n  showBackButton: true,\n  showSettingsButton: false,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport {\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemSecondaryAction,\n  ListItemText,\n  ListSubheader,\n  Switch,\n} from '@material-ui/core'\nimport PlaylistAddCheckIcon from '@material-ui/icons/PlaylistAddCheck'\nimport BorderAllIcon from '@material-ui/icons/BorderAll'\nimport AccountTreeIcon from '@material-ui/icons/AccountTree'\n\nimport { Layout } from 'common'\nimport { useGraph } from 'graph'\n\nexport const Settings: React.FunctionComponent = observer(() => {\n  const graph = useGraph()\n  return (\n    <Layout>\n      <List subheader={<ListSubheader>Global</ListSubheader>}>\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n      <List subheader={<ListSubheader>Lists</ListSubheader>}>\n        <ListItem>\n          <ListItemIcon>\n            <PlaylistAddCheckIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-checkboxes\"\n            primary=\"Checkboxes\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              checked={graph.listCheckboxSetting ?? false}\n              onChange={() => graph.toggleListCheckboxSetting()}\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-checkboxes',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <AccountTreeIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-bluetooth\"\n            primary=\"Show Extra Edge Types\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{ 'aria-labelledby': 'switch-list-label-bluetooth' }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n    </Layout>\n  )\n})\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { makeUrl } from 'route'\n\nexport function saveBlob(blob: Blob, name?: string): void {\n  const url = URL.createObjectURL(blob)\n  const el = document.createElement('a')\n\n  el.href = url\n  el.download = name ?? ''\n  el.setAttribute('style', \"'display: 'none'\")\n\n  document.body.appendChild(el)\n  el.click()\n  document.body.removeChild(el)\n  URL.revokeObjectURL(url)\n}\n\nexport function selectFile(\n  accept: string,\n  callback: (files: FileList) => void,\n): void {\n  const el = document.createElement('input')\n\n  el.type = 'file'\n  el.accept = accept\n  el.setAttribute('style', 'display: none')\n\n  el.oninput = () => {\n    if (el.files?.length) {\n      callback(el.files)\n    }\n  }\n\n  document.body.appendChild(el)\n  el.click()\n  document.body.removeChild(el)\n}\n\nexport const isRootPath = (): boolean =>\n  window.location.pathname === makeUrl('/') ||\n  window.location.pathname === makeUrl()\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport { Box, Button, Typography, CircularProgress } from '@material-ui/core'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { useNavigate } from '@reach/router'\n\nimport { Layout } from 'common'\nimport { makeUrl } from 'route'\nimport { useGraph } from 'graph'\n\ninterface PeerConnectorProps {\n  id?: string\n}\n\nexport const PeerConnector: React.FunctionComponent<PeerConnectorProps> = observer(\n  ({ id }) => {\n    const [peerError, setPeerError] = React.useState<null | Error>(null)\n    const [hasAccepted, setHasAccepted] = React.useState(false)\n    const navigate = useNavigate()\n    const graph = useGraph()\n\n    const handleAccept: React.EventHandler<React.SyntheticEvent> = () => {\n      setHasAccepted(true)\n      graph\n        .seekPeerConnection(id)\n        .then((instance: IAnyStateTreeNode) => {\n          navigate(makeUrl(`/node/${instance.id}`))\n        })\n        .catch((error: Error) => {\n          setPeerError(error)\n        })\n    }\n\n    return (\n      <Layout>\n        <Typography align=\"center\">\n          Someone wants to share content with you.\n          <br />\n          Do not accept if you do not trust them.\n        </Typography>\n        <Box mt={1} textAlign=\"center\">\n          {peerError ? (\n            <Typography color=\"error\">{peerError}</Typography>\n          ) : (\n            <Button\n              disabled={hasAccepted}\n              onClick={handleAccept}\n              color=\"primary\"\n            >\n              {hasAccepted ? <CircularProgress size={24} /> : 'Accept'}\n            </Button>\n          )}\n        </Box>\n      </Layout>\n    )\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport * as reach from '@reach/router'\n\nimport { useGraph } from 'graph'\nimport { NodeViewer } from 'graph'\nimport { PeerConnector } from 'peer'\nimport { Settings } from 'common'\n\n// Necessary for now because this routing library is bad.\nexport function makeUrl(path = ''): string {\n  return process.env.PUBLIC_URL + path\n}\n\nexport type RouteProps<T = unknown> = {\n  component: React.FunctionComponent<T>\n} & reach.RouteComponentProps\n\nexport const Route: React.FunctionComponent<RouteProps> = ({\n  component: Component,\n  ...props\n}) => <Component {...props} />\n\nexport const Router: React.FunctionComponent = observer(() => {\n  const graph = useGraph()\n  return graph.rootNode ? (\n    <reach.Router basepath={process.env.PUBLIC_URL}>\n      <Route path=\"/\" component={NodeViewer} />\n      <Route path=\":type/:id\" component={NodeViewer} />\n      <Route path=\"peer/:id\" component={PeerConnector} />\n      <Route path=\"settings\" component={Settings} />\n    </reach.Router>\n  ) : null\n})\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types } from 'mobx-state-tree'\nimport { convertToRaw } from 'draft-js'\n\nimport { nodeFactory } from 'graph'\n\n// Avoid circular dependency issue\nimport { Unknown } from 'graph/models/Unknown'\n\nconst NoteBase = types\n  .model('Note', {\n    content: types.maybe(Unknown),\n  })\n  .actions(self => ({\n    setContent(value: ReturnType<typeof convertToRaw>) {\n      self.content = value\n    },\n  }))\n\nexport const Note = nodeFactory(NoteBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport {\n  ClickAwayListener,\n  Backdrop,\n  Button,\n  IconButton,\n  Theme,\n  Toolbar,\n  createStyles,\n  Fade,\n  fade,\n  makeStyles,\n  useMediaQuery,\n} from '@material-ui/core'\nimport Code from '@material-ui/icons/Code'\nimport FormatQuoteIcon from '@material-ui/icons/FormatQuote'\nimport FormatBoldIcon from '@material-ui/icons/FormatBold'\nimport FormatItalicIcon from '@material-ui/icons/FormatItalic'\nimport FormatUnderlinedIcon from '@material-ui/icons/FormatUnderlined'\nimport SpaceBar from '@material-ui/icons/SpaceBar'\nimport FormatListNumberedIcon from '@material-ui/icons/FormatListNumbered'\nimport FormatListBulletedIcon from '@material-ui/icons/FormatListBulleted'\nimport {\n  ContentBlock,\n  ContentState,\n  DraftEditorCommand,\n  DraftHandleValue,\n  Editor,\n  EditorState,\n  RichUtils,\n  getDefaultKeyBinding,\n  convertFromRaw,\n  convertToRaw,\n} from 'draft-js'\nimport 'draft-js/dist/Draft.css'\n\nimport { Note } from './models/Note'\n\nexport const isPlainText = (\n  contentState: string | ReturnType<typeof convertToRaw>,\n): boolean => {\n  if (typeof contentState === 'string') {\n    return true\n  }\n\n  for (const block of contentState.blocks) {\n    if (\n      block.depth ||\n      block.type !== 'unstyled' ||\n      block.inlineStyleRanges.length\n    ) {\n      return false\n    }\n  }\n\n  return true\n}\n\ninterface ButtonConfig {\n  label: string\n  style: string\n  icon?: React.ReactElement\n}\n\nconst BLOCK_TYPES: Array<ButtonConfig> = [\n  {\n    label: 'UL',\n    style: 'unordered-list-item',\n    icon: <FormatListBulletedIcon />,\n  },\n  { label: 'OL', style: 'ordered-list-item', icon: <FormatListNumberedIcon /> },\n  { label: 'Blockquote', style: 'blockquote', icon: <FormatQuoteIcon /> },\n  { label: 'Code Block', style: 'code-block', icon: <Code /> },\n]\n\nconst INLINE_STYLES: Array<ButtonConfig> = [\n  { label: 'Bold', style: 'BOLD', icon: <FormatBoldIcon /> },\n  { label: 'Italic', style: 'ITALIC', icon: <FormatItalicIcon /> },\n  { label: 'Underline', style: 'UNDERLINE', icon: <FormatUnderlinedIcon /> },\n  { label: 'Monospace', style: 'CODE', icon: <SpaceBar /> },\n]\n\nconst getBlockStyle = (block: ContentBlock): string => {\n  switch (block.getType()) {\n    case 'blockquote':\n      return 'RichEditor-blockquote'\n    default:\n      return ''\n  }\n}\n\ninterface StyleButtonProps {\n  onToggle: (inlineStyle: string) => void\n  style: string\n  active: boolean\n  label: string\n  icon?: React.ReactElement\n}\n\nconst StyleButton: React.FunctionComponent<StyleButtonProps> = ({\n  onToggle,\n  style,\n  active,\n  label,\n  icon,\n}) => {\n  const onToggleWrap: React.EventHandler<React.SyntheticEvent> = e => {\n    e.preventDefault()\n    onToggle(style)\n  }\n\n  let className = 'RichEditor-styleButton'\n  if (active) {\n    className += ' RichEditor-activeButton'\n  }\n\n  return icon ? (\n    <IconButton size=\"small\" onMouseDown={onToggleWrap} className={className}>\n      {icon}\n    </IconButton>\n  ) : (\n    <Button\n      size=\"small\"\n      startIcon={icon ? icon : undefined}\n      onMouseDown={onToggleWrap}\n      className={className}\n    >\n      {icon ? '' : label}\n    </Button>\n  )\n}\n\ninterface BlockStyleControlsProps {\n  editorState: EditorState\n  onToggle: (style: string) => void\n}\n\nconst BlockStyleControls: React.FunctionComponent<BlockStyleControlsProps> = ({\n  editorState,\n  onToggle,\n}) => {\n  const selection = editorState.getSelection()\n  const blockType = editorState\n    .getCurrentContent()\n    .getBlockForKey(selection.getStartKey())\n    .getType()\n\n  return (\n    <div>\n      {BLOCK_TYPES.map(type => (\n        <StyleButton\n          key={type.label}\n          active={type.style === blockType}\n          label={type.label}\n          icon={type.icon}\n          onToggle={onToggle}\n          style={type.style}\n        />\n      ))}\n    </div>\n  )\n}\n\ninterface InlineStyleControlsProps {\n  editorState: EditorState\n  onToggle: (style: string) => void\n}\n\nconst InlineStyleControls: React.FunctionComponent<InlineStyleControlsProps> = ({\n  editorState,\n  onToggle,\n}) => {\n  const currentStyle = editorState.getCurrentInlineStyle()\n  return (\n    <div>\n      {INLINE_STYLES.map(type => (\n        <StyleButton\n          key={type.label}\n          active={currentStyle.has(type.style)}\n          label={type.label}\n          icon={type.icon}\n          onToggle={onToggle}\n          style={type.style}\n        />\n      ))}\n    </div>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n    },\n\n    wrapper: {\n      '.multiLine &': {\n        boxShadow: `0 0 ${theme.spacing(2)}px ${theme.spacing(2)}px ${\n          theme.palette.background.default\n        }`,\n      },\n\n      background: `\n        linear-gradient(\n          to top,\n          ${fade(theme.palette.background.default, 0)},\n          ${fade(theme.palette.background.default, 1)} \\\n            ${theme.spacing(1) / 2}px calc(100% - ${theme.spacing(1) / 2}px),\n          ${fade(theme.palette.background.default, 0)}\n        ),\n        linear-gradient(\n          to right,\n          ${theme.palette.primary.main},\n          ${theme.palette.secondary.main} \n        )\n      `,\n    },\n\n    backdrop: {\n      backgroundColor: fade(theme.palette.background.default, 0.8),\n    },\n\n    inputWrapper: {\n      outline: 'none',\n      maxHeight: '50vh',\n      overflowY: 'auto',\n\n      '& .DraftEditor-editorContainer': {\n        border: 0,\n\n        '& > [contentEditable=true]': {\n          padding: theme.spacing(1, 2, 1, 2),\n        },\n\n        '& [data-contents=true] > [data-block=true]': {\n          ...theme.typography.body2,\n          '&:first-child': {\n            ...theme.typography.body1,\n          },\n        },\n      },\n    },\n\n    toolbar: {\n      justifyContent: 'center',\n\n      // Tool button group spacing\n      '&>div:first-child': {\n        marginRight: theme.spacing(4),\n      },\n    },\n  }),\n)\n\n// TODO autofocus doesn't work on iOS12\n\ninterface NoteEditorProps {\n  note?: Instance<typeof Note>\n  text?: string\n  rawContent?: ReturnType<typeof convertToRaw>\n  placeholder?: string\n  autoFocus?: boolean\n  showBackdrop?: boolean\n  showControls?: boolean\n  showRichTextControls?: boolean\n  className?: string\n  wrapperClassName?: string\n  inputClassName?: string\n  onValue?: (\n    value?: Instance<typeof Note> | ContentState,\n    event?: React.KeyboardEvent | React.MouseEvent<HTMLDocument>,\n  ) => void | true\n  onClickAway?: () => void\n  onEscape?: () => void\n}\n\nexport const NoteEditor = React.forwardRef<HTMLDivElement, NoteEditorProps>(\n  function (\n    {\n      note,\n      text,\n      rawContent,\n      placeholder,\n      autoFocus,\n      showBackdrop,\n      showControls,\n      showRichTextControls,\n      className,\n      wrapperClassName,\n      inputClassName,\n      onValue,\n      onClickAway,\n      onEscape,\n    },\n    ref,\n  ) {\n    const classes = useStyles()\n\n    const containerRef = React.useRef<HTMLDivElement>(null)\n    const editorRef = React.useRef<Editor>(null)\n    const backdropRef = React.useRef<HTMLDivElement>(null)\n\n    const nodeContent = note?.nodeContent\n    const contentState = React.useMemo(\n      () =>\n        (nodeContent && convertFromRaw(JSON.parse(nodeContent))) ||\n        (rawContent && convertFromRaw(rawContent)),\n      [nodeContent, rawContent],\n    )\n\n    const [editorState, setEditorState] = React.useState(() =>\n      EditorState.createWithContent(\n        contentState ||\n          ContentState.createFromText(text ?? note?.content ?? ''),\n      ),\n    )\n\n    const isMobile = useMediaQuery('(pointer: coarse) and (hover: none)')\n    const [submitOnReturn, setSubmitOnReturn] = React.useState(!isMobile)\n\n    const [key, setKey] = React.useState(1)\n    const incrementKey = (): void => setKey(key + 1)\n\n    // Focus every time Editor is regenerated\n    React.useEffect(() => {\n      if (autoFocus) {\n        setEditorState(EditorState.moveFocusToEnd(editorState))\n      }\n    }, [key]) // eslint-disable-line react-hooks/exhaustive-deps\n\n    /* React.useEffect(() => { */\n    /*   containerRef.current?.scrollIntoView(false) */\n    /* }) */\n\n    const handleValue = (\n      event?:\n        | React.KeyboardEvent<HTMLInputElement>\n        | React.MouseEvent<HTMLDocument>,\n    ): void => {\n      const contentState = editorState.getCurrentContent()\n      const rawContent = convertToRaw(contentState)\n\n      if (note) {\n        note.setRawContentState(rawContent)\n        note.setContent(contentState.getFirstBlock().getText())\n      }\n\n      if (\n        onValue?.(\n          note || isPlainText(rawContent)\n            ? contentState.getPlainText()\n            : rawContent,\n          event,\n        )\n      ) {\n        // Tell React to re-render Editor if NoteEditor doesn't unmount.\n        // Hopefully this takes care of some weird state issues on iOS?\n        // This might be appropriate to hoist and use only when Editor\n        // creates many records.\n        incrementKey()\n\n        // TODO Seems to throw a deprecation notice in Chrome sometimes?\n        // It also might not be necessary with the above re-render hack.\n        setEditorState(\n          EditorState.forceSelection(\n            EditorState.push(\n              EditorState.moveFocusToEnd(editorState),\n              ContentState.createFromText(''),\n              'remove-range',\n            ),\n            contentState.getSelectionAfter(),\n          ),\n        )\n      }\n    }\n\n    const handleClickAway = (event: React.MouseEvent<HTMLDocument>): void => {\n      if (onClickAway) {\n        onClickAway()\n      } else {\n        handleValue(event)\n      }\n    }\n\n    const handleKeyCommand = (\n      command: DraftEditorCommand,\n      editorState: EditorState,\n    ): DraftHandleValue => {\n      const newState = RichUtils.handleKeyCommand(editorState, command)\n      if (newState) {\n        setEditorState(newState)\n        return 'handled'\n      } else {\n        return 'not-handled'\n      }\n    }\n\n    const mapKeyToEditorCommand = (\n      event: React.KeyboardEvent,\n    ): DraftEditorCommand | null => {\n      if (event.keyCode === 13) {\n        if (\n          (submitOnReturn && !event.shiftKey) ||\n          (!submitOnReturn && event.shiftKey)\n        ) {\n          handleValue()\n          return null\n        } else {\n          setSubmitOnReturn(false)\n          return getDefaultKeyBinding(event)\n        }\n      } else if (event.keyCode === 27) {\n        onEscape?.()\n        return null\n      } else {\n        return getDefaultKeyBinding(event)\n      }\n    }\n\n    const toggleBlockType = (blockType: string): void => {\n      setEditorState(RichUtils.toggleBlockType(editorState, blockType))\n    }\n\n    const toggleInlineStyle = (inlineStyle: string): void => {\n      setEditorState(RichUtils.toggleInlineStyle(editorState, inlineStyle))\n    }\n\n    const blockCount = editorState.getCurrentContent().getBlocksAsArray().length\n\n    // TODO Get Backdrop, ClickAwayListener, and Fade out of here.\n    // It's all rendering on every keystroke. Cut as much as you\n    // can out of this component.\n\n    return (\n      <div\n        ref={ref}\n        className={[\n          classes.root,\n          // TODO multiLine should just take measurements, there is\n          // no other reliable way to know this will overlap other\n          // things and require a shadow.\n          blockCount > 1 ? 'multiLine' : null,\n          className,\n        ].join(' ')}\n      >\n        <Backdrop\n          ref={backdropRef}\n          open={Boolean(blockCount > 1 && showBackdrop)}\n          className={classes.backdrop}\n          transitionDuration={1500}\n        />\n        <ClickAwayListener\n          mouseEvent={'onMouseDown'}\n          touchEvent={'onTouchStart'}\n          onClickAway={handleClickAway}\n        >\n          <Fade in={true} timeout={300}>\n            <div\n              ref={containerRef}\n              className={[classes.wrapper, wrapperClassName].join(' ')}\n            >\n              <div\n                tabIndex={-1}\n                className={[classes.inputWrapper, inputClassName].join(' ')}\n              >\n                <Editor\n                  key={key}\n                  ref={editorRef}\n                  blockStyleFn={getBlockStyle}\n                  editorState={editorState}\n                  handleKeyCommand={handleKeyCommand}\n                  keyBindingFn={mapKeyToEditorCommand}\n                  onChange={setEditorState}\n                  placeholder={placeholder}\n                  spellCheck={true}\n                />\n              </div>\n\n              {blockCount > 1 && showControls && (\n                <Toolbar variant=\"dense\" className={classes.toolbar}>\n                  {showRichTextControls && (\n                    <>\n                      <InlineStyleControls\n                        editorState={editorState}\n                        onToggle={toggleInlineStyle}\n                      />\n                      <BlockStyleControls\n                        editorState={editorState}\n                        onToggle={toggleBlockType}\n                      />\n                    </>\n                  )}\n                </Toolbar>\n              )}\n            </div>\n          </Fade>\n        </ClickAwayListener>\n      </div>\n    )\n  },\n)\n\nNoteEditor.defaultProps = {\n  showBackdrop: false,\n  showControls: false,\n  showRichTextControls: true,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport {\n  Collapse,\n  Button,\n  ListItem,\n  ListItemSecondaryAction,\n  ListItemText,\n} from '@material-ui/core'\nimport { createStyles, makeStyles, fade, Theme } from '@material-ui/core/styles'\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\nimport KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown'\nimport { Instance } from 'mobx-state-tree'\nimport { useNavigate } from '@reach/router'\nimport { useDrag, useDrop, XYCoord } from 'react-dnd'\n\nimport { makeUrl } from 'route'\nimport { NoteEditor } from 'note'\nimport { useGraph, Node, EdgeList, useActive } from 'graph'\n\nconst isEditingBorderSelector = `&.isEditing, &.isEditing + li,\\\n  &.isEditing + .MuiCollapse-container > .MuiCollapse-wrapper > .MuiCollapse-wrapperInner > .MuiList-root > .MuiListItem-container:first-child`\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    listItemContainer: {\n      borderTop: `.1px solid ${theme.palette.divider}`,\n      background: theme.palette.background.default,\n\n      [isEditingBorderSelector]: {\n        borderTop: `.1px solid transparent`,\n\n        // TODO Active cursor effect remains?\n        // Make it less apparent for now.\n        background: 'unset !important',\n      },\n\n      transition: theme.transitions.create(['color', 'background', 'border'], {\n        duration: theme.transitions.duration.shortest,\n      }),\n\n      // TODO Mode stuff is boggled.\n      cursor: 'pointer',\n\n      '&:hover': {\n        color: theme.palette.primary.main,\n        background: theme.palette.background.paper,\n      },\n\n      '&.isEditing, .editMode &, .selectMode &': {\n        cursor: 'default',\n        color: 'unset',\n      },\n    },\n\n    listItem: {\n      position: 'relative',\n\n      '&.Mui-selected': {\n        background: `\n          linear-gradient(\n            to top,\n            ${fade(theme.palette.background.default, 0)},\n            ${fade(theme.palette.background.default, 0.9)} \\\n              ${theme.spacing(1) / 2}px calc(100% - ${theme.spacing(1) / 2}px),\n            ${fade(theme.palette.background.default, 0)}\n          ),\n          linear-gradient(\n            to right,\n            ${theme.palette.primary.main},\n            ${theme.palette.secondary.main} \n          )\n        `,\n\n        '&:hover': { color: 'unset' },\n        '& a:hover': { color: 'unset' },\n      },\n    },\n\n    childList: {\n      marginLeft: theme.spacing(4),\n      padding: 0,\n    },\n\n    itemText: {\n      margin: 0,\n\n      '.isDragging &': {\n        opacity: 0,\n      },\n\n      '&, & .MuiListItemText-secondary': {\n        overflowX: 'hidden',\n        whiteSpace: 'nowrap',\n        textOverflow: 'ellipsis',\n      },\n\n      '& .MuiListItemText-primary': {\n        display: 'inline',\n      },\n\n      '& .MuiListItemText-secondary': {\n        paddingLeft: theme.spacing(1),\n      },\n\n      '&.expand': {\n        '& .MuiListItemText-secondary': {\n          display: 'block',\n          paddingLeft: 0,\n        },\n      },\n    },\n\n    listItemSelectCheckbox: {\n      padding: theme.spacing(0, 1, 0, 1),\n      '&:hover, &.Mui-checked:hover': {\n        backgroundColor: 'unset',\n      },\n    },\n\n    listItemIcon: {\n      minWidth: 'auto',\n    },\n\n    noteEditor: {\n      // Account for layout's bottom toolbar\n      marginBottom: theme.spacing(8) + 1,\n      zIndex: theme.zIndex.appBar,\n\n      cursor: 'default',\n      position: 'absolute',\n      top: 0,\n      left: 0,\n    },\n\n    noteEditorInput: {\n      cursor: 'text',\n    },\n\n    secondaryActions: {\n      display: 'none',\n\n      '.isDragging &': {\n        opacity: 0,\n      },\n\n      '&.hasChild, .selectMode &': {\n        display: 'unset',\n      },\n\n      right: 0,\n    },\n\n    edgeArrow: {\n      cursor: 'default',\n      color: theme.palette.text.hint,\n\n      '&:hover': {\n        background: 'inherit',\n      },\n\n      '.isExpanded &': {\n        color: theme.palette.text.primary,\n      },\n\n      '.selectMode &': {\n        cursor: 'pointer',\n        '&:hover': {\n          color: theme.palette.primary.main,\n        },\n      },\n\n      transition: theme.transitions.create(['color'], {\n        duration: theme.transitions.duration.shortest,\n      }),\n\n      // Ensure ChevronRight lines up without a label\n      minWidth: 'unset',\n\n      paddingRight: theme.spacing(2),\n      paddingLeft: theme.spacing(2),\n    },\n  }),\n)\n\ninterface DragItem {\n  type: string\n  index: number\n  path: string\n  parentNode: Instance<typeof Node>\n  childNode: Instance<typeof Node>\n}\n\ninterface NodeListItemProps {\n  node: Instance<typeof Node>\n  parentNode: Instance<typeof Node>\n  expandSecondaryTypography?: boolean\n  className?: string\n  index: number\n  moveItem: (item: DragItem, dragIndex: number, hoverIndex: number) => void\n  onContextMenu?: React.EventHandler<React.MouseEvent>\n}\n\nexport const NodeListItem: React.FunctionComponent<NodeListItemProps> = observer(\n  ({\n    node,\n    parentNode,\n    expandSecondaryTypography,\n    className,\n    index,\n    moveItem,\n    onContextMenu,\n  }) => {\n    const classes = useStyles()\n    const listItemRef = React.useRef<HTMLLIElement>(null)\n    const navigate = useNavigate()\n    const graph = useGraph()\n    const modes = graph.activeModes\n    const active = useActive()\n    const view = active.view\n\n    const [isEditing, setIsEditing] = React.useState(false)\n    const isSelected = graph.selectedNodes.get(parentNode.id)?.includes(node.id)\n    const isExpanded =\n      view?.getItem(`${parentNode.id}/${node.id}`)?.expanded ?? false\n\n    const toggleExpand = (): void => {\n      const view = active.initView()\n      const item = view.initItem(`${parentNode.id}/${node.id}`)\n      item.setExpanded(!item.expanded)\n    }\n\n    const handleArrowClick: React.EventHandler<React.MouseEvent> = e => {\n      if (modes.includes('select') || e.metaKey) {\n        navigate(makeUrl(`/node/${node.id}/`))\n      } else {\n        toggleExpand()\n      }\n    }\n\n    const [, drop] = useDrop({\n      accept: 'Node' + parentNode.id,\n\n      hover(item: DragItem, monitor) {\n        if (!listItemRef.current) {\n          return\n        }\n\n        const dragIndex = item.index\n        const hoverIndex = index\n\n        if (dragIndex === hoverIndex) {\n          return\n        }\n\n        const hoverBoundingRect = listItemRef.current?.getBoundingClientRect()\n        const hoverMiddleY = hoverBoundingRect.height / 2\n\n        const clientOffset = monitor.getClientOffset()\n        const hoverClientY = (clientOffset as XYCoord).y - hoverBoundingRect.top\n\n        if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n          return\n        }\n\n        if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n          return\n        }\n\n        item.index = hoverIndex\n        moveItem(item, dragIndex, hoverIndex)\n      },\n    })\n\n    const [{ isDragging }, drag] = useDrag({\n      canDrag: () => (isEditing ? false : true),\n\n      item: {\n        type: 'Node' + parentNode.id,\n        path: `${parentNode.id}/${node.id}`,\n        parentNode: parentNode,\n        childNode: node,\n        index,\n      },\n\n      collect: monitor => ({\n        isDragging: monitor.isDragging(),\n      }),\n    })\n\n    const handleItemClick = (e: React.MouseEvent): void => {\n      e.preventDefault()\n\n      if (isEditing) {\n        return\n      }\n\n      if (e.altKey) {\n        graph.setActiveMode('edit')\n        setIsEditing(true)\n      } else if (e.shiftKey) {\n        setIsEditing(false)\n        graph.setActiveMode('select')\n        graph.toggleSelectNode(node, parentNode)\n      } else if (e.metaKey) {\n        navigate(makeUrl(`/node/${node.id}/`))\n      } else if (modes.includes('select')) {\n        graph.toggleSelectNode(node, parentNode)\n      } else if (modes.includes('edit')) {\n        setIsEditing(true)\n      } else {\n        navigate(makeUrl(`/node/${node.id}/`))\n      }\n    }\n\n    let primaryText\n    let secondaryText\n\n    const rawContent = node.content?.toJSON?.()\n\n    if (typeof node.content === 'string') {\n      const newlineIndex = node.content.indexOf('\\n')\n\n      primaryText =\n        newlineIndex > 0 ? node.content.slice(0, newlineIndex) : node.content\n      secondaryText =\n        newlineIndex > 0 ? node.content.slice(newlineIndex + 1) : undefined\n    } else if (rawContent?.blocks) {\n      for (const block of rawContent.blocks) {\n        if (block.text === '') continue\n\n        if (!primaryText) {\n          primaryText = block.text\n        } else if (!secondaryText) {\n          secondaryText = block.text\n        } else {\n          break\n        }\n      }\n    } else {\n      primaryText = node.id\n    }\n\n    drag(drop(listItemRef))\n\n    return (\n      <>\n        <ListItem\n          ref={listItemRef}\n          onClick={handleItemClick}\n          selected={isSelected}\n          className={classes.listItem}\n          ContainerProps={{\n            onContextMenu,\n            className: [\n              classes.listItemContainer,\n              isExpanded ? 'isExpanded' : '',\n              isDragging ? 'isDragging' : '',\n              isEditing ? 'isEditing' : '',\n              className,\n            ].join(' '),\n          }}\n        >\n          {isEditing && (\n            <NoteEditor\n              autoFocus\n              text={rawContent ? undefined : node.content}\n              rawContent={rawContent}\n              className={classes.noteEditor}\n              inputClassName={classes.noteEditorInput}\n              onValue={value => {\n                setIsEditing(false)\n                if (value) {\n                  if (typeof value === 'string') {\n                    node.setContent(value)\n                  } else if (Object.keys(value).includes('blocks')) {\n                    node.setContent(value)\n                  }\n                }\n              }}\n              onEscape={() => {\n                setIsEditing(false)\n              }}\n            />\n          )}\n\n          <ListItemText\n            primary={primaryText}\n            secondary={secondaryText}\n            className={[\n              classes.itemText,\n              expandSecondaryTypography ? 'expand' : '',\n            ].join(' ')}\n          />\n\n          <ListItemSecondaryAction\n            className={[\n              classes.secondaryActions,\n              node.childCount > 0 ? 'hasChild' : '',\n            ].join(' ')}\n          >\n            {\n              <Button\n                size=\"small\"\n                onClick={handleArrowClick}\n                className={classes.edgeArrow}\n                endIcon={\n                  isExpanded ? <KeyboardArrowDownIcon /> : <ChevronRightIcon />\n                }\n              >\n                {node.childCount > 0 && node.childCount}\n              </Button>\n            }\n          </ListItemSecondaryAction>\n        </ListItem>\n\n        {node.childCount > 0 && (\n          <Collapse in={isExpanded} timeout=\"auto\" unmountOnExit>\n            <EdgeList\n              node={node}\n              edgeTag=\"child\"\n              className={classes.childList}\n            />\n          </Collapse>\n        )}\n      </>\n    )\n  },\n)\n\nNodeListItem.defaultProps = {\n  expandSecondaryTypography: true,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport { List } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { IAnyModelType, Instance } from 'mobx-state-tree'\n\nimport { useGraph } from 'graph'\nimport { NodeListItem } from './NodeListItem'\nimport { Node } from '../models/Node'\n\ninterface DragItem {\n  type: string\n  index: number\n  path: string\n  parentNode: Instance<typeof Node>\n  childNode: Instance<typeof Node>\n}\n\ninterface EdgeListProps {\n  node: Instance<IAnyModelType>\n  edgeTag: string\n  outer?: boolean\n  className?: string\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    list: {\n      padding: 0,\n\n      '&.outer': {\n        borderBottom: `.1px solid ${theme.palette.divider}`,\n\n        '& > li:first-child': {\n          border: 0,\n        },\n      },\n    },\n  }),\n)\n\nexport const EdgeList: React.FunctionComponent<EdgeListProps> = observer(\n  ({ node, edgeTag, outer, className }) => {\n    const classes = useStyles()\n    const edges = node.edgeMap.get(edgeTag)\n    const graph = useGraph()\n    const modes = graph.activeModes\n\n    /* const [hasAnchor, setHasAnchor] = React.useState(true) */\n\n    /* React.useEffect(() => { */\n    /*   if (hasAnchor) { */\n    /*     window.scroll({ top: document.body.scrollHeight, behavior: 'smooth' }) */\n    /*   } */\n    /* }, [hasAnchor]) */\n\n    const moveItem = React.useCallback(\n      (item: DragItem, dragIndex: number, hoverIndex: number): void => {\n        item.parentNode.reorderEdge(\n          'child',\n          item.childNode,\n          hoverIndex,\n          dragIndex,\n        )\n      },\n      [],\n    )\n\n    return edges?.length ? (\n      <List\n        aria-label=\"edge list\"\n        className={[\n          classes.list,\n          outer ? 'outer' : null,\n          outer && modes.includes('edit') ? 'editMode' : null,\n          outer && modes.includes('select') ? 'selectMode' : null,\n          className,\n        ].join(' ')}\n      >\n        {edges.map((item: Instance<typeof Node>, index: number) => (\n          <NodeListItem\n            key={`${node.id}-${edgeTag}-${item.id}`}\n            index={index}\n            node={item}\n            parentNode={node}\n            moveItem={moveItem}\n          />\n        ))}\n      </List>\n    ) : null\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { makeStyles, Theme, createStyles } from '@material-ui/core/styles'\nimport { InputBase, ClickAwayListener } from '@material-ui/core'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'inline-block',\n      margin: 0,\n      padding: theme.spacing(1, 2, 1, 2),\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      ...theme.typography.body1,\n    },\n  }),\n)\n\ninterface LabelEditorProps {\n  content?: string\n  placeholder?: string\n  autoFocus?: boolean\n  className?: string\n  onValue?: (\n    value: string,\n    event?: React.KeyboardEvent<HTMLInputElement>,\n  ) => void\n}\n\nexport const LabelEditor: React.FunctionComponent<LabelEditorProps> = ({\n  content,\n  placeholder,\n  autoFocus,\n  className,\n  onValue,\n}) => {\n  const inputRef = React.useRef<HTMLInputElement>()\n  const classes = useStyles()\n  const [inputValue, setInputValue] = React.useState(content ?? '')\n\n  const [didRender, setDidRender] = React.useState(false)\n  React.useEffect(() => {\n    if (!didRender) {\n      inputRef.current?.setSelectionRange(inputValue.length, inputValue.length)\n      setDidRender(true)\n    }\n  }, [didRender, inputValue.length])\n\n  const handleValue = (event?: React.KeyboardEvent<HTMLInputElement>): void => {\n    if (onValue) {\n      setInputValue('')\n      onValue(inputValue, event)\n    }\n  }\n\n  const handleClickAway = (event: React.MouseEvent<Document>): void => {\n    // TODO don't do a create when clicking away\n    // but this is how it should work when editing an existing record\n    // so back to a create mode? D:\n    if (inputValue === '') {\n      handleValue()\n    }\n  }\n\n  const handleKeyDown = (\n    event: React.KeyboardEvent<HTMLInputElement>,\n  ): void => {\n    if (event.keyCode === 13 && !event.shiftKey) {\n      event.preventDefault()\n      handleValue(event)\n    } else if (event.keyCode === 27) {\n      // TODO escape should also exit the editor, but this is ugly to try here\n    }\n  }\n\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n    setInputValue(event.target.value)\n  }\n\n  return (\n    <ClickAwayListener onClickAway={handleClickAway}>\n      <InputBase\n        fullWidth\n        multiline\n        autoFocus={autoFocus}\n        inputRef={inputRef}\n        placeholder={placeholder}\n        value={inputValue}\n        onKeyDown={handleKeyDown}\n        onChange={handleChange}\n        inputProps={{ 'aria-label': 'text' }}\n        className={[classes.root, className].join(' ')}\n      />\n    </ClickAwayListener>\n  )\n}\n\nLabelEditor.defaultProps = {\n  placeholder: 'Text',\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { observer } from 'mobx-react-lite'\nimport {\n  IconButton,\n  ClickAwayListener,\n  Paper,\n  Popper,\n  MenuItem,\n  MenuList,\n  IconButtonProps,\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/DeleteOutlined'\nimport FlipToBackIcon from '@material-ui/icons/FlipToBackOutlined'\nimport CancelIcon from '@material-ui/icons/CancelOutlined'\nimport FolderIcon from '@material-ui/icons/FolderOutlined'\nimport FileCopyIcon from '@material-ui/icons/FileCopyOutlined'\nimport SaveAltIcon from '@material-ui/icons/SaveAlt'\nimport SelectAllIcon from '@material-ui/icons/SelectAll'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { saveBlob } from 'common'\nimport { useGraph, Node, useActive } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'inherit',\n      position: 'relative',\n    },\n\n    buttonGroup: {\n      '& .MuiButtonGroup-groupedTextHorizontal': {\n        borderRight: 'unset',\n      },\n      '& .MuiButtonGroup-grouped': {\n        minWidth: 'unset',\n      },\n    },\n\n    selectCount: {\n      color: theme.palette.primary.main,\n      fontSize: 12,\n      position: 'absolute',\n      right: -theme.spacing(1),\n    },\n\n    selectButton: {},\n\n    deleteButton: {\n      color: theme.palette.error.main,\n    },\n\n    popper: {\n      '& svg': {\n        marginRight: theme.spacing(1),\n      },\n    },\n\n    paper: {\n      border: `.1px solid ${theme.palette.divider}`,\n    },\n\n    selectMenu: {\n      outline: 0,\n    },\n  }),\n)\n\ninterface SelectButtonProps extends IconButtonProps {\n  node: Instance<typeof Node>\n  onClick: React.MouseEventHandler\n  className?: string\n}\n\nexport const SelectButton: React.FunctionComponent<SelectButtonProps> = observer(\n  ({ node, className, onClick, ...extraProps }) => {\n    const graph = useGraph()\n    const active = useActive()\n    const classes = useStyles()\n    const anchorRef = React.useRef<HTMLButtonElement>(null)\n\n    const selectedCount = graph.selectedNodeCount\n\n    const [open, setOpen] = React.useState(false)\n    const [showAltMenu, setShowAltMenu] = React.useState(false)\n\n    // Wait, ...?  Why is it adding listeners for document\n    // events? Why does it use KeyboardEvent? This whole file is\n    // a mess.\n    React.useEffect(() => {\n      const downHandler = (event: KeyboardEvent): void => {\n        if (event.key === 'Alt') {\n          setShowAltMenu(true)\n        }\n      }\n\n      const upHandler = (event: KeyboardEvent): void => {\n        if (event.key === 'Alt') {\n          setShowAltMenu(false)\n        }\n      }\n\n      document.addEventListener('keydown', downHandler)\n      document.addEventListener('keyup', upHandler)\n\n      return () => {\n        document.removeEventListener('keydown', downHandler)\n        document.removeEventListener('keyup', upHandler)\n      }\n    })\n\n    return (\n      <div className={[classes.root, className].join(' ')}>\n        {selectedCount > 0 && (\n          <span className={classes.selectCount}>{selectedCount}</span>\n        )}\n\n        <IconButton\n          color=\"primary\"\n          ref={anchorRef}\n          onClick={e => {\n            if (e.altKey) {\n              saveBlob(graph.exportAllItems())\n            } else if (graph.selectedNodes.size) {\n              setOpen(true)\n            } else {\n              onClick(e)\n            }\n          }}\n          className={classes.selectButton}\n          {...extraProps}\n        >\n          <SelectAllIcon />\n        </IconButton>\n\n        <Popper\n          open={open}\n          anchorEl={anchorRef.current}\n          role={undefined}\n          disablePortal\n          className={classes.popper}\n        >\n          {({ placement }) => (\n            <ClickAwayListener\n              mouseEvent={'onMouseDown'}\n              touchEvent={'onTouchStart'}\n              onClickAway={e => {\n                e.preventDefault()\n                setOpen(false)\n              }}\n            >\n              <Paper elevation={0} className={classes.paper}>\n                <MenuList dense className={classes.selectMenu}>\n                  <MenuItem\n                    divider\n                    onClick={() => {\n                      graph.removeSelectedNodes()\n                      setOpen(false)\n                    }}\n                    className={classes.deleteButton}\n                  >\n                    <DeleteIcon />\n                    Remove\n                  </MenuItem>\n\n                  {showAltMenu ? (\n                    <MenuItem\n                      onClick={() => {\n                        graph.linkSelectedNodes(active)\n                        setOpen(false)\n                      }}\n                    >\n                      <FlipToBackIcon />\n                      Link here\n                    </MenuItem>\n                  ) : (\n                    <MenuItem\n                      disabled\n                      onClick={() => {\n                        setOpen(false)\n                      }}\n                    >\n                      <FileCopyIcon />\n                      Copy here\n                    </MenuItem>\n                  )}\n\n                  <MenuItem\n                    divider\n                    onClick={() => {\n                      graph.moveSelectedNodes(active)\n                      setOpen(false)\n                    }}\n                  >\n                    <FolderIcon />\n                    Move here\n                  </MenuItem>\n\n                  {/* <MenuItem */}\n                  {/*   onClick={() => { */}\n                  {/*     graph.deleteSelectedNodes() */}\n                  {/*     setOpen(false) */}\n                  {/*   }} */}\n                  {/*   className={classes.deleteButton} */}\n                  {/* > */}\n                  {/*   <DeleteIcon /> */}\n                  {/*   Delete */}\n                  {/* </MenuItem> */}\n\n                  {/* <MenuItem */}\n                  {/*   divider */}\n                  {/*   onClick={() => { */}\n                  {/*     saveBlob(graph.exportSelectedItems()) */}\n                  {/*     setOpen(false) */}\n                  {/*   }} */}\n                  {/* > */}\n                  {/*   <SaveAltIcon /> */}\n                  {/*   Export */}\n                  {/* </MenuItem> */}\n\n                  <MenuItem\n                    onClick={() => {\n                      graph.clearSelectedNodes()\n                      setOpen(false)\n                    }}\n                  >\n                    <CancelIcon />\n                    Clear selection\n                  </MenuItem>\n                </MenuList>\n              </Paper>\n            </ClickAwayListener>\n          )}\n        </Popper>\n      </div>\n    )\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport {\n  Toolbar,\n  IconButton,\n  Box,\n  Button,\n  createStyles,\n  makeStyles,\n  Theme,\n  emphasize,\n  fade,\n} from '@material-ui/core'\nimport AddIcon from '@material-ui/icons/Add'\nimport EditIcon from '@material-ui/icons/Edit'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TuneIcon from '@material-ui/icons/Tune'\nimport GroupIcon from '@material-ui/icons/Group'\nimport { Instance } from 'mobx-state-tree'\n\nimport { selectFile } from 'common'\nimport { SelectButton } from 'select'\nimport { Node, useGraph } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n\n    toolbar: {\n      justifyContent: 'space-evenly',\n      [theme.breakpoints.up('sm')]: {\n        justifyContent: 'center',\n      },\n\n      minHeight: theme.spacing(8),\n\n      /* backdropFilter: 'blur(3px)', */\n      background: `\n        linear-gradient(\n          to bottom,\n          ${fade(theme.palette.background.default, 0.8)},\n          ${fade(theme.palette.background.default, 1)} 80%\n        )`,\n    },\n\n    insertButton: {\n      color: theme.palette.background.default,\n      boxShadow: 'unset',\n      margin: theme.spacing(0, 1, 0, 1),\n      background: `\n        radial-gradient(\n          circle at bottom,\n          ${theme.palette.secondary.main},\n          ${theme.palette.primary.main} 75%\n        )`,\n\n      '&:hover, &:focus': {\n        boxShadow: 'unset',\n        background: `\n        radial-gradient(\n          circle at bottom,\n          ${emphasize(theme.palette.secondary.main, 0.3)},\n          ${theme.palette.primary.main} 75%\n        )`,\n      },\n\n      '&:active': {\n        boxShadow: 'unset',\n        background: `\n        radial-gradient(\n          circle at bottom,\n          ${emphasize(theme.palette.secondary.main, 0.3)},\n          ${theme.palette.primary.main} 75%\n        )`,\n      },\n    },\n  }),\n)\n\ninterface NodeActionsProps {\n  node: Instance<typeof Node>\n  className?: string\n}\n\nexport const NodeActions: React.FunctionComponent<NodeActionsProps> = observer(\n  ({ node, className }) => {\n    const classes = useStyles()\n    const graph = useGraph()\n    const hasChildren = node.childCount > 0\n    const selectedCount = graph.selectedNodes.size ?? 0\n\n    return (\n      <Box className={[classes.root, className].join(' ')}>\n        <Toolbar className={classes.toolbar}>\n          <IconButton\n            disabled\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <SearchIcon />\n          </IconButton>\n\n          <IconButton\n            disabled={!hasChildren}\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <EditIcon />\n          </IconButton>\n\n          <IconButton\n            color=\"primary\"\n            onClick={e => {\n              if (e.altKey) {\n                selectFile('.json', files => graph.importItems(files[0]))\n              } else {\n                graph.setActiveMode('insert')\n              }\n            }}\n            className={classes.insertButton}\n          >\n            <AddIcon />\n          </IconButton>\n\n          <SelectButton\n            disabled={!(hasChildren || selectedCount > 0)}\n            node={node}\n            color={graph.activeModes.includes('select') ? 'primary' : undefined}\n            onClick={() => {\n              graph.toggleActiveMode('select')\n            }}\n          />\n\n          <IconButton\n            disabled\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <TuneIcon />\n          </IconButton>\n\n          {false && (\n            <Button\n              disabled\n              startIcon={<GroupIcon />}\n              onClick={() => {\n                if (graph.activeModes.includes('share')) {\n                  graph.closePeerConnection()\n                } else {\n                  graph.offerPeerConnection(node)\n                }\n              }}\n              color={\n                graph.activeModes.includes('share') ? 'primary' : undefined\n              }\n            >\n              share\n            </Button>\n          )}\n        </Toolbar>\n      </Box>\n    )\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport { AppBar, Box, fade } from '@material-ui/core'\nimport { Instance } from 'mobx-state-tree'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { useNavigate } from '@reach/router'\n\nimport { makeUrl } from 'route'\nimport { TitleBar } from 'common'\nimport { NoteEditor } from 'note'\n\nimport { Node, useGraph, NodeActions } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      textAlign: 'center',\n      position: 'relative',\n      paddingBottom: theme.spacing(8),\n    },\n\n    appBar: {\n      zIndex: theme.zIndex.appBar + 1,\n      position: 'sticky',\n      borderBottom: `.1px solid ${theme.palette.divider}`,\n      /* backdropFilter: 'blur(3px)', */\n      background: `\n        linear-gradient(\n          to top,\n          ${fade(theme.palette.background.default, 0.8)},\n          ${fade(theme.palette.background.default, 1)} 80%\n        )`,\n    },\n\n    titleBar: {\n      background: 'unset',\n    },\n\n    children: {},\n\n    textEditor: {\n      position: 'sticky',\n      zIndex: theme.zIndex.appBar,\n      bottom: theme.spacing(8) + 1,\n    },\n\n    actions: {\n      borderTop: `.1px solid ${theme.palette.divider}`,\n      zIndex: theme.zIndex.appBar + 1,\n\n      position: 'fixed',\n      bottom: 0,\n      left: '50%',\n      width: '100%',\n      transform: 'translateX(-50%)',\n\n      [theme.breakpoints.up('sm')]: {\n        maxWidth: '900px',\n      },\n    },\n  }),\n)\n\ninterface LayoutProps {\n  node: Instance<typeof Node>\n  className?: string\n}\n\nexport const NodeLayout: React.FunctionComponent<LayoutProps> = observer(\n  ({ node, className, children }) => {\n    const classes = useStyles()\n    const navigate = useNavigate()\n    const graph = useGraph()\n\n    const content = node.content?.toJSON?.()\n    let titleText: string\n\n    if (typeof node.content === 'string') {\n      titleText = node.content\n    } else if (content) {\n      titleText = content.blocks?.[0]?.text\n    } else {\n      titleText = node.id\n    }\n\n    return (\n      <Box className={[classes.root, className].join(' ')}>\n        <AppBar elevation={0} className={classes.appBar}>\n          <TitleBar title={titleText} className={classes.titleBar} />\n        </AppBar>\n\n        <Box\n          className={[\n            classes.children,\n            graph.activeModes.includes('insert') ? 'fade' : '',\n          ].join(' ')}\n        >\n          {children}\n        </Box>\n\n        {graph.activeModes.includes('insert') && (\n          <NoteEditor\n            autoFocus\n            className={classes.textEditor}\n            onValue={(value, event) => {\n              if (value) {\n                const child = graph.createChild(node, { content: value })\n\n                if (event?.ctrlKey) {\n                  navigate(makeUrl(`/node/${child.id}/`))\n                } else {\n                  return true\n                }\n              } else {\n                graph.toggleActiveMode('insert')\n              }\n            }}\n            onEscape={() => {\n              graph.unsetActiveMode('insert')\n            }}\n          />\n        )}\n\n        <NodeActions\n          node={node}\n          className={[\n            classes.actions,\n            graph.activeModes.includes('insert') ? 'fade' : '',\n          ].join(' ')}\n        />\n      </Box>\n    )\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport { DndProvider } from 'react-dnd'\nimport { HTML5Backend } from 'react-dnd-html5-backend'\n/* import { TouchBackend } from 'react-dnd-touch-backend' */\n\nimport { NodeLayout, EdgeList, useGraph, ActiveProvider } from 'graph'\n\ninterface NodeViewerProps {\n  id?: string\n}\n\nexport const NodeViewer: React.FunctionComponent<NodeViewerProps> = observer(\n  ({ id }) => {\n    const graph = useGraph()\n    const lookup = graph.Node.get(id)\n    const node = lookup ?? graph.rootNode\n\n    return node ? (\n      <DndProvider backend={HTML5Backend}>\n        <ActiveProvider value={node}>\n          <NodeLayout node={node}>\n            <EdgeList node={node} edgeTag=\"child\" outer />\n          </NodeLayout>\n        </ActiveProvider>\n      </DndProvider>\n    ) : null\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\n\nimport { Graph } from 'graph'\n\nimport { Store } from './models/Store'\n\nconst store = Store.create({\n  graph: Graph.create(),\n})\n\nexport const storeContext = React.createContext<Instance<typeof Store>>(store)\n\nexport const StoreProvider: React.FunctionComponent = ({ children }) =>\n  React.createElement(storeContext.Provider, { value: store }, children)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { observer } from 'mobx-react-lite'\nimport {\n  IconButton,\n  ClickAwayListener,\n  Paper,\n  Popper,\n  MenuItem,\n  Menu,\n  MenuList,\n  IconButtonProps,\n  Typography,\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/DeleteOutlined'\nimport FlipToBackIcon from '@material-ui/icons/FlipToBackOutlined'\nimport CancelIcon from '@material-ui/icons/CancelOutlined'\nimport FolderIcon from '@material-ui/icons/FolderOutlined'\nimport FileCopyIcon from '@material-ui/icons/FileCopyOutlined'\nimport SelectAllIcon from '@material-ui/icons/SelectAll'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { useGraph, Node, useActive } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'inherit',\n      position: 'relative',\n    },\n    buttonGroup: {\n      '& .MuiButtonGroup-groupedTextHorizontal': {\n        borderRight: 'unset',\n      },\n      '& .MuiButtonGroup-grouped': {\n        minWidth: 'unset',\n      },\n    },\n    selectCount: {\n      color: theme.palette.primary.main,\n      fontSize: 12,\n      position: 'absolute',\n      right: -theme.spacing(1),\n    },\n    selectButton: {},\n    deleteButton: {\n      color: theme.palette.error.main,\n    },\n    popper: {\n      '& svg': {\n        marginRight: theme.spacing(1),\n      },\n    },\n    paper: {\n      border: `.1px solid ${theme.palette.divider}`,\n    },\n    selectMenu: {\n      outline: 0,\n    },\n  }),\n)\n\nconst initialState = {\n  mouseX: null,\n  mouseY: null,\n}\n\ninterface NodeContextMenuProps {\n  node: Instance<typeof Node>\n  targetRef: React.RefObject<HTMLElement>\n}\n\n/* export type NodeContextMenu<T> = React.FunctionComponent<NodeContextMenuProps<T>> */\n\nexport const NodeContextMenu: React.FunctionComponent<NodeContextMenuProps> = ({\n  node,\n  targetRef,\n}) => {\n  const [state, setState] = React.useState<{\n    mouseX: null | number\n    mouseY: null | number\n  }>(initialState)\n\n  const handleActivate: React.MouseEventHandler<React.ReactElement> = event => {\n    event.preventDefault()\n    setState({\n      mouseX: event.clientX - 2,\n      mouseY: event.clientY - 4,\n    })\n  }\n\n  const handleClose = (): void => {\n    setState(initialState)\n  }\n\n  /* React.useEffect(() => { */\n  /*   targetRef.current?.addEventListener('contextmenu', handleActivate) */\n  /*   return () => { */\n  /*     targetRef.current?.removeEventListener('contextmenu', handleActivate) */\n  /*   } */\n  /* }, [targetRef]) */\n\n  return (\n    <Menu\n      keepMounted\n      open={state.mouseY !== null}\n      onClose={handleClose}\n      anchorReference=\"anchorPosition\"\n      anchorPosition={\n        state.mouseY !== null && state.mouseX !== null\n          ? { top: state.mouseY, left: state.mouseX }\n          : undefined\n      }\n    >\n      <MenuItem onClick={handleClose}>Copy</MenuItem>\n      <MenuItem onClick={handleClose}>Print</MenuItem>\n      <MenuItem onClick={handleClose}>Highlight</MenuItem>\n      <MenuItem onClick={handleClose}>Email</MenuItem>\n    </Menu>\n  )\n}\n\n/* interface NodeContextMenuProps extends IconButtonProps { */\n/*   node: Instance<typeof Node> */\n/*   onClick: React.MouseEventHandler */\n/*   className?: string */\n/* } */\n\n/* export const NodeContextMenu: React.FunctionComponent<NodeContextMenuProps> = observer( */\n/*   ({ node, className, onClick, ...extraProps }) => { */\n/*     const classes = useStyles() */\n/*     const [open, setOpen] = React.useState(false) */\n/*     const anchorRef = React.useRef<HTMLButtonElement>(null) */\n/*     const active = useActive() */\n/*     const [showAltMenu, setShowAltMenu] = React.useState(false) */\n\n/*     React.useEffect(() => { */\n/*       const downHandler = (event: KeyboardEvent): void => { */\n/*         if (event.key === 'Alt') { */\n/*           setShowAltMenu(true) */\n/*         } */\n/*       } */\n\n/*       const upHandler = (event: KeyboardEvent): void => { */\n/*         if (event.key === 'Alt') { */\n/*           setShowAltMenu(false) */\n/*         } */\n/*       } */\n\n/*       document.addEventListener('keydown', downHandler) */\n/*       document.addEventListener('keyup', upHandler) */\n\n/*       return () => { */\n/*         document.removeEventListener('keydown', downHandler) */\n/*         document.removeEventListener('keyup', upHandler) */\n/*       } */\n/*     }) */\n\n/*     const graph = useGraph() */\n\n/*     const selectedCount = graph.selectedNodeCount */\n/*     return ( */\n/*       <div className={[classes.root, className].join(' ')}> */\n/*         {selectedCount > 0 && ( */\n/*           <span className={classes.selectCount}>{selectedCount}</span> */\n/*         )} */\n/*         <IconButton */\n/*           color=\"primary\" */\n/*           ref={anchorRef} */\n/*           onClick={ */\n/*             graph.selectedNodes.size ? () => setOpen(value => !value) : onClick */\n/*           } */\n/*           className={classes.selectButton} */\n/*           {...extraProps} */\n/*         > */\n/*           <SelectAllIcon /> */\n/*         </IconButton> */\n/*         <Popper */\n/*           open={open} */\n/*           anchorEl={anchorRef.current} */\n/*           role={undefined} */\n/*           disablePortal */\n/*           className={classes.popper} */\n/*         > */\n/*           {({ placement }) => ( */\n/*             <ClickAwayListener */\n/*               onClickAway={e => { */\n/*                 e.preventDefault() */\n/*                 setOpen(false) */\n/*               }} */\n/*             > */\n/*               <Paper elevation={0} className={classes.paper}> */\n/*                 <MenuList dense className={classes.selectMenu}> */\n/*                   <MenuItem */\n/*                     divider */\n/*                     onClick={() => { */\n/*                       graph.removeSelectedNodes() */\n/*                       setOpen(false) */\n/*                     }} */\n/*                     className={classes.deleteButton} */\n/*                   > */\n/*                     <DeleteIcon /> */\n/*                     Remove */\n/*                   </MenuItem> */\n\n/*                   {showAltMenu ? ( */\n/*                     <MenuItem */\n/*                       onClick={() => { */\n/*                         graph.linkSelectedNodes(active) */\n/*                         setOpen(false) */\n/*                       }} */\n/*                     > */\n/*                       <FlipToBackIcon /> */\n/*                       Link here */\n/*                     </MenuItem> */\n/*                   ) : ( */\n/*                     <MenuItem */\n/*                       disabled */\n/*                       onClick={() => { */\n/*                         setOpen(false) */\n/*                       }} */\n/*                     > */\n/*                       <FileCopyIcon /> */\n/*                       Copy here */\n/*                     </MenuItem> */\n/*                   )} */\n\n/*                   <MenuItem */\n/*                     divider */\n/*                     onClick={() => { */\n/*                       graph.moveSelectedNodes(active) */\n/*                       setOpen(false) */\n/*                     }} */\n/*                   > */\n/*                     <FolderIcon /> */\n/*                     Move here */\n/*                   </MenuItem> */\n\n/*                   {/1* <MenuItem *1/} */\n/*                   {/1*   onClick={() => { *1/} */\n/*                   {/1*     graph.deleteSelectedNodes() *1/} */\n/*                   {/1*     setOpen(false) *1/} */\n/*                   {/1*   }} *1/} */\n/*                   {/1*   className={classes.deleteButton} *1/} */\n/*                   {/1* > *1/} */\n/*                   {/1*   <DeleteIcon /> *1/} */\n/*                   {/1*   Delete *1/} */\n/*                   {/1* </MenuItem> *1/} */\n\n/*                   <MenuItem */\n/*                     onClick={() => { */\n/*                       graph.clearSelectedNodes() */\n/*                       setOpen(false) */\n/*                     }} */\n/*                   > */\n/*                     <CancelIcon /> */\n/*                     Clear selection */\n/*                   </MenuItem> */\n/*                 </MenuList> */\n/*               </Paper> */\n/*             </ClickAwayListener> */\n/*           )} */\n/*         </Popper> */\n/*       </div> */\n/*     ) */\n/*   }, */\n/* ) */\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types } from 'mobx-state-tree'\n\nimport { Graph } from 'graph'\n\nexport const Store = types\n  .model('Store', {\n    graph: Graph,\n    location: types.optional(types.string, '/'),\n  })\n  .actions(self => ({\n    setLocation(path: string) {\n      self.location = path\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\n\nimport { Store, storeContext } from 'store'\n\nexport function useStore(): Instance<typeof Store> {\n  const store = React.useContext(storeContext)\n  if (store) {\n    return store\n  } else {\n    throw Error('Cannot use store before setup')\n  }\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\n\nimport { NodeLayout, EdgeList } from 'graph'\n\nimport { useStore } from 'store'\n\ninterface InstanceViewerProps {\n  id?: string\n  type?: string\n}\n\nexport const InstanceViewer: React.FunctionComponent<InstanceViewerProps> = observer(\n  ({ id, type }) => {\n    const store = useStore()\n    const node = store.graph.Node.get(id)\n    let instance = store.graph.rootNode\n\n    if (node) {\n      instance = node\n    }\n\n    return instance ? (\n      <NodeLayout node={instance}>\n        <EdgeList node={instance} edgeTag=\"child\" />\n      </NodeLayout>\n    ) : null\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { observer } from 'mobx-react-lite'\nimport { List, ListItem, ListItemText } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { getMembers, Instance, isStateTreeNode } from 'mobx-state-tree'\n\nimport { useGraph, Node } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    item: {},\n    itemText: {},\n  }),\n)\n\ninterface PropertyEditorProps {\n  node?: Instance<typeof Node> | string\n  propName?: string\n  minimal?: boolean\n}\n\nexport const PropertyEditor: React.FunctionComponent<PropertyEditorProps> = observer(\n  props => {\n    const classes = useStyles()\n    const graph = useGraph()\n    let node = props.node\n\n    if (typeof node === 'string') {\n      node = graph.Node.get(props.node)\n    }\n\n    if (!isStateTreeNode(node)) {\n      return <></> // Loading\n    }\n\n    const members = getMembers(node)\n    const properties = Object.keys(members.properties)\n\n    const handleSubmit: React.EventHandler<React.SyntheticEvent> = () => {\n      console.log('submit')\n    }\n\n    return (\n      <form onSubmit={handleSubmit}>\n        <List className={classes.root}>\n          {properties.map(value => (\n            <ListItem dense button key={value} className={classes.item}>\n              <ListItemText\n                primary={value}\n                id={`list-content-${value}`}\n                className={classes.itemText}\n              />\n            </ListItem>\n          ))}\n        </List>\n      </form>\n    )\n  },\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  // https://github.com/mui-org/material-ui/issues/13394\n  // TODO Remove when Material UI v5 is out.\n  unstable_createMuiStrictModeTheme as createMuiTheme,\n  ThemeProvider as MuiThemeProvider,\n  fade,\n} from '@material-ui/core/styles'\nimport { useMediaQuery, CssBaseline, PaletteType } from '@material-ui/core'\n\nexport const useDarkMode = (): ReturnType<typeof useMediaQuery> =>\n  useMediaQuery('(prefers-color-scheme: dark)')\n\nexport const ThemeProvider: React.FunctionComponent = ({ children }) => {\n  const prefersDarkMode = useDarkMode()\n\n  const theme: ReturnType<typeof createMuiTheme> = React.useMemo(() => {\n    const palette = {\n      type: (prefersDarkMode ? 'dark' : 'light') as PaletteType,\n\n      primary: { main: '#FF2EA2' },\n      secondary: { main: '#FF8F00' },\n\n      divider: prefersDarkMode ? '#1b1b1b' : '#e0e0e0',\n\n      background: {\n        default: prefersDarkMode ? '#000000' : '#ffffff',\n        paper: prefersDarkMode ? '#101010' : '#f8f8f8',\n      },\n\n      text: {\n        primary: prefersDarkMode ? '#dddddd' : '#212121',\n        secondary: prefersDarkMode ? '#aaaaaa' : '#595959',\n      },\n    }\n\n    if (process.env.NODE_ENV === 'development') {\n      palette.primary.main = '#718C00'\n      palette.secondary.main = '#fd971f'\n    }\n\n    return createMuiTheme({\n      palette,\n\n      typography: {\n        fontFamily: [\n          '-apple-system',\n          'system-ui',\n          'BlinkMacSystemFont',\n          '\"Segoe UI\"',\n          'Roboto',\n          '\"Helvetica Neue\"',\n          'Arial',\n          'sans-serif',\n        ].join(', '),\n      },\n\n      shape: {\n        borderRadius: 6,\n      },\n\n      props: {\n        MuiButton: {\n          disableElevation: true,\n        },\n\n        MuiButtonGroup: {\n          disableElevation: true,\n        },\n      },\n\n      overrides: {\n        MuiButtonBase: {\n          root: {\n            cursor: 'default',\n          },\n        },\n\n        MuiCssBaseline: {\n          '@global': {\n            '*::selection': {\n              backgroundColor: fade(\n                palette.text.primary,\n                prefersDarkMode ? 0.3 : 0.2,\n              ),\n            },\n\n            html: {\n              userSelect: 'none',\n              overscrollBehavior: 'none',\n              '-webkit-touch-callout': 'none',\n\n              height: '100%',\n              margin: 'auto',\n              maxWidth: '900px',\n            },\n\n            body: {\n              height: '100%',\n            },\n          },\n        },\n      },\n    })\n  }, [prefersDarkMode])\n\n  return (\n    <MuiThemeProvider theme={theme}>\n      <CssBaseline />\n      {children}\n    </MuiThemeProvider>\n  )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\n/* eslint-disable no-console */\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n\n        if (installingWorker == null) {\n          return\n        }\n\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      )\n    })\n}\n\nexport function unregister(): void {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport { StoreProvider } from './store'\nimport { ThemeProvider } from './theme'\nimport { Router } from './route'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(\n  <React.StrictMode>\n    <StoreProvider>\n      <ThemeProvider>\n        <Router />\n      </ThemeProvider>\n    </StoreProvider>\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\nserviceWorker.register()\n"],"sourceRoot":""}