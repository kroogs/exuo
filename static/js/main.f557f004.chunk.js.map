{"version":3,"sources":["peer/PeerConnector.tsx","peer/index.ts","graph/utils.ts","graph/models/factories.ts","graph/models/Unknown.ts","graph/models/Node.ts","graph/models/Config.ts","graph/models/ViewerConfig.ts","graph/models/Graph.ts","note/models/Note.ts","note/NoteEditor.tsx","graph/views/NodeListItem.tsx","graph/views/EdgeList.tsx","graph/views/LabelEditor.tsx","select/SelectButton.tsx","graph/views/NodeActions.tsx","graph/views/NodeLayout.tsx","graph/views/NodeViewer.tsx","route.tsx","theme.tsx","serviceWorker.ts","index.tsx","common/Layout.tsx","common/TitleBar.tsx","common/Settings.tsx","common/utils.tsx","store/persist.ts","store/StoreProvider.tsx","store/views/PropertyEditor.tsx","store/models/Store.ts","store/useStore.ts"],"names":["PeerConnector","id","React","useState","peerError","setPeerError","hasAccepted","setHasAccepted","navigate","useNavigate","useGraph","graph","align","mt","textAlign","color","disabled","onClick","seekPeerConnection","then","instance","makeUrl","catch","error","size","selector","useStore","store","activeContext","createContext","ActiveProvider","Provider","useActive","useContext","edgeMapFactory","getEdgeType","types","model","edgeMap","map","array","safeReference","late","acceptsUndefined","actions","self","hasEdge","tag","target","Boolean","get","includes","length","addEdge","has","set","push","removeEdge","remove","getEdgeTag","nodeFactory","models","compose","identifier","concat","named","graphFactory","nodeModels","options","Object","fromEntries","keys","key","isModelType","isIdentifierType","properties","Error","createNode","modelName","props","node","create","getId","uuid","put","NodeBase","Node","Unknown","union","null","boolean","string","number","ViewerConfig","content","setContent","graphRoot","getParentOfType","Graph","getConfig","doCreate","config","views","ConfigBase","name","maybe","items","value","Config","ViewerConfigItem","expanded","optional","setExpanded","ViewerConfigBase","getItem","parentId","childId","item","console","log","setActiveMode","mode","activeModes","clearSelectedNodes","unsetActiveMode","toggleActiveMode","toggleSelectNode","parentNode","selectedNodes","nodeIds","delete","clear","deleteSelectedNodes","forEach","nodeId","moveSelectedNodes","accessorId","accessor","copySelectedNodes","linkSelectedNodes","values","unlinkSelectedNodes","removeSelectedNodes","deleteNode","afterCreate","persist","e","rootNode","applySnapshot","system","rootNodeId","createChild","edgeProps","edgeType","child","count","NoteBase","BLOCK_TYPES","label","style","icon","INLINE_STYLES","getBlockStyle","block","getType","StyleButton","onToggle","active","onToggleWrap","preventDefault","className","IconButton","onMouseDown","Button","startIcon","undefined","BlockStyleControls","editorState","selection","getSelection","blockType","getCurrentContent","getBlockForKey","getStartKey","type","InlineStyleControls","currentStyle","getCurrentInlineStyle","useStyles","makeStyles","theme","createStyles","root","width","zIndex","appBar","backdrop","cursor","backdropFilter","backgroundColor","fade","palette","background","default","wrapper","outline","spacing","primary","main","secondary","maxHeight","overflowY","border","padding","typography","body2","body1","toolbar","justifyContent","marginRight","NoteEditor","forwardRef","ref","note","text","rawContent","placeholder","autoFocus","showBackdrop","showControls","showRichTextControls","inputClassName","onValue","onClickAway","onEscape","classes","containerRef","useRef","editorRef","nodeContent","contentState","useMemo","convertFromRaw","JSON","parse","EditorState","createWithContent","ContentState","createFromText","setEditorState","isMobile","useMediaQuery","submitOnReturn","setSubmitOnReturn","useEffect","moveFocusToEnd","handleValue","event","convertToRaw","setRawContentState","getFirstBlock","getText","blocks","depth","inlineStyleRanges","isPlainText","getPlainText","forceSelection","getSelectionAfter","blockCount","getBlocksAsArray","join","Backdrop","open","ClickAwayListener","mouseEvent","touchEvent","tabIndex","blockStyleFn","handleKeyCommand","command","newState","RichUtils","keyBindingFn","keyCode","shiftKey","getDefaultKeyBinding","onChange","spellCheck","Toolbar","variant","inlineStyle","toggleInlineStyle","toggleBlockType","defaultProps","itemContainer","listItem","position","transition","transitions","duration","shortest","paper","borderColor","childList","marginLeft","itemText","margin","overflowX","whiteSpace","textOverflow","opacity","display","paddingLeft","listItemSelectCheckbox","listItemIcon","minWidth","noteEditor","top","left","noteEditorInput","secondaryActions","right","childButton","paddingRight","NodeListItem","expandSecondaryTypography","isEditing","setIsEditing","isExpanded","isSelected","primaryText","secondaryText","toJSON","newlinePosition","indexOf","slice","ListItem","altKey","selected","component","ContainerProps","childCount","ListItemText","ListItemSecondaryAction","to","Link","configItem","toggleExpand","endIcon","Collapse","in","timeout","unmountOnExit","inner","edgeTag","list","borderTop","divider","borderBottom","EdgeList","edges","List","aria-label","buttonGroup","borderRight","selectCount","fontSize","selectButton","deleteButton","popper","selectMenu","SelectButton","extraProps","setOpen","anchorRef","selectedCount","selectedNodeCount","Popper","anchorEl","current","role","disablePortal","placement","Paper","elevation","MenuList","dense","MenuItem","breakpoints","up","insertButton","boxShadow","emphasize","NodeActions","hasChildren","Box","paddingBottom","titleBar","children","textEditor","bottom","transform","maxWidth","NodeLayout","titleText","AppBar","title","ctrlKey","NodeViewer","lookup","path","process","Route","Component","Router","basepath","Settings","ThemeProvider","prefersDarkMode","createMuiTheme","fontFamily","shape","borderRadius","MuiButton","disableElevation","MuiButtonGroup","overrides","MuiButtonBase","MuiCssBaseline","html","userSelect","overscrollBehavior","height","CssBaseline","isLocalhost","window","location","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","onUpdate","onSuccess","ReactDOM","render","StrictMode","document","getElementById","URL","href","origin","addEventListener","fetch","headers","response","contentType","status","ready","unregister","reload","checkValidServiceWorker","Layout","backButton","visibility","pointerEvents","hide","mouseEvents","settingsButton","flexGrow","TitleBar","showBackButton","showSettingsButton","isRootPath","edge","history","back","Typography","subheader","ListSubheader","ListItemIcon","Switch","inputProps","checked","listCheckboxSetting","toggleListCheckboxSetting","pathname","a","db","Dexie","tableNames","getMembers","tableConfig","version","stores","Promise","all","table","toArray","rows","r","resolved","buffer","onPatch","patch","clearTimeout","setTimeout","split","typeName","propName","op","getSnapshot","propValue","isStateTreeNode","update","setLocation","storeContext","StoreProvider","createElement","useObserver"],"mappings":"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","file":"static/js/main.f557f004.chunk.js","sourcesContent":["/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Box, Button, Typography, CircularProgress } from '@material-ui/core'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\nimport { useNavigate } from '@reach/router'\n\nimport { Layout } from 'common'\nimport { makeUrl } from 'route'\nimport { useGraph } from 'graph'\n\ninterface PeerConnectorProps {\n  id?: string\n}\n\nexport const PeerConnector: React.FunctionComponent<PeerConnectorProps> = ({\n  id,\n}) => {\n  const [peerError, setPeerError] = React.useState<null | Error>(null)\n  const [hasAccepted, setHasAccepted] = React.useState(false)\n  const navigate = useNavigate()\n\n  return useGraph(graph => {\n    const handleAccept: React.EventHandler<React.SyntheticEvent> = () => {\n      setHasAccepted(true)\n      graph\n        .seekPeerConnection(id)\n        .then((instance: IAnyStateTreeNode) => {\n          navigate(makeUrl(`/node/${instance.id}`))\n        })\n        .catch((error: Error) => {\n          setPeerError(error)\n        })\n    }\n\n    return (\n      <Layout>\n        <Typography align=\"center\">\n          Someone wants to share content with you.\n          <br />\n          Do not accept if you do not trust them.\n        </Typography>\n        <Box mt={1} textAlign=\"center\">\n          {peerError ? (\n            <Typography color=\"error\">{peerError}</Typography>\n          ) : (\n            <Button\n              disabled={hasAccepted}\n              onClick={handleAccept}\n              color=\"primary\"\n            >\n              {hasAccepted ? <CircularProgress size={24} /> : 'Accept'}\n            </Button>\n          )}\n        </Box>\n      </Layout>\n    )\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nexport * from './PeerConnector'\nexport * from './PeerManager'\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\n\nimport { useStore } from 'store'\nimport { Graph, Node } from 'graph'\n\nexport const useGraph = <S>(selector: (s: Instance<typeof Graph>) => S): S =>\n  useStore(store => selector(store.graph))\n\nexport const activeContext = React.createContext<Instance<typeof Node> | null>(\n  null,\n)\n\nexport const ActiveProvider = activeContext.Provider\n\nexport const useActive = (): Instance<typeof Node | null> =>\n  React.useContext(activeContext)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  IAnyModelType,\n  IAnyType,\n  Instance,\n  isIdentifierType,\n  SnapshotIn,\n  isModelType,\n  types,\n} from 'mobx-state-tree'\nimport { v4 as uuid } from 'uuid'\n\nexport type ModelOrUnion = IAnyModelType | IAnyType\nexport type EdgeResolver = () => ModelOrUnion\nexport type ModelTable = Record<string, IAnyModelType>\n\nexport const edgeMapFactory = (getEdgeType: EdgeResolver): IAnyModelType =>\n  types\n    .model('EdgeMap', {\n      edgeMap: types.map(\n        types.array(\n          types.safeReference(types.late(getEdgeType), {\n            acceptsUndefined: false,\n          }),\n        ),\n      ),\n    })\n    .actions(self => ({\n      hasEdge(tag: string, target?: Instance<IAnyModelType>): boolean {\n        if (target) {\n          return Boolean(self.edgeMap.get(tag)?.includes(target))\n        } else {\n          return Boolean(self.edgeMap.get(tag)?.length)\n        }\n      },\n    }))\n    .actions(self => ({\n      addEdge(tag: string, target: Instance<IAnyModelType>): void {\n        if (!self.edgeMap.has(tag)) {\n          self.edgeMap.set(tag, [])\n        }\n\n        self.edgeMap.get(tag)?.push(target)\n      },\n\n      removeEdge(tag: string, target: Instance<IAnyModelType>): void {\n        self.edgeMap.get(tag)?.remove(target)\n      },\n\n      getEdgeTag(tag: string): void | Array<Instance<IAnyModelType>> {\n        return self.edgeMap.get(tag)\n      },\n    }))\n\nexport const nodeFactory = (\n  models: IAnyModelType | Array<IAnyModelType> = [],\n): IAnyModelType =>\n  types\n    .compose(\n      // @ts-ignore\n      ...[\n        types.model({\n          id: types.identifier,\n        }),\n      ].concat(models),\n    )\n    .named('Node')\n\ninterface GraphFactoryOptions {\n  getId?: () => string\n}\n\nexport const graphFactory = (\n  nodeModels: ModelTable,\n  options: GraphFactoryOptions = {},\n): IAnyModelType =>\n  types\n    .model(\n      'Graph',\n      Object.fromEntries(\n        Object.keys(nodeModels).map(key => {\n          const model = nodeModels[key]\n\n          if (isModelType(model) && isIdentifierType(model.properties.id)) {\n            return [key, types.map(nodeModels[key])]\n          }\n\n          // Can't add an identifier because the model may be referenced\n          throw Error(`Model '${key}' requires 'id' identifier`)\n        }),\n      ),\n    )\n    .actions(self => ({\n      createNode(\n        modelName = 'Node',\n        props: SnapshotIn<IAnyModelType> = {},\n      ): Instance<IAnyModelType> {\n        if (!nodeModels[modelName]) {\n          throw Error(`No model named '${modelName}'`)\n        }\n\n        const node = nodeModels[modelName].create({\n          id: options.getId?.() ?? uuid(),\n          ...props,\n        })\n\n        self[modelName].put(node)\n\n        return node\n      },\n    }))\n\nexport const NodeBase = nodeFactory(edgeMapFactory(() => NodeBase))\nexport const GraphBase = graphFactory({ Node: NodeBase })\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, IAnyType } from 'mobx-state-tree'\n\nexport const Unknown = types.union(\n  types.null,\n  types.boolean,\n  types.string,\n  types.number,\n  types.array(types.late((): IAnyType => Unknown)),\n  types.map(types.late((): IAnyType => Unknown)),\n)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  types,\n  IAnyType,\n  Instance,\n  getParentOfType,\n  getSnapshot,\n} from 'mobx-state-tree'\n\nimport { nodeFactory, edgeMapFactory, ViewerConfig, Graph } from 'graph'\n\n// Avoid circular dependency\nimport { Unknown } from 'graph/models/Unknown'\n\nexport const Node = nodeFactory([\n  edgeMapFactory(() =>\n    types.union(\n      types.late((): IAnyType => Node),\n      ViewerConfig,\n    ),\n  ),\n])\n  .props({\n    content: types.union(types.string, Unknown),\n  })\n\n  .actions(self => ({\n    setContent(content: string | Instance<typeof Unknown>): void {\n      self.content = content\n    },\n\n    graphRoot(): Instance<IAnyType> {\n      return getParentOfType(self, Graph)\n    },\n\n    getConfig(doCreate?: boolean): Instance<typeof ViewerConfig> | void {\n      if (self.edgeMap.size && self.edgeMap.get('config')?.length) {\n        return self.edgeMap.get('config')?.[0]\n      } else if (doCreate) {\n        const config = self.graphRoot().createNode('ViewerConfig', {})\n        self.addEdge('config', config)\n        return config\n      } else {\n        return\n      }\n    },\n  }))\n\n  .views(self => ({\n    get childCount(): number {\n      return self.edgeMap.get('child')?.length ?? 0\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, SnapshotIn, Instance } from 'mobx-state-tree'\n\nimport { nodeFactory } from 'graph'\nimport { Unknown } from './Unknown'\n\nconst ConfigBase = types\n  .model('Config', {\n    name: types.maybe(types.string),\n    items: types.map(Unknown),\n  })\n  .actions(self => ({\n    set(key: string, value: SnapshotIn<typeof Unknown>): void {\n      self.items.set(key, value)\n    },\n\n    get(key: string): Instance<typeof Unknown> {\n      return self.items.get(key)\n    },\n  }))\n\nexport const Config = nodeFactory(ConfigBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, Instance } from 'mobx-state-tree'\n\nimport { nodeFactory } from 'graph'\n\nconst ViewerConfigItem = types\n  .model('ViewerConfigItem', {\n    expanded: types.optional(types.boolean, false),\n  })\n  .actions(self => ({\n    setExpanded(value: boolean) {\n      self.expanded = value\n    },\n  }))\n\nconst ViewerConfigBase = types\n  .model('ViewerConfig', {\n    items: types.map(types.map(ViewerConfigItem)),\n  })\n  .actions(self => ({\n    getItem(\n      parentId: string,\n      childId: string,\n      doCreate?: boolean,\n    ): Instance<typeof ViewerConfigItem> | void {\n      let item = self.items.get(parentId)?.get(childId)\n\n      console.log('wtf', self.items.size)\n      if (self.items.size >= 0 && !item && doCreate) {\n        item = ViewerConfigItem.create()\n\n        self.items.set(parentId, {\n          [childId]: item,\n        })\n      }\n\n      return item\n    },\n  }))\n\nexport const ViewerConfig = nodeFactory(ViewerConfigBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  Instance,\n  applySnapshot,\n  SnapshotIn,\n  IAnyModelType,\n} from 'mobx-state-tree'\n\nimport { persist } from 'store/persist'\n\nimport { graphFactory } from './factories'\nimport { Node } from './Node'\nimport { Config } from './Config'\nimport { ViewerConfig } from './ViewerConfig'\n\nexport const Graph = graphFactory({\n  Node,\n  Config,\n  ViewerConfig,\n})\n  .actions(self => ({\n    // TODO mode and select stuff don't belong here\n\n    setActiveMode(mode: string) {\n      const activeModes = self.activeModes\n      if (!activeModes?.includes(mode)) {\n        activeModes.push(mode)\n\n        if (mode === 'select') {\n          activeModes.remove('edit')\n        }\n\n        if (mode === 'edit') {\n          activeModes.remove('select')\n          self.clearSelectedNodes()\n        }\n      }\n    },\n\n    unsetActiveMode(mode: string) {\n      const activeModes = self.activeModes\n      if (activeModes?.includes(mode)) {\n        activeModes.remove(mode)\n      }\n    },\n\n    toggleActiveMode(mode: string) {\n      const activeModes = self.activeModes\n\n      if (!activeModes) {\n        return\n      }\n\n      if (activeModes.includes(mode)) {\n        activeModes.remove(mode)\n\n        if (mode === 'select') {\n          self.clearSelectedNodes()\n        }\n      } else {\n        activeModes.push(mode)\n\n        if (mode === 'select') {\n          activeModes.remove('edit')\n        }\n\n        if (mode === 'edit') {\n          activeModes.remove('select')\n          self.clearSelectedNodes()\n        }\n      }\n    },\n  }))\n\n  .actions(self => ({\n    toggleSelectNode(\n      node: Instance<typeof Node>,\n      parentNode: Instance<typeof Node>,\n    ) {\n      const selectedNodes = self.Config.get('system').get('selectedNodes')\n      if (!selectedNodes) {\n        return\n      }\n\n      const nodeIds = selectedNodes.get(parentNode.id)\n\n      if (nodeIds) {\n        if (nodeIds.includes(node.id)) {\n          nodeIds.remove(node.id)\n          if (nodeIds.length === 0) {\n            selectedNodes.delete(parentNode.id)\n          }\n        } else {\n          nodeIds.push(node.id)\n        }\n      } else {\n        selectedNodes.set(parentNode.id, [node.id])\n      }\n    },\n\n    clearSelectedNodes() {\n      self.Config.get('system').get('selectedNodes')?.clear()\n      if (self.selectedNodes.size === 0) {\n        self.unsetActiveMode('select')\n      }\n    },\n\n    deleteSelectedNodes() {\n      self.selectedNodes.forEach((nodeIds: Array<string>) =>\n        nodeIds.forEach((nodeId: string) => self.Node.delete(nodeId)),\n      )\n\n      self.clearSelectedNodes()\n    },\n\n    moveSelectedNodes(target: Instance<typeof Node>) {\n      for (const [accessorId, nodeIds] of self.selectedNodes) {\n        const accessor = self.Node.get(accessorId)\n        for (const nodeId of nodeIds) {\n          const node = self.Node.get(nodeId)\n          if (node) {\n            node.removeEdge('parent', accessor)\n            accessor.removeEdge('child', node)\n\n            node.addEdge('parent', target)\n            target.addEdge('child', node)\n          }\n        }\n      }\n\n      self.clearSelectedNodes()\n    },\n\n    copySelectedNodes() {\n      //\n    },\n\n    linkSelectedNodes(target: Instance<typeof Node>) {\n      for (const nodeIds of self.selectedNodes.values()) {\n        for (const nodeId of nodeIds) {\n          const node = self.Node.get(nodeId)\n          if (node) {\n            node.addEdge('parent', target)\n            target.addEdge('child', node)\n          }\n        }\n      }\n\n      self.clearSelectedNodes()\n    },\n\n    unlinkSelectedNodes() {\n      for (const [accessorId, nodeIds] of self.selectedNodes) {\n        const accessor = self.Node.get(accessorId)\n        for (const nodeId of nodeIds) {\n          const node = self.Node.get(nodeId)\n          if (node) {\n            node.removeEdge('parent', accessor)\n            accessor.removeEdge('child', node)\n          }\n        }\n      }\n\n      self.clearSelectedNodes()\n    },\n\n    removeSelectedNodes() {\n      for (const [accessorId, nodeIds] of self.selectedNodes) {\n        const accessor = self.Node.get(accessorId)\n        for (const nodeId of nodeIds) {\n          const node = self.Node.get(nodeId)\n          if (node) {\n            node.removeEdge('parent', accessor)\n            accessor.removeEdge('child', node)\n            if (node.edgeMap.get('parent').size === 0) {\n              self.deleteNode(node)\n            }\n          }\n        }\n      }\n\n      self.clearSelectedNodes()\n    },\n  }))\n\n  .actions(self => ({\n    afterCreate() {\n      persist(self)\n        .catch(e => {\n          console.error('Persist error', e)\n        })\n        .then(() => {\n          if (!self.rootNode) {\n            const rootNode = self.createNode('Node', { content: 'Exuo' })\n            applySnapshot(self.Config, {\n              system: {\n                id: 'system',\n                items: {\n                  rootNodeId: rootNode.id,\n                  selectedNodes: {},\n                  activeModes: [],\n                },\n              },\n            })\n          }\n        })\n    },\n\n    createChild<T extends IAnyModelType>(\n      node: Instance<typeof Node>,\n      edgeProps: SnapshotIn<T>,\n      edgeType = 'Node',\n    ): Instance<typeof Node> {\n      const child = self.createNode(edgeType, edgeProps)\n\n      node.addEdge('child', child)\n      child.addEdge('parent', node)\n\n      return child\n    },\n\n    deleteNode(node: Instance<typeof Node>) {\n      self.Node.delete(node.id)\n    },\n  }))\n\n  .views(self => ({\n    get rootNode() {\n      const config = self.Config.get('system')\n      return self.Node.get(config?.get('rootNodeId'))\n    },\n\n    get activeModes() {\n      const config = self.Config.get('system')\n      return config?.get('activeModes')\n    },\n\n    get selectedNodes() {\n      const config = self.Config.get('system')\n      return config?.get('selectedNodes')\n    },\n\n    get selectedNodeCount() {\n      let count = 0\n\n      for (const kv of self.selectedNodes) {\n        count += kv[1].length\n      }\n\n      return count\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types } from 'mobx-state-tree'\nimport { convertToRaw } from 'draft-js'\n\nimport { nodeFactory } from 'graph'\n\n// Avoid circular dependency issue\nimport { Unknown } from 'graph/models/Unknown'\n\nconst NoteBase = types\n  .model('Note', {\n    content: types.maybe(Unknown),\n  })\n  .actions(self => ({\n    setContent(value: ReturnType<typeof convertToRaw>) {\n      self.content = value\n    },\n  }))\n\nexport const Note = nodeFactory(NoteBase)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport {\n  ClickAwayListener,\n  Backdrop,\n  Button,\n  IconButton,\n  Theme,\n  Toolbar,\n  createStyles,\n  fade,\n  makeStyles,\n  useMediaQuery,\n} from '@material-ui/core'\nimport Code from '@material-ui/icons/Code'\nimport FormatQuoteIcon from '@material-ui/icons/FormatQuote'\nimport FormatBoldIcon from '@material-ui/icons/FormatBold'\nimport FormatItalicIcon from '@material-ui/icons/FormatItalic'\nimport FormatUnderlinedIcon from '@material-ui/icons/FormatUnderlined'\nimport SpaceBar from '@material-ui/icons/SpaceBar'\nimport FormatListNumberedIcon from '@material-ui/icons/FormatListNumbered'\nimport FormatListBulletedIcon from '@material-ui/icons/FormatListBulleted'\nimport {\n  ContentBlock,\n  ContentState,\n  DraftEditorCommand,\n  DraftHandleValue,\n  Editor,\n  EditorState,\n  RichUtils,\n  getDefaultKeyBinding,\n  convertFromRaw,\n  convertToRaw,\n} from 'draft-js'\nimport 'draft-js/dist/Draft.css'\n\nimport { Note } from './models/Note'\n\nexport const isPlainText = (\n  contentState: string | ReturnType<typeof convertToRaw>,\n): boolean => {\n  if (typeof contentState === 'string') {\n    return true\n  }\n\n  for (const block of contentState.blocks) {\n    if (\n      block.depth ||\n      block.type !== 'unstyled' ||\n      block.inlineStyleRanges.length\n    ) {\n      return false\n    }\n  }\n\n  return true\n}\n\ninterface ButtonConfig {\n  label: string\n  style: string\n  icon?: React.ReactElement\n}\n\nconst BLOCK_TYPES: Array<ButtonConfig> = [\n  {\n    label: 'UL',\n    style: 'unordered-list-item',\n    icon: <FormatListNumberedIcon />,\n  },\n  { label: 'OL', style: 'ordered-list-item', icon: <FormatListBulletedIcon /> },\n  { label: 'Blockquote', style: 'blockquote', icon: <FormatQuoteIcon /> },\n  { label: 'Code Block', style: 'code-block', icon: <Code /> },\n]\n\nconst INLINE_STYLES: Array<ButtonConfig> = [\n  { label: 'Bold', style: 'BOLD', icon: <FormatBoldIcon /> },\n  { label: 'Italic', style: 'ITALIC', icon: <FormatItalicIcon /> },\n  { label: 'Underline', style: 'UNDERLINE', icon: <FormatUnderlinedIcon /> },\n  { label: 'Monospace', style: 'CODE', icon: <SpaceBar /> },\n]\n\nconst getBlockStyle = (block: ContentBlock): string => {\n  switch (block.getType()) {\n    case 'blockquote':\n      return 'RichEditor-blockquote'\n    default:\n      return ''\n  }\n}\n\ninterface StyleButtonProps {\n  onToggle: (inlineStyle: string) => void\n  style: string\n  active: boolean\n  label: string\n  icon?: React.ReactElement\n}\n\nconst StyleButton: React.FunctionComponent<StyleButtonProps> = ({\n  onToggle,\n  style,\n  active,\n  label,\n  icon,\n}) => {\n  const onToggleWrap: React.EventHandler<React.SyntheticEvent> = e => {\n    e.preventDefault()\n    onToggle(style)\n  }\n\n  let className = 'RichEditor-styleButton'\n  if (active) {\n    className += ' RichEditor-activeButton'\n  }\n\n  return icon ? (\n    <IconButton size=\"small\" onMouseDown={onToggleWrap} className={className}>\n      {icon}\n    </IconButton>\n  ) : (\n    <Button\n      size=\"small\"\n      startIcon={icon ? icon : undefined}\n      onMouseDown={onToggleWrap}\n      className={className}\n    >\n      {icon ? '' : label}\n    </Button>\n  )\n}\n\ninterface BlockStyleControlsProps {\n  editorState: EditorState\n  onToggle: (style: string) => void\n}\n\nconst BlockStyleControls: React.FunctionComponent<BlockStyleControlsProps> = ({\n  editorState,\n  onToggle,\n}) => {\n  const selection = editorState.getSelection()\n  const blockType = editorState\n    .getCurrentContent()\n    .getBlockForKey(selection.getStartKey())\n    .getType()\n\n  return (\n    <div>\n      {BLOCK_TYPES.map(type => (\n        <StyleButton\n          key={type.label}\n          active={type.style === blockType}\n          label={type.label}\n          icon={type.icon}\n          onToggle={onToggle}\n          style={type.style}\n        />\n      ))}\n    </div>\n  )\n}\n\ninterface InlineStyleControlsProps {\n  editorState: EditorState\n  onToggle: (style: string) => void\n}\n\nconst InlineStyleControls: React.FunctionComponent<InlineStyleControlsProps> = ({\n  editorState,\n  onToggle,\n}) => {\n  const currentStyle = editorState.getCurrentInlineStyle()\n  return (\n    <div>\n      {INLINE_STYLES.map(type => (\n        <StyleButton\n          key={type.label}\n          active={currentStyle.has(type.style)}\n          label={type.label}\n          icon={type.icon}\n          onToggle={onToggle}\n          style={type.style}\n        />\n      ))}\n    </div>\n  )\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      width: '100%',\n      zIndex: theme.zIndex.appBar + 10,\n    },\n\n    backdrop: {\n      cursor: 'default',\n      backdropFilter: 'blur(3px) saturate(0%)',\n      backgroundColor: fade(theme.palette.background.default, 0.8),\n    },\n\n    wrapper: {\n      outline: 'none',\n\n      background: `\n        linear-gradient(\n          to top,\n          ${fade(theme.palette.background.default, 0)},\n          ${fade(theme.palette.background.default, 1)} \\\n            ${theme.spacing(1) / 2}px calc(100% - ${theme.spacing(1) / 2}px),\n          ${fade(theme.palette.background.default, 0)}\n        ),\n        linear-gradient(\n          to right,\n          ${theme.palette.primary.main},\n          ${theme.palette.secondary.main} \n        )\n      `,\n\n      '& .DraftEditor-editorContainer': {\n        maxHeight: '70vh',\n        overflowY: 'auto',\n        border: 0,\n        padding: theme.spacing(1, 2, 1, 2),\n\n        '& [data-contents=true] > [data-block=true]': {\n          ...theme.typography.body2,\n          '&:first-child': {\n            ...theme.typography.body1,\n          },\n        },\n      },\n    },\n\n    toolbar: {\n      justifyContent: 'center',\n      background: `\n        linear-gradient(\n          to bottom,\n          ${theme.palette.background.default} 30%,\n          ${fade(theme.palette.background.default, 0)}\n        )\n      `,\n\n      '&>div:first-child': {\n        marginRight: theme.spacing(4),\n      },\n    },\n  }),\n)\n\n// TODO autofocus doesn't work on iOS\n\ninterface NoteEditorProps {\n  note?: Instance<typeof Note>\n  text?: string\n  rawContent?: ReturnType<typeof convertToRaw>\n  placeholder?: string\n  autoFocus?: boolean\n  showBackdrop?: boolean\n  showControls?: boolean\n  showRichTextControls?: boolean\n  className?: string\n  inputClassName?: string\n  onValue?: (\n    value?: Instance<typeof Note> | ContentState,\n    event?: React.KeyboardEvent | React.MouseEvent<HTMLDocument>,\n  ) => void | true\n  onClickAway?: () => void\n  onEscape?: () => void\n}\n\nexport const NoteEditor = React.forwardRef<HTMLDivElement, NoteEditorProps>(\n  function (\n    {\n      note,\n      text,\n      rawContent,\n      placeholder,\n      autoFocus,\n      showBackdrop,\n      showControls,\n      showRichTextControls,\n      className,\n      inputClassName,\n      onValue,\n      onClickAway,\n      onEscape,\n    },\n    ref,\n  ) {\n    const classes = useStyles()\n\n    const containerRef = React.useRef<HTMLDivElement>(null)\n    const editorRef = React.useRef<Editor>(null)\n\n    const nodeContent = note?.nodeContent\n    const contentState = React.useMemo(\n      () =>\n        (nodeContent && convertFromRaw(JSON.parse(nodeContent))) ||\n        (rawContent && convertFromRaw(rawContent)),\n      [nodeContent, rawContent],\n    )\n    const [editorState, setEditorState] = React.useState(() =>\n      EditorState.createWithContent(\n        contentState ||\n          ContentState.createFromText(text ?? note?.content ?? ''),\n      ),\n    )\n\n    const isMobile = useMediaQuery('(pointer: coarse) and (hover: none)')\n    const [submitOnReturn, setSubmitOnReturn] = React.useState(!isMobile)\n\n    React.useEffect(() => {\n      if (autoFocus) {\n        setEditorState(EditorState.moveFocusToEnd(editorState))\n      }\n    }, []) // eslint-disable-line react-hooks/exhaustive-deps\n\n    /* React.useEffect(() => { */\n    /*   containerRef.current?.scrollIntoView(false) */\n    /* }) */\n\n    const handleValue = (\n      event?:\n        | React.KeyboardEvent<HTMLInputElement>\n        | React.MouseEvent<HTMLDocument>,\n    ): void => {\n      const contentState = editorState.getCurrentContent()\n      const rawContent = convertToRaw(contentState)\n\n      if (note) {\n        note.setRawContentState(rawContent)\n        note.setContent(contentState.getFirstBlock().getText())\n      }\n\n      if (\n        onValue?.(\n          note || isPlainText(rawContent)\n            ? contentState.getPlainText()\n            : rawContent,\n          event,\n        )\n      ) {\n        setEditorState(\n          EditorState.forceSelection(\n            EditorState.push(\n              EditorState.moveFocusToEnd(editorState),\n              ContentState.createFromText(''),\n              'remove-range',\n            ),\n            contentState.getSelectionAfter(),\n          ),\n        )\n      }\n    }\n\n    const handleKeyCommand = (\n      command: DraftEditorCommand,\n      editorState: EditorState,\n    ): DraftHandleValue => {\n      const newState = RichUtils.handleKeyCommand(editorState, command)\n      if (newState) {\n        setEditorState(newState)\n        return 'handled'\n      } else {\n        return 'not-handled'\n      }\n    }\n\n    const mapKeyToEditorCommand = (\n      event: React.KeyboardEvent,\n    ): DraftEditorCommand | null => {\n      if (event.keyCode === 13) {\n        if (submitOnReturn && !event.shiftKey) {\n          handleValue()\n          return null\n        } else if (!submitOnReturn && event.shiftKey) {\n          handleValue()\n          return null\n        } else {\n          setSubmitOnReturn(false)\n          return getDefaultKeyBinding(event)\n        }\n      } else if (event.keyCode === 27) {\n        onEscape?.()\n        return null\n      } else {\n        return getDefaultKeyBinding(event)\n      }\n    }\n\n    const toggleBlockType = (blockType: string): void => {\n      setEditorState(RichUtils.toggleBlockType(editorState, blockType))\n    }\n\n    const toggleInlineStyle = (inlineStyle: string): void => {\n      setEditorState(RichUtils.toggleInlineStyle(editorState, inlineStyle))\n    }\n\n    const blockCount = editorState.getCurrentContent().getBlocksAsArray().length\n\n    return (\n      <div ref={ref} className={[classes.root, className].join(' ')}>\n        {blockCount > 1 && showBackdrop && (\n          <Backdrop open={Boolean(showBackdrop)} className={classes.backdrop} />\n        )}\n\n        <ClickAwayListener\n          mouseEvent={'onMouseDown'}\n          touchEvent={'onTouchStart'}\n          onClickAway={event => {\n            if (onClickAway) {\n              onClickAway()\n            } else {\n              handleValue(event)\n            }\n          }}\n        >\n          <div ref={containerRef}>\n            <div\n              tabIndex={-1}\n              className={[classes.wrapper, inputClassName].join(' ')}\n            >\n              <Editor\n                ref={editorRef}\n                blockStyleFn={getBlockStyle}\n                editorState={editorState}\n                handleKeyCommand={handleKeyCommand}\n                keyBindingFn={mapKeyToEditorCommand}\n                onChange={setEditorState}\n                placeholder={placeholder}\n                spellCheck={true}\n              />\n            </div>\n\n            {blockCount > 1 && showControls && (\n              <Toolbar variant=\"dense\" className={classes.toolbar}>\n                {showRichTextControls && (\n                  <>\n                    <InlineStyleControls\n                      editorState={editorState}\n                      onToggle={toggleInlineStyle}\n                    />\n                    <BlockStyleControls\n                      editorState={editorState}\n                      onToggle={toggleBlockType}\n                    />\n                  </>\n                )}\n              </Toolbar>\n            )}\n          </div>\n        </ClickAwayListener>\n      </div>\n    )\n  },\n)\n\nNoteEditor.defaultProps = {\n  showBackdrop: true,\n  showControls: true,\n  showRichTextControls: true,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  Collapse,\n  Button,\n  ListItem,\n  ListItemSecondaryAction,\n  ListItemText,\n} from '@material-ui/core'\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\nimport KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown'\nimport { createStyles, makeStyles, fade, Theme } from '@material-ui/core/styles'\nimport { Instance } from 'mobx-state-tree'\nimport { Link, useNavigate } from '@reach/router'\n\nimport { makeUrl } from 'route'\nimport { NoteEditor } from 'note'\nimport { useGraph, Node, EdgeList, useActive } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    itemContainer: {\n      '&.isExpanded': {\n        /* background: theme.palette.background.default, */\n        /* position: 'sticky', */\n        /* top: 65, */\n      },\n    },\n\n    listItem: {\n      position: 'relative',\n      cursor: 'pointer',\n\n      transition: theme.transitions.create(['color', 'background'], {\n        duration: theme.transitions.duration.shortest,\n      }),\n\n      '&:hover': {\n        color: theme.palette.primary.main,\n        backgroundColor: theme.palette.background.paper,\n      },\n\n      '&.editMode': {\n        cursor: 'default',\n        color: 'unset',\n      },\n\n      '&.selectMode': {\n        cursor: 'default',\n        color: 'unset',\n      },\n\n      '&.isEditing, &.isEditing + li': {\n        borderColor: 'transparent',\n      },\n\n      '&.Mui-selected': {\n        background: `\n          linear-gradient(\n            to top,\n            ${fade(theme.palette.background.default, 0)},\n            ${fade(theme.palette.background.default, 0.9)} \\\n              ${theme.spacing(1) / 2}px calc(100% - ${theme.spacing(1) / 2}px),\n            ${fade(theme.palette.background.default, 0)}\n          ),\n          linear-gradient(\n            to right,\n            ${theme.palette.primary.main},\n            ${theme.palette.secondary.main} \n          )\n        `,\n\n        '&:hover': { color: 'unset' },\n        '& a:hover': { color: 'unset' },\n      },\n    },\n\n    childList: {\n      marginLeft: theme.spacing(3),\n      padding: 0,\n    },\n\n    itemText: {\n      margin: 0,\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n\n      '.isEditing &': {\n        opacity: 0,\n      },\n\n      '& .MuiListItemText-primary': {\n        display: 'inline',\n      },\n\n      '& .MuiListItemText-secondary': {\n        display: 'inline',\n        paddingLeft: theme.spacing(1),\n      },\n\n      '&.expand': {\n        '& .MuiListItemText-secondary': {\n          display: 'block',\n          paddingLeft: 0,\n        },\n      },\n    },\n\n    listItemSelectCheckbox: {\n      padding: theme.spacing(0, 1, 0, 1),\n      '&:hover, &.Mui-checked:hover': {\n        backgroundColor: 'unset',\n      },\n    },\n\n    listItemIcon: {\n      minWidth: 'auto',\n    },\n\n    noteEditor: {\n      cursor: 'default',\n      position: 'absolute',\n      top: 0,\n      left: 0,\n    },\n\n    noteEditorInput: {\n      cursor: 'text',\n    },\n\n    secondaryActions: {\n      right: 0,\n    },\n\n    childButton: {\n      cursor: 'pointer',\n      color: theme.palette.text.primary,\n      transition: theme.transitions.create(['color'], {\n        duration: theme.transitions.duration.shortest,\n      }),\n\n      // Ensure ChevronRight lines up without a label\n      minWidth: 'unset',\n\n      paddingRight: theme.spacing(2),\n      paddingLeft: theme.spacing(2),\n\n      '&:hover, &:focus': {\n        color: theme.palette.primary.main,\n        background: 'inherit',\n      },\n    },\n  }),\n)\n\ninterface NodeListItemProps {\n  node: Instance<typeof Node>\n  parentNode: Instance<typeof Node>\n  expandSecondaryTypography?: boolean\n  expanded?: boolean\n  className?: string\n}\n\nexport const NodeListItem: React.FunctionComponent<NodeListItemProps> = ({\n  node,\n  parentNode,\n  expandSecondaryTypography,\n  expanded,\n  className,\n}) => {\n  const classes = useStyles()\n  const navigate = useNavigate()\n  const active = useActive()\n  const [isEditing, setIsEditing] = React.useState(false)\n\n  return useGraph(graph => {\n    const config = active?.getConfig()\n    const isExpanded =\n      config?.getItem(parentNode.id, node.id)?.expanded ?? false\n    const isSelected = graph.selectedNodes.get(parentNode.id)?.includes(node.id)\n\n    const toggleExpand = (): void => {\n      const configItem = active\n        ?.getConfig(true)\n        ?.getItem(parentNode.id, node.id, true)\n      configItem.setExpanded(!configItem.expanded)\n    }\n\n    const handleItemClick: React.EventHandler<React.MouseEvent> = e => {\n      e.preventDefault()\n\n      if (e.altKey) {\n        setIsEditing(true)\n        graph.setActiveMode('edit')\n      } else if (e.shiftKey) {\n        setIsEditing(false)\n        graph.setActiveMode('select')\n        graph.toggleSelectNode(node, parentNode)\n      } else if (graph.activeModes.includes('select')) {\n        graph.toggleSelectNode(node, parentNode)\n      } else if (graph.activeModes.includes('edit')) {\n        setIsEditing(true)\n      } else {\n        navigate(makeUrl(`/node/${node.id}/`))\n      }\n    }\n\n    const handleArrowClick: React.EventHandler<React.MouseEvent> = e => {\n      e.preventDefault()\n      toggleExpand()\n      /* if (e.altKey) { */\n      /*   e.preventDefault() */\n      /*   toggleExpand() */\n      /*   return */\n      /* } */\n    }\n\n    let primaryText = node.id\n    let secondaryText = undefined\n\n    const rawContent = node.content?.toJSON?.()\n\n    if (typeof node.content === 'string') {\n      const newlinePosition = node.content.indexOf('\\n')\n\n      primaryText =\n        newlinePosition > 0\n          ? node.content.slice(0, newlinePosition)\n          : node.content\n\n      secondaryText =\n        newlinePosition > 0\n          ? node.content.slice(newlinePosition + 1)\n          : undefined\n    } else if (rawContent) {\n      primaryText = rawContent.blocks[0].text\n      secondaryText = rawContent.blocks[1]?.text\n    }\n\n    return (\n      <>\n        <ListItem\n          onClick={handleItemClick}\n          selected={isSelected}\n          component=\"li\"\n          ContainerProps={{\n            className: [\n              classes.itemContainer,\n              node.childCount > 0 && isExpanded ? 'isExpanded' : '',\n              className,\n            ].join(' '),\n          }}\n          className={[\n            classes.listItem,\n            graph.activeModes.includes('edit') ? 'editMode' : '',\n            graph.activeModes.includes('select') ? 'selectMode' : '',\n            isEditing ? 'isEditing' : '',\n          ].join(' ')}\n        >\n          {isEditing && (\n            <NoteEditor\n              autoFocus\n              text={rawContent ? undefined : node.content}\n              rawContent={rawContent}\n              className={classes.noteEditor}\n              inputClassName={classes.noteEditorInput}\n              onValue={value => {\n                setIsEditing(false)\n                if (value) {\n                  if (typeof value === 'string') {\n                    node.setContent(value)\n                  } else if (Object.keys(value).includes('blocks')) {\n                    node.setContent(value)\n                  }\n                }\n              }}\n              onEscape={() => {\n                setIsEditing(false)\n                graph.unsetActiveMode('edit')\n              }}\n            />\n          )}\n\n          <ListItemText\n            primary={primaryText}\n            secondary={secondaryText}\n            className={[\n              classes.itemText,\n              expandSecondaryTypography ? 'expand' : '',\n            ].join(' ')}\n          />\n\n          {!isEditing && (\n            <ListItemSecondaryAction className={classes.secondaryActions}>\n              {(node.childCount > 0 ||\n                graph.activeModes.includes('select') ||\n                graph.activeModes.includes('edit')) && (\n                <Button\n                  to={makeUrl(`/node/${node.id}/`)}\n                  component={Link}\n                  onClick={handleArrowClick}\n                  className={classes.childButton}\n                  endIcon={\n                    node.childCount > 0 && isExpanded ? (\n                      <KeyboardArrowDownIcon />\n                    ) : (\n                      <ChevronRightIcon />\n                    )\n                  }\n                  size=\"small\"\n                >\n                  {node.childCount > 0 && node.childCount}\n                </Button>\n              )}\n            </ListItemSecondaryAction>\n          )}\n        </ListItem>\n\n        {node.childCount > 0 && (\n          <Collapse in={isExpanded} timeout=\"auto\" unmountOnExit>\n            <EdgeList\n              inner\n              node={node}\n              edgeTag=\"child\"\n              className={classes.childList}\n            />\n          </Collapse>\n        )}\n      </>\n    )\n  })\n}\n\nNodeListItem.defaultProps = {\n  expandSecondaryTypography: true,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { List } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { IAnyModelType, Instance } from 'mobx-state-tree'\n\nimport { useGraph } from '../utils'\nimport { NodeListItem } from './NodeListItem'\nimport { Node } from '../models/Node'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    list: {\n      padding: 0,\n      '&>li': {\n        borderTop: `.01px solid ${theme.palette.divider}`,\n        '&:first-child': {\n          borderTop: 'unset',\n        },\n      },\n\n      borderBottom: `.01px solid ${theme.palette.divider}`,\n      '&.inner': {\n        borderTop: `.01px solid ${theme.palette.divider}`,\n        borderBottom: 'unset',\n      },\n    },\n  }),\n)\n\ninterface EdgeListProps {\n  node: Instance<IAnyModelType>\n  edgeTag: string\n  inner?: boolean\n  className?: string\n}\n\nexport const EdgeList: React.FunctionComponent<EdgeListProps> = ({\n  node,\n  edgeTag,\n  inner,\n  className,\n}) => {\n  const classes = useStyles()\n  return useGraph(graph => {\n    const edges = node.edgeMap.get(edgeTag)\n    return edges?.length ? (\n      <List\n        aria-label=\"edge list\"\n        className={[classes.list, inner ? 'inner' : '', className].join(' ')}\n      >\n        {edges?.map((item: Instance<typeof Node>) => (\n          <NodeListItem\n            node={item}\n            parentNode={node}\n            key={`${node.id}-${edgeTag}-${item.id}`}\n          />\n        ))}\n      </List>\n    ) : null\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { makeStyles, Theme, createStyles } from '@material-ui/core/styles'\nimport { InputBase, ClickAwayListener } from '@material-ui/core'\n\nimport { useGraph } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'inline-block',\n      margin: 0,\n      padding: theme.spacing(1, 2, 1, 2),\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      ...theme.typography.body1,\n    },\n  }),\n)\n\ninterface LabelEditorProps {\n  content?: string\n  placeholder?: string\n  autoFocus?: boolean\n  className?: string\n  onValue?: (\n    value: string,\n    event?: React.KeyboardEvent<HTMLInputElement>,\n  ) => void\n}\n\nexport const LabelEditor: React.FunctionComponent<LabelEditorProps> = ({\n  content,\n  placeholder,\n  autoFocus,\n  className,\n  onValue,\n}) => {\n  const inputRef = React.useRef<HTMLInputElement>()\n  const classes = useStyles()\n  const [inputValue, setInputValue] = React.useState(content ?? '')\n\n  const [didRender, setDidRender] = React.useState(false)\n  React.useEffect(() => {\n    if (!didRender) {\n      inputRef.current?.setSelectionRange(inputValue.length, inputValue.length)\n      setDidRender(true)\n    }\n  }, [didRender, inputValue.length])\n\n  return useGraph(graph => {\n    const handleValue = (\n      event?: React.KeyboardEvent<HTMLInputElement>,\n    ): void => {\n      if (onValue) {\n        setInputValue('')\n        onValue(inputValue, event)\n      }\n    }\n\n    const handleClickAway = (event: React.MouseEvent<Document>): void => {\n      // TODO don't do a create when clicking away\n      // but this is how it should work when editing an existing record\n      // so back to a create mode? D:\n      if (inputValue === '') {\n        handleValue()\n      }\n    }\n\n    const handleKeyDown = (\n      event: React.KeyboardEvent<HTMLInputElement>,\n    ): void => {\n      if (event.keyCode === 13 && !event.shiftKey) {\n        event.preventDefault()\n        handleValue(event)\n      } else if (event.keyCode === 27) {\n        // TODO escape should also exit the editor, but this is ugly to try here\n      }\n    }\n\n    const handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n      setInputValue(event.target.value)\n    }\n\n    return (\n      <ClickAwayListener onClickAway={handleClickAway}>\n        <InputBase\n          fullWidth\n          multiline\n          autoFocus={autoFocus}\n          inputRef={inputRef}\n          placeholder={placeholder}\n          value={inputValue}\n          onKeyDown={handleKeyDown}\n          onChange={handleChange}\n          inputProps={{ 'aria-label': 'text' }}\n          className={[classes.root, className].join(' ')}\n        />\n      </ClickAwayListener>\n    )\n  })\n}\n\nLabelEditor.defaultProps = {\n  placeholder: 'Text',\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport {\n  IconButton,\n  Button,\n  ButtonGroup,\n  ClickAwayListener,\n  Paper,\n  Popper,\n  MenuItem,\n  MenuList,\n  IconButtonProps,\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/DeleteOutlined'\nimport FlipToBackIcon from '@material-ui/icons/FlipToBackOutlined'\nimport CancelIcon from '@material-ui/icons/CancelOutlined'\nimport FolderIcon from '@material-ui/icons/FolderOutlined'\nimport FileCopyIcon from '@material-ui/icons/FileCopyOutlined'\nimport SelectAllIcon from '@material-ui/icons/SelectAll'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { useGraph, Node, useActive } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      display: 'inherit',\n      position: 'relative',\n    },\n    buttonGroup: {\n      '& .MuiButtonGroup-groupedTextHorizontal': {\n        borderRight: 'unset',\n      },\n      '& .MuiButtonGroup-grouped': {\n        minWidth: 'unset',\n      },\n    },\n    selectCount: {\n      color: theme.palette.primary.main,\n      fontSize: 12,\n      position: 'absolute',\n      right: -theme.spacing(1),\n    },\n    selectButton: {},\n    deleteButton: {\n      color: theme.palette.error.main,\n    },\n    popper: {\n      '& svg': {\n        marginRight: theme.spacing(1),\n      },\n    },\n    paper: {\n      border: `.01px solid ${theme.palette.divider}`,\n    },\n    selectMenu: {\n      outline: 0,\n    },\n  }),\n)\n\ninterface SelectButtonProps extends IconButtonProps {\n  node: Instance<typeof Node>\n  onClick: React.MouseEventHandler\n  className?: string\n}\n\nexport const SelectButton: React.FunctionComponent<SelectButtonProps> = ({\n  node,\n  className,\n  onClick,\n  ...extraProps\n}) => {\n  const classes = useStyles()\n  const [open, setOpen] = React.useState(false)\n  const anchorRef = React.useRef<HTMLButtonElement>(null)\n  const active = useActive()\n\n  return useGraph(graph => {\n    const selectedCount = graph.selectedNodeCount\n    return (\n      <div className={[classes.root, className].join(' ')}>\n        {selectedCount > 0 && (\n          <span className={classes.selectCount}>{selectedCount}</span>\n        )}\n        <IconButton\n          color=\"primary\"\n          ref={anchorRef}\n          onClick={\n            graph.selectedNodes.size ? () => setOpen(value => !value) : onClick\n          }\n          className={classes.selectButton}\n          {...extraProps}\n        >\n          <SelectAllIcon />\n        </IconButton>\n        <Popper\n          open={open}\n          anchorEl={anchorRef.current}\n          role={undefined}\n          disablePortal\n          className={classes.popper}\n        >\n          {({ placement }) => (\n            <ClickAwayListener\n              onClickAway={e => {\n                e.preventDefault()\n                setOpen(false)\n              }}\n            >\n              <Paper elevation={0} className={classes.paper}>\n                <MenuList dense className={classes.selectMenu}>\n                  <MenuItem\n                    divider\n                    onClick={() => {\n                      graph.removeSelectedNodes()\n                      setOpen(false)\n                    }}\n                    className={classes.deleteButton}\n                  >\n                    <DeleteIcon />\n                    Remove\n                  </MenuItem>\n\n                  <MenuItem\n                    onClick={() => {\n                      graph.linkSelectedNodes(active)\n                      setOpen(false)\n                    }}\n                  >\n                    <FlipToBackIcon />\n                    Link here\n                  </MenuItem>\n\n                  <MenuItem\n                    disabled\n                    onClick={() => {\n                      setOpen(false)\n                    }}\n                  >\n                    <FileCopyIcon />\n                    Copy here\n                  </MenuItem>\n\n                  <MenuItem\n                    divider\n                    onClick={() => {\n                      graph.moveSelectedNodes(active)\n                      setOpen(false)\n                    }}\n                  >\n                    <FolderIcon />\n                    Move here\n                  </MenuItem>\n\n                  {/* <MenuItem */}\n                  {/*   onClick={() => { */}\n                  {/*     graph.deleteSelectedNodes() */}\n                  {/*     setOpen(false) */}\n                  {/*   }} */}\n                  {/*   className={classes.deleteButton} */}\n                  {/* > */}\n                  {/*   <DeleteIcon /> */}\n                  {/*   Delete */}\n                  {/* </MenuItem> */}\n\n                  <MenuItem\n                    onClick={() => {\n                      graph.clearSelectedNodes()\n                      setOpen(false)\n                    }}\n                  >\n                    <CancelIcon />\n                    Clear selection\n                  </MenuItem>\n                </MenuList>\n              </Paper>\n            </ClickAwayListener>\n          )}\n        </Popper>\n      </div>\n    )\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  Toolbar,\n  IconButton,\n  Box,\n  Button,\n  createStyles,\n  makeStyles,\n  Theme,\n  emphasize,\n  fade,\n} from '@material-ui/core'\nimport AddIcon from '@material-ui/icons/Add'\nimport EditIcon from '@material-ui/icons/Edit'\nimport SearchIcon from '@material-ui/icons/Search'\nimport TuneIcon from '@material-ui/icons/Tune'\nimport GroupIcon from '@material-ui/icons/Group'\nimport { Instance } from 'mobx-state-tree'\n\nimport { SelectButton } from 'select'\nimport { Node, useGraph } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n\n    toolbar: {\n      justifyContent: 'space-evenly',\n      [theme.breakpoints.up('sm')]: {\n        justifyContent: 'center',\n      },\n\n      minHeight: theme.spacing(8),\n\n      backdropFilter: 'blur(3px)',\n      background: `\n        linear-gradient(\n          to bottom,\n          ${fade(theme.palette.background.default, 0.9)},\n          ${fade(theme.palette.background.default, 1)} 90%\n        )`,\n    },\n\n    insertButton: {\n      color: theme.palette.background.default,\n      boxShadow: 'unset',\n      margin: theme.spacing(0, 1, 0, 1),\n      background: `\n        radial-gradient(\n          circle at bottom,\n          ${theme.palette.secondary.main},\n          ${theme.palette.primary.main} 75%\n        )`,\n\n      '&:hover, &:focus': {\n        boxShadow: 'unset',\n        background: `\n        radial-gradient(\n          circle at bottom,\n          ${emphasize(theme.palette.secondary.main, 0.3)},\n          ${theme.palette.primary.main} 75%\n        )`,\n      },\n\n      '&:active': {\n        boxShadow: 'unset',\n        background: `\n        radial-gradient(\n          circle at bottom,\n          ${emphasize(theme.palette.secondary.main, 0.3)},\n          ${theme.palette.primary.main} 75%\n        )`,\n      },\n    },\n  }),\n)\n\ninterface NodeActionsProps {\n  node: Instance<typeof Node>\n  className?: string\n}\n\nexport const NodeActions: React.FunctionComponent<NodeActionsProps> = ({\n  node,\n  className,\n}) => {\n  const classes = useStyles()\n\n  return useGraph(graph => {\n    const hasChildren = node.childCount > 0\n    const selectedCount = graph.selectedNodes.size ?? 0\n\n    return (\n      <Box className={[classes.root, className].join(' ')}>\n        <Toolbar className={classes.toolbar}>\n          <IconButton\n            disabled\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <SearchIcon />\n          </IconButton>\n\n          <IconButton\n            disabled={!hasChildren}\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <EditIcon />\n          </IconButton>\n\n          <IconButton\n            color=\"primary\"\n            onClick={() => {\n              graph.setActiveMode('insert')\n            }}\n            className={classes.insertButton}\n          >\n            <AddIcon />\n          </IconButton>\n\n          <SelectButton\n            disabled={!(hasChildren || selectedCount > 0)}\n            node={node}\n            color={graph.activeModes.includes('select') ? 'primary' : undefined}\n            onClick={() => {\n              graph.toggleActiveMode('select')\n            }}\n          />\n\n          <IconButton\n            disabled\n            color={graph.activeModes.includes('edit') ? 'primary' : undefined}\n            onClick={() => graph.toggleActiveMode('edit')}\n          >\n            <TuneIcon />\n          </IconButton>\n\n          {false && (\n            <Button\n              disabled\n              startIcon={<GroupIcon />}\n              onClick={() => {\n                if (graph.activeModes.includes('share')) {\n                  graph.closePeerConnection()\n                } else {\n                  graph.offerPeerConnection(node)\n                }\n              }}\n              color={\n                graph.activeModes.includes('share') ? 'primary' : undefined\n              }\n            >\n              share\n            </Button>\n          )}\n        </Toolbar>\n      </Box>\n    )\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { AppBar, Box, fade } from '@material-ui/core'\nimport { Instance } from 'mobx-state-tree'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { useNavigate } from '@reach/router'\n\nimport { makeUrl } from 'route'\nimport { TitleBar } from 'common'\nimport { NoteEditor } from 'note'\n\nimport { Node, useGraph, NodeActions } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      textAlign: 'center',\n      position: 'relative',\n      paddingBottom: theme.spacing(8),\n    },\n\n    appBar: {\n      position: 'sticky',\n      borderBottom: `.01px solid ${theme.palette.divider}`,\n      backdropFilter: 'blur(3px)',\n      background: `\n        linear-gradient(\n          to top,\n          ${fade(theme.palette.background.default, 0.9)},\n          ${fade(theme.palette.background.default, 1)} 90%\n        )`,\n    },\n\n    titleBar: {\n      background: 'unset',\n    },\n\n    children: {},\n\n    textEditor: {\n      position: 'sticky',\n      bottom: 0,\n    },\n\n    actions: {\n      borderTop: `.01px solid ${theme.palette.divider}`,\n      zIndex: theme.zIndex.appBar,\n\n      position: 'fixed',\n      bottom: 0,\n      left: '50%',\n      width: '100%',\n      transform: 'translateX(-50%)',\n\n      [theme.breakpoints.up('sm')]: {\n        maxWidth: '900px',\n      },\n    },\n  }),\n)\n\ninterface LayoutProps {\n  node: Instance<typeof Node>\n  className?: string\n}\n\nexport const NodeLayout: React.FunctionComponent<LayoutProps> = ({\n  node,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  const navigate = useNavigate()\n\n  /* React.useEffect(() => { */\n  /*   const handler = (event: KeyboardEvent): void => { */\n  /*     console.log({ event }) */\n  /*   } */\n\n  /*   document.addEventListener('keydown', handler) */\n  /*   return () => { */\n  /*     document.removeEventListener('keydown', handler) */\n  /*   } */\n  /* }) */\n\n  return useGraph(graph => {\n    let titleText: string\n    const content = node.content?.toJSON?.()\n\n    if (typeof node.content === 'string') {\n      titleText = node.content\n    } else if (content) {\n      titleText = content.blocks?.[0]?.text\n    } else {\n      titleText = node.id\n    }\n\n    return (\n      <Box className={[classes.root, className].join(' ')}>\n        <AppBar elevation={0} className={classes.appBar}>\n          <TitleBar title={titleText} className={classes.titleBar} />\n        </AppBar>\n\n        <Box\n          className={[\n            classes.children,\n            graph.activeModes.includes('insert') ? 'fade' : '',\n          ].join(' ')}\n        >\n          {children}\n        </Box>\n        {graph.activeModes.includes('insert') && (\n          <NoteEditor\n            autoFocus\n            className={classes.textEditor}\n            onValue={(value, event) => {\n              if (value) {\n                const child = graph.createChild(node, { content: value })\n                if (event?.ctrlKey) {\n                  navigate(makeUrl(`/node/${child.id}/`))\n                } else {\n                  return true\n                }\n              } else {\n                graph.toggleActiveMode('insert')\n              }\n            }}\n            onEscape={() => {\n              graph.unsetActiveMode('insert')\n            }}\n          />\n        )}\n\n        <NodeActions\n          node={node}\n          className={[\n            classes.actions,\n            graph.activeModes.includes('insert') ? 'fade' : '',\n          ].join(' ')}\n        />\n      </Box>\n    )\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\n\nimport { NodeLayout, EdgeList, useGraph, ActiveProvider } from 'graph'\n\ninterface NodeViewerProps {\n  id?: string\n}\n\nexport const NodeViewer: React.FunctionComponent<NodeViewerProps> = ({ id }) =>\n  useGraph(graph => {\n    const lookup = graph.Node.get(id)\n    const node = lookup ?? graph.rootNode\n\n    return node ? (\n      <ActiveProvider value={node}>\n        <NodeLayout node={node}>\n          <EdgeList node={node} edgeTag=\"child\" />\n        </NodeLayout>\n      </ActiveProvider>\n    ) : null\n  })\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport * as reach from '@reach/router'\n\nimport { useGraph } from 'graph'\nimport { NodeViewer } from 'graph'\nimport { PeerConnector } from 'peer'\nimport { Settings } from 'common'\n\n// Necessary for now because this routing library is bad.\nexport function makeUrl(path = ''): string {\n  return process.env.PUBLIC_URL + path\n}\n\nexport type RouteProps<T = unknown> = {\n  component: React.FunctionComponent<T>\n} & reach.RouteComponentProps\n\nexport const Route: React.FunctionComponent<RouteProps> = ({\n  component: Component,\n  ...props\n}) => <Component {...props} />\n\nexport const Router: React.FunctionComponent = () =>\n  useGraph(graph =>\n    graph.rootNode ? (\n      <reach.Router basepath={process.env.PUBLIC_URL}>\n        <Route path=\"/\" component={NodeViewer} />\n        <Route path=\":type/:id\" component={NodeViewer} />\n        <Route path=\"peer/:id\" component={PeerConnector} />\n        <Route path=\"settings\" component={Settings} />\n      </reach.Router>\n    ) : null,\n  )\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  // https://github.com/mui-org/material-ui/issues/13394\n  // TODO Remove when Material UI v5 is out.\n  unstable_createMuiStrictModeTheme as createMuiTheme,\n  ThemeProvider as MuiThemeProvider,\n  fade,\n} from '@material-ui/core/styles'\nimport { useMediaQuery, CssBaseline, PaletteType } from '@material-ui/core'\n\nexport const useDarkMode = (): ReturnType<typeof useMediaQuery> =>\n  useMediaQuery('(prefers-color-scheme: dark)')\n\nexport const ThemeProvider: React.FunctionComponent = ({ children }) => {\n  const prefersDarkMode = useDarkMode()\n  const theme: ReturnType<typeof createMuiTheme> = React.useMemo(() => {\n    const palette = {\n      type: (prefersDarkMode ? 'dark' : 'light') as PaletteType,\n      primary: { main: '#FF2EA2' },\n      secondary: { main: '#FF8F00' },\n      divider: prefersDarkMode ? '#222222' : '#e0e0e0',\n      background: {\n        default: prefersDarkMode ? '#000000' : '#ffffff',\n        paper: prefersDarkMode ? '#101010' : '#fbfbfb',\n      },\n      text: {\n        primary: prefersDarkMode ? '#dddddd' : '#212121',\n        secondary: prefersDarkMode ? '#aaaaaa' : '#595959',\n      },\n    }\n\n    return createMuiTheme({\n      typography: {\n        fontSize: 16,\n\n        // use responsiveFontSizes\n\n        fontFamily: [\n          '-apple-system',\n          'system-ui',\n          'BlinkMacSystemFont',\n          '\"Segoe UI\"',\n          'Roboto',\n          '\"Helvetica Neue\"',\n          'Arial',\n          'sans-serif',\n        ].join(', '),\n      },\n\n      palette,\n\n      shape: {\n        borderRadius: 6,\n      },\n\n      props: {\n        MuiButton: {\n          disableElevation: true,\n        },\n\n        MuiButtonGroup: {\n          disableElevation: true,\n        },\n      },\n\n      overrides: {\n        MuiButtonBase: {\n          root: {\n            cursor: 'default',\n          },\n        },\n\n        MuiCssBaseline: {\n          '@global': {\n            '*::selection': {\n              backgroundColor: fade(palette.primary.main, 0.2),\n            },\n\n            html: {\n              userSelect: 'none',\n              overscrollBehavior: 'none',\n              '-webkit-touch-callout': 'none',\n              maxWidth: '900px',\n              margin: 'auto',\n              '&, & body': {\n                height: '100%',\n              },\n            },\n          },\n        },\n      },\n    })\n  }, [prefersDarkMode])\n\n  return (\n    <MuiThemeProvider theme={theme}>\n      <CssBaseline />\n      {children}\n    </MuiThemeProvider>\n  )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\n/* eslint-disable no-console */\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n\n        if (installingWorker == null) {\n          return\n        }\n\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      )\n    })\n}\n\nexport function unregister(): void {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport 'mobx-react-lite/batchingForReactDom'\n\nimport { StoreProvider } from './store'\nimport { ThemeProvider } from './theme'\nimport { Router } from './route'\nimport * as serviceWorker from './serviceWorker'\n\nReactDOM.render(\n  <React.StrictMode>\n    <StoreProvider>\n      <ThemeProvider>\n        <Router />\n      </ThemeProvider>\n    </StoreProvider>\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\nserviceWorker.register()\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { AppBar, Box } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { TitleBar } from 'common'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    appBar: {},\n    actions: {\n      width: '100%',\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    children: {},\n  }),\n)\n\ninterface LayoutProps {\n  title?: string\n  actions?: React.ReactElement\n  className?: string\n}\n\nexport const Layout: React.FunctionComponent<LayoutProps> = ({\n  title,\n  actions,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  return (\n    <Box className={[classes.root, className].join(' ')}>\n      <AppBar elevation={0} position=\"sticky\" className={classes.appBar}>\n        <TitleBar title={title} />\n        {actions}\n      </AppBar>\n      <Box className={classes.children}>{children}</Box>\n    </Box>\n  )\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Typography, Toolbar, IconButton } from '@material-ui/core'\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Link } from '@reach/router'\n\nimport { makeUrl } from 'route'\nimport { isRootPath } from 'common'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n\n    backButton: {\n      cursor: 'pointer',\n      '&[disabled]': {\n        visibility: 'hidden',\n        pointerEvents: 'none',\n      },\n    },\n\n    hide: {\n      visibility: 'hidden',\n      mouseEvents: 'none',\n    },\n\n    settingsButton: {},\n\n    title: {\n      flexGrow: 1,\n      textAlign: 'center',\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      color: theme.palette.text.primary,\n    },\n  }),\n)\n\ninterface TitleBarProps {\n  title?: string\n  showBackButton?: boolean\n  showSettingsButton?: boolean\n  className?: string\n}\n\nexport const TitleBar: React.FunctionComponent<TitleBarProps> = ({\n  title,\n  showBackButton,\n  showSettingsButton,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  const newlinePosition = title?.indexOf('\\n') ?? -1\n\n  return (\n    <Toolbar className={[classes.root, className].join(' ')}>\n      <IconButton\n        disabled={isRootPath()}\n        edge=\"start\"\n        aria-label=\"back\"\n        onClick={() => window.history.back()}\n        className={[\n          classes.backButton,\n          showBackButton ? '' : classes.hide,\n        ].join(' ')}\n      >\n        <ChevronLeftIcon />\n      </IconButton>\n\n      {title && (\n        <Typography variant=\"h6\" component=\"h1\" className={classes.title}>\n          {newlinePosition > 0 ? title.slice(0, title.indexOf('\\n')) : title}\n        </Typography>\n      )}\n\n      <IconButton\n        disabled\n        edge=\"end\"\n        component={Link}\n        to={makeUrl(`/settings`)}\n        aria-label=\"settings\"\n        className={[\n          classes.settingsButton,\n          showSettingsButton ? '' : classes.hide,\n        ].join(' ')}\n      >\n        {<SettingsIcon fontSize=\"small\" />}\n      </IconButton>\n    </Toolbar>\n  )\n}\n\nTitleBar.defaultProps = {\n  title: 'Exuo',\n  showBackButton: true,\n  showSettingsButton: false,\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemSecondaryAction,\n  ListItemText,\n  ListSubheader,\n  Switch,\n} from '@material-ui/core'\nimport PlaylistAddCheckIcon from '@material-ui/icons/PlaylistAddCheck'\nimport BorderAllIcon from '@material-ui/icons/BorderAll'\nimport AccountTreeIcon from '@material-ui/icons/AccountTree'\n\nimport { Layout } from 'common'\nimport { useGraph } from 'graph'\n\nexport const Settings: React.FunctionComponent = () => {\n  return useGraph(graph => (\n    <Layout>\n      <List subheader={<ListSubheader>Global</ListSubheader>}>\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n      <List subheader={<ListSubheader>Lists</ListSubheader>}>\n        <ListItem>\n          <ListItemIcon>\n            <PlaylistAddCheckIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-checkboxes\"\n            primary=\"Checkboxes\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              checked={graph.listCheckboxSetting ?? false}\n              onChange={() => graph.toggleListCheckboxSetting()}\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-checkboxes',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <AccountTreeIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-bluetooth\"\n            primary=\"Show Extra Edge Types\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{ 'aria-labelledby': 'switch-list-label-bluetooth' }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n    </Layout>\n  ))\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { makeUrl } from 'route'\n\nexport const isRootPath = (): boolean =>\n  window.location.pathname === makeUrl('/') ||\n  window.location.pathname === makeUrl()\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  Instance,\n  onPatch,\n  getSnapshot,\n  getMembers,\n  applySnapshot,\n  IAnyModelType,\n  IJsonPatch,\n  isStateTreeNode,\n} from 'mobx-state-tree'\nimport Dexie from 'dexie'\n\nexport async function persist(\n  instance: Instance<IAnyModelType>,\n): Promise<void> {\n  const db = new Dexie('default')\n  const tableNames = Object.keys(getMembers(instance).properties)\n  const tableConfig = Object.fromEntries(tableNames.map(name => [name, 'id']))\n\n  db.version(1).stores(tableConfig)\n\n  return Promise.all(\n    tableNames.map(name =>\n      db\n        .table(name)\n        .toArray()\n        .then(rows => [name, Object.fromEntries(rows.map(r => [r.id, r]))]),\n    ),\n  ).then(resolved => {\n    applySnapshot(instance, Object.fromEntries(resolved))\n\n    let buffer: Array<IJsonPatch> = []\n    let timeout: ReturnType<typeof setTimeout>\n\n    onPatch(instance, patch => {\n      buffer.push(patch)\n\n      if (timeout) {\n        clearTimeout(timeout)\n      }\n\n      timeout = setTimeout(() => {\n        buffer.forEach(patch => {\n          const [typeName, id, propName] = patch.path.split('/').slice(1)\n\n          if (patch.op === 'add') {\n            db.table(typeName).put(getSnapshot(instance[typeName].get(id)))\n          } else if (patch.op === 'replace' || patch.op === 'remove') {\n            if (propName) {\n              let propValue = instance[typeName].get(id)[propName]\n\n              if (isStateTreeNode(propValue)) {\n                propValue = getSnapshot(propValue)\n              }\n\n              db.table(typeName).update(id, {\n                [propName]: propValue,\n              })\n            } else {\n              db.table(typeName).delete(id)\n            }\n          } else {\n            throw Error(`Unknown patch op '${patch.op}'`)\n          }\n        })\n\n        buffer = []\n      }, 1000)\n    })\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\n\nimport { Graph } from 'graph'\n\nimport { Store } from './models/Store'\n\nconst store = Store.create({\n  graph: Graph.create(),\n})\n\nexport const storeContext = React.createContext<Instance<typeof Store>>(store)\n\nexport const StoreProvider: React.FunctionComponent = ({ children }) =>\n  React.createElement(storeContext.Provider, { value: store }, children)\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { List, ListItem, ListItemText } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { getMembers, Instance, isStateTreeNode } from 'mobx-state-tree'\n\nimport { useGraph, Node } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    item: {},\n    itemText: {},\n  }),\n)\n\ninterface PropertyEditorProps {\n  node?: Instance<typeof Node> | string\n  propName?: string\n  minimal?: boolean\n}\n\nexport const PropertyEditor: React.FunctionComponent<PropertyEditorProps> = props => {\n  const classes = useStyles()\n\n  return useGraph(graph => {\n    let node = props.node\n    if (typeof node === 'string') {\n      node = graph.Node.get(props.node)\n    }\n\n    if (!isStateTreeNode(node)) {\n      return <></> // Loading\n    }\n\n    const members = getMembers(node)\n    const properties = Object.keys(members.properties)\n\n    const handleSubmit: React.EventHandler<React.SyntheticEvent> = () => {\n      console.log('submit')\n    }\n\n    return (\n      <form onSubmit={handleSubmit}>\n        <List className={classes.root}>\n          {properties.map(value => (\n            <ListItem dense button key={value} className={classes.item}>\n              <ListItemText\n                primary={value}\n                id={`list-content-${value}`}\n                className={classes.itemText}\n              />\n            </ListItem>\n          ))}\n        </List>\n      </form>\n    )\n  })\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types } from 'mobx-state-tree'\n\nimport { Graph } from 'graph'\n\nexport const Store = types\n  .model('Store', {\n    graph: Graph,\n    location: types.optional(types.string, '/'),\n  })\n  .actions(self => ({\n    setLocation(path: string) {\n      self.location = path\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { useObserver } from 'mobx-react-lite'\n\nimport { Store, storeContext } from 'store'\n\nexport function useStore<S>(selector: (s: Instance<typeof Store>) => S): S {\n  const store = React.useContext(storeContext)\n  if (store) {\n    return useObserver(() => selector(store))\n  } else {\n    throw Error('Cannot use store before setup')\n  }\n}\n"],"sourceRoot":""}