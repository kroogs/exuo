{"version":3,"sources":["serviceWorker.ts","graph/models/Config.ts","graph/models/Log.ts","graph/persist.ts","graph/factories.ts","graph/models/Node.ts","graph/models/Graph.ts","graph/setup.tsx","theme.tsx","components/SelectionActions.tsx","components/LabelEditor.tsx","components/NodeActions.tsx","components/NodeLayout.tsx","components/NodeListItem.tsx","components/EdgeList.tsx","components/InstanceViewer.tsx","components/Layout.tsx","components/PeerConnector.tsx","components/Settings.tsx","router.tsx","index.tsx","../node_modules/peerjs/dist sync"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","Basic","t","union","null","boolean","string","number","array","late","map","Config","model","name","maybe","items","actions","self","set","key","value","views","get","types","Event","type","date","Date","payload","Log","events","logEvent","push","create","now","graph","a","db","Dexie","tableNames","Object","keys","getMembers","properties","tableConfig","fromEntries","version","stores","Promise","all","table","toArray","rows","r","id","resolved","applySnapshot","onPatch","patch","path","split","slice","typeName","propName","op","put","getSnapshot","Error","update","delete","persist","edgeMapFactory","getEdgeType","edgeMap","safeReference","acceptsUndefined","hasEdge","tag","target","includes","length","addEdge","has","removeEdge","remove","getEdgeTag","nodeFactory","models","compose","identifier","concat","named","Node","graphFactory","nodeModels","options","isModelType","isIdentifierType","createNode","modelName","props","node","getId","uuid","label","afterCreate","peerMaker","patchDisposer","peer","Peer","host","port","debug","on","connection","send","Graph","offerPeerConnection","instance","setActiveMode","c","data","unsetActiveMode","seekPeerConnection","peerId","connect","reliable","resolve","reject","child","createChild","rootNode","applyPatch","closePeerConnection","close","disconnect","mode","activeModes","toggleActiveMode","clearSelectedNodes","clear","deleteSelectedNodes","forEach","selectedNodes","toggleSelectNode","selectAllChildNodes","root","rootNodeId","global","dividers","lists","checkbox","showChildCount","showEdgeChips","edgeProps","edgeType","deleteNode","toggleGlobalDividerSetting","toggleListCheckboxSetting","graphContext","React","createContext","GraphProvider","children","createElement","Provider","useGraph","selector","useContext","useObserver","ThemeProvider","prefersDarkMode","useMediaQuery","theme","useMemo","createMuiTheme","typography","fontFamily","join","palette","background","default","primary","main","text","shape","borderRadius","MuiButtonBase","MuiButton","disableElevation","overrides","MuiCssBaseline","html","userSelect","overscrollBehavior","maxWidth","margin","height","CssBaseline","useStyles","makeStyles","createStyles","button","color","action","active","deleteButton","SelectionActions","classes","className","Button","startIcon","disabled","undefined","onClick","padding","inputBase","spacing","LabelEditor","createMode","placeholder","onBlur","useState","inputValue","setInputValue","handleChange","event","onSubmit","preventDefault","InputBase","autoFocus","inputProps","onChange","fullWidth","defaultProps","justifyContent","toggledButton","labelEditor","width","NodeActions","setMode","hasChildren","childCount","Toolbar","variant","pathname","appBar","header","secondary","backgroundColor","textAlign","marginTop","backButton","visibility","pointerEvents","settingsButton","title","flexGrow","overflowX","whiteSpace","textOverflow","Layout","Box","AppBar","elevation","position","IconButton","edge","aria-label","history","back","Typography","component","Link","to","fontSize","listItem","breakpoints","up","itemText","display","body1","listItemSelectCheckbox","listItemIcon","minWidth","editItemText","chip","hint","cursor","paddingRight","secondaryActions","right","childButton","NodeListItem","isFocused","navigate","useNavigate","isMouseDown","useRef","timer","listConfig","downHandler","e","current","setTimeout","clearTimeout","upHandler","isSelected","ListItem","onMouseDown","onTouchStart","onMouseUp","onTouchEnd","Checkbox","checked","tabIndex","ListItemText","primaryTypographyProps","ListItemSecondaryAction","Chip","icon","size","endIcon","list","EdgeList","edgeTag","List","reverse","item","InstanceViewer","NodeLayout","hide","mouseEvents","showBackButton","showSettingsButton","PeerConnector","peerError","setPeerError","hasAccepted","setHasAccepted","align","mt","CircularProgress","Settings","subheader","ListSubheader","ListItemIcon","Switch","listCheckboxSetting","Route","Component","Router","ReactDOM","render","StrictMode","document","getElementById","URL","process","href","origin","addEventListener","fetch","headers","response","contentType","status","indexOf","ready","unregister","reload","checkValidServiceWorker","webpackEmptyContext","req","code","module","exports"],"mappings":"0IAcMA,G,MAAcC,QACW,cAA7BC,OAAOC,SAASC,UAEe,UAA7BF,OAAOC,SAASC,UAEhBF,OAAOC,SAASC,SAASC,MACvB,4DA2CN,SAASC,EAAgBC,EAAeC,GACtCC,UAAUC,cACPC,SAASJ,GACTK,MAAK,SAAAC,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiBG,QACfT,UAAUC,cAAcS,YAI1BC,QAAQC,IACN,iHAKEb,GAAUA,EAAOc,UACnBd,EAAOc,SAAST,KAMlBO,QAAQC,IAAI,sCAGRb,GAAUA,EAAOe,WACnBf,EAAOe,UAAUV,WAO5BW,OAAM,SAAAC,GACLL,QAAQK,MAAM,4CAA6CA,M,mBClF3DC,EAAQC,IAAEC,MACdD,IAAEE,KACFF,IAAEG,QACFH,IAAEI,OACFJ,IAAEK,OACFL,IAAEM,MAAMN,IAAEO,MAAK,kBAAgBR,MAC/BC,IAAEQ,IAAIR,IAAEO,MAAK,kBAAgBR,OAGlBU,EAAST,IACnBU,MAAM,SAAU,CACfC,KAAMX,IAAEY,MAAMZ,IAAEI,QAChBS,MAAOb,IAAEQ,IAAIT,KAEde,SAAQ,SAAAC,GAAI,MAAK,CAChBC,IADgB,SACZC,EAAaC,GACfH,EAAKF,MAAMG,IAAIC,EAAKC,QAGvBC,OAAM,SAAAJ,GAAI,MAAK,CACdK,IADc,SACVH,GACF,OAAOF,EAAKF,MAAMO,IAAIH,QCrBtBlB,EAAQsB,IAAMpB,MAClBoB,IAAMnB,KACNmB,IAAMlB,QACNkB,IAAMjB,OACNiB,IAAMhB,OACNgB,IAAMd,MAAK,kBAAgBc,IAAMf,MAAMP,OAG5BuB,EAAQD,IAAMX,MAAM,QAAS,CACxCa,KAAMF,IAAMjB,OACZoB,KAAMH,IAAMI,KACZC,QAASL,IAAMT,MAAMb,KAGV4B,EAAMN,IAChBX,MAAM,MAAO,CACZkB,OAAQP,IAAMf,MAAMgB,KAErBR,SAAQ,SAAAC,GAAI,MAAK,CAChBc,SADgB,SACPN,EAAcG,GACrBX,EAAKa,OAAOE,KACVR,EAAMS,OAAO,CACXP,KAAMC,KAAKO,MACXN,UACAH,e,+HChBH,WAAuBU,GAAvB,mBAAAC,EAAA,6DACCC,EAAK,IAAIC,IAAM,WACfC,EAAaC,OAAOC,KAAKC,YAAWP,GAAOQ,YAC3CC,EAAcJ,OAAOK,YAAYN,EAAW7B,KAAI,SAAAG,GAAI,MAAI,CAACA,EAAM,UAErEwB,EAAGS,QAAQ,GAAGC,OAAOH,GALhB,kBAOEI,QAAQC,IACbV,EAAW7B,KAAI,SAAAG,GAAI,OACjBwB,EACGa,MAAMrC,GACNsC,UACAhE,MAAK,SAAAiE,GAAI,MAAI,CAACvC,EAAM2B,OAAOK,YAAYO,EAAK1C,KAAI,SAAA2C,GAAC,MAAI,CAACA,EAAEC,GAAID,eAEjElE,MAAK,SAAAoE,GACLC,YAAcrB,EAAOK,OAAOK,YAAYU,IACxCE,YAAQtB,GAAO,SAAAuB,GAAU,IAAD,EACWA,EAAMC,KAAKC,MAAM,KAAKC,MAAM,GADvC,mBACfC,EADe,KACLR,EADK,KACDS,EADC,KAEtB,GAAiB,QAAbL,EAAMM,GACR3B,EAAGa,MAAMY,GAAUG,IAAIC,YAAY/B,EAAM2B,GAAUxC,IAAIgC,SAClD,IAAiB,YAAbI,EAAMM,IAAiC,WAAbN,EAAMM,GASzC,MAAMG,MAAM,qBAAD,OAAsBT,EAAMM,GAA5B,MARPD,EACF1B,EAAGa,MAAMY,GAAUM,OAAOd,EAA1B,eACGS,EAAWG,YAAY/B,EAAM2B,GAAUxC,IAAIgC,GAAIS,MAGlD1B,EAAGa,MAAMY,GAAUO,OAAOf,WA1B7B,4C,sBAmCQgB,MAnCR,SAAP,mC,QCKaC,EAAiB,SAACC,GAAD,OAC5BjD,IACGX,MAAM,UAAW,CAChB6D,QAASlD,IAAMb,IACba,IAAMf,MACJe,IAAMmD,cAAcnD,IAAMd,KAAK+D,GAAc,CAC3CG,kBAAkB,QAKzB3D,SAAQ,SAAAC,GAAI,MAAK,CAChB2D,QADgB,SACRC,EAAaC,GACN,IAAD,EAEL,EAFP,OAAIA,EACKtG,QAAO,UAACyC,EAAKwD,QAAQnD,IAAIuD,UAAlB,aAAC,EAAuBE,SAASD,IAExCtG,QAAO,UAACyC,EAAKwD,QAAQnD,IAAIuD,UAAlB,aAAC,EAAuBG,aAI3ChE,SAAQ,SAAAC,GAAI,MAAK,CAChBgE,QADgB,SACRJ,EAAaC,GAAwC,IAAD,EACrD7D,EAAKwD,QAAQS,IAAIL,IACpB5D,EAAKwD,QAAQvD,IAAI2D,EAAK,IAGxB,UAAA5D,EAAKwD,QAAQnD,IAAIuD,UAAjB,SAAuB7C,KAAK8C,IAG9BK,WATgB,SASLN,EAAaC,GAAwC,IAAD,EAC7D,KAAI,UAAC7D,EAAKwD,QAAQnD,IAAIuD,UAAlB,aAAC,EAAuBO,OAAON,IACjC,MAAMX,MAAM,SAAD,OAAUlD,EAAV,qBAA2B4D,EAA3B,uBAA6CC,EAA7C,WAIhBzD,OAAM,SAAAJ,GAAI,MAAK,CACdoE,WADc,SACHR,GACT,OAAO5D,EAAKwD,QAAQnD,IAAIuD,SAInBS,EAAc,eACzBC,EADyB,uDACsB,GADtB,OAGzBhE,IACGiE,QADH,MAAAjE,IAAK,YAGE,CACDA,IAAMX,MAAM,CACV0C,GAAI/B,IAAMkE,cAEZC,OAAOH,KAEVI,MAAM,SAEEC,EAAON,EAAYf,GAAe,kBAAMqB,MAMxCC,EAAe,eAC1BC,EAD0B,uDACD,CAAEF,QAC3BG,EAF0B,uDAEK,GAFL,OAI1BxE,IACGX,MACC,QACA4B,OAAOK,YACLL,OAAOC,KAAKqD,GAAYpF,KAAI,SAAAS,GAC1B,IAAMP,EAAQkF,EAAW3E,GAEzB,GAAI6E,YAAYpF,IAAUqF,YAAiBrF,EAAM+B,WAAWW,IAC1D,MAAO,CAACnC,EAAKI,IAAMb,IAAIoF,EAAW3E,KAIpC,MAAMgD,MAAM,UAAD,OAAWhD,EAAX,oCAIhBH,SAAQ,SAAAC,GAAI,MAAK,CAChBiF,WADgB,WAIY,IAAD,IAFzBC,EAEyB,uDAFb,OACZC,EACyB,uDADU,GAEnC,IAAKN,EAAWK,GACd,MAAMhC,MAAM,mBAAD,OAAoBgC,EAApB,MAGb,IAAME,EAAOP,EAAWK,GAAWlE,OAAtB,aACXqB,GAAE,oBAAEyC,EAAQO,aAAV,aAAE,OAAAP,UAAF,QAAuBQ,eACtBH,IAKL,OAFAnF,EAAKkF,GAAWlC,IAAIoC,GAEbA,QC3GF1F,GD+GQkF,IC/GCP,EAAYC,IACrBK,EAAON,EAAY,CAC9BC,EACAhB,GAAe,kBACbhD,IAAMpB,MACJoB,IAAMd,MAAK,kBAAgBmF,KAC3BjF,QAIHyF,MAAM,CACLI,MAAOjF,IAAMT,MAAMS,IAAMjB,UAE1BU,SAAQ,SAAAC,GAAI,MAAK,CAChBwF,YADgB,WAEdxF,EAAKc,SAAS,eAGjBV,OAAM,SAAAJ,GAAI,MAAK,CACd,iBAA0B,IAAD,IACvB,2BAAOA,EAAKwD,QAAQnD,IAAI,gBAAxB,aAAO,EAA2B0D,cAAlC,QAA4C,GAG9C,iBAAwB,IAAD,EACrB,iBAAO/D,EAAKa,OAAO,UAAnB,aAAO,EAAgBJ,UCbvBgF,EAAY,SAACvE,EAA+BmB,GAChD,IAQIqD,EAREC,EAAO,IAAIC,IAAKvD,EAAI,CACxBwD,KAAM,2BACNC,KAAM,GAGNC,MAAO,IAuBT,OAlBAJ,EAAKK,GAAG,cAAc,SAAAC,GACpBvH,QAAQC,IAAI,WACZsH,EAAWD,GAAG,QAAQ,WACpBtH,QAAQC,IAAI,QACZ+G,EAAgBlD,YAAQtB,GAAO,SAAAuB,GAER,SADHA,EAAMC,KAAKC,MAAM,KAAKC,MAAM,GAChC,KACZlE,QAAQC,IAAI,aAAc8D,GAChB,OAAVwD,QAAU,IAAVA,KAAYC,KAAKzD,OAIrBwD,EAAWD,GAAG,SAAS,WAAO,IAAD,EACd,QAAb,EAAAN,SAAA,oBAKCC,GAWF,IAAMQ,EAAQvB,EAAa,CAAED,OAAMjF,WAEvCK,SAAQ,SAAAC,GACP,IAAI2F,EAAoB,KACpBM,EAAyC,KAK7C,MAAO,CACLG,oBADK,SACeC,IAClBV,EAAOF,EAAUzF,EAAMqG,EAAShE,KAE3B2D,GAAG,QAAQ,WACdhG,EAAKsG,cAAc,YAGrBX,EAAKK,GAAG,cAAc,SAAAO,IACpBN,EAAaM,GAEFP,GAAG,QAAQ,WAAO,IAAD,EAChB,QAAV,EAAAC,SAAA,SAAYC,KAAZ,2BAAsBjD,YAAYoD,IAAlC,IAA6C7C,QAAS,SAGxDyC,EAAWD,GAAG,QAAQ,SAAAQ,GAChBA,EAAKzD,IACPrE,QAAQC,IAAI,uBAAwB6H,MAKxCP,EAAWD,GAAG,SAAS,WACrBhG,EAAKyG,gBAAgB,gBAKrBC,mBA5BD,SA4BoBC,GAAiD,OAAD,2GACvEhB,EAAOF,EAAUzF,EAAMsF,gBACvBW,EAAaN,EAAKiB,QAAQD,EAAQ,CAAEE,UAAU,KAEnCb,GAAG,SAAS,WACrBhG,EAAKyG,gBAAgB,YAGvBR,EAAWD,GAAG,cAAc,WAC1BhG,EAAKyG,gBAAgB,YATgD,kBAYhE,IAAI1E,SAAQ,SAAC+E,EAASC,GAC3B,IAAKd,EACH,MAAM/C,MAAM,wBAGd+C,EAAWD,GAAG,QAAQ,SAAAQ,GACpB,GAAIA,EAAKnE,GAAI,CACX,IAAM2E,EAAQhH,EAAKiH,YAAYjH,EAAKkH,SAAUV,GAC9CxG,EAAKsG,cAAc,SACnBQ,EAAQE,QACCR,EAAKzD,KACdrE,QAAQC,IAAI,QAAS6H,GACrBW,YAAWnH,EAAMwG,OAIrBP,EAAWD,GAAG,SAAS,SAAAjH,GACrBgI,EAAOhI,UA7B4D,8CAkCzEqI,oBA9DK,WA8DkB,IAAD,IACV,QAAV,EAAAnB,SAAA,SAAYoB,QACR,QAAJ,EAAA1B,SAAA,SAAM2B,aACNtH,EAAKyG,gBAAgB,cAM1B1G,SAAQ,SAAAC,GAAI,MAAK,CAChBsG,cADgB,SACFiB,GACZ,IAAMC,EAAcxH,EAAKN,OAAOW,IAAI,UAAUA,IAAI,eAC9CmH,KAAe,OAACA,QAAD,IAACA,OAAD,EAACA,EAAa1D,SAASyD,KACxCC,EAAYzG,KAAKwG,IAIrBd,gBARgB,SAQAc,GACd,IAAMC,EAAcxH,EAAKN,OAAOW,IAAI,UAAUA,IAAI,gBAClD,OAAImH,QAAJ,IAAIA,OAAJ,EAAIA,EAAa1D,SAASyD,KACxBC,EAAYrD,OAAOoD,IAIvBE,iBAfgB,SAeCF,GACf,IAAMC,EAAcxH,EAAKN,OAAOW,IAAI,UAAUA,IAAI,eAE7CmH,IAIDA,EAAY1D,SAASyD,IACvBC,EAAYrD,OAAOoD,GAGN,WAATA,GACFvH,EAAK0H,sBAGPF,EAAYzG,KAAKwG,SAMtBxH,SAAQ,SAAAC,GAAI,MAAK,CAChB0H,mBADgB,WACM,IAAD,EACnB,UAAA1H,EAAKN,OAAOW,IAAI,UAAUA,IAAI,wBAA9B,SAAgDsH,SAGlDC,oBALgB,WAKO,IAAD,GACD,UAAG5H,EAAKN,OAAOW,IAAI,iBAAnB,aAAG,EAA2BA,IAAI,kBACvCwH,SAAQ,SAACxF,GAAD,OAAgBrC,EAAK2E,KAAKvB,OAAOf,MACvDrC,EAAK0H,qBAC6B,IAA9B1H,EAAK8H,cAAc/D,QACrB/D,EAAKyG,gBAAgB,WAIzBsB,iBAdgB,SAcC3C,GACf,IAAM0C,EAAgB9H,EAAKN,OAAOW,IAAI,UAAUA,IAAI,kBACpD,OAAIyH,QAAJ,IAAIA,OAAJ,EAAIA,EAAehE,SAASsB,EAAK/C,KAClB,OAAbyF,QAAa,IAAbA,KAAe3D,OAAOiB,EAAK/C,IAEd,OAAbyF,QAAa,IAAbA,KAAe/G,KAAKqE,EAAK/C,IAGE,IAAzByF,EAAc/D,QAChB/D,EAAKyH,iBAAiB,WAY1BO,oBAnCgB,SAmCI5C,GAClBA,EAAK5B,QACFnD,IAAI,SACJwH,SAAQ,SAACb,GAAD,OAAkCtI,QAAQC,IAAI,iBAQ5DoB,SAAQ,SAAAC,GAAI,MAAK,CAChBwF,YADgB,WAEdnC,EAAQrD,GAAM9B,MAAK,WACjB,IAAK8B,EAAKN,OAAOuE,IAAI,UAAW,CAC9B,IAAMgE,EAAOjI,EAAKiF,WAAW,OAAQ,CAAEM,MAAO,SAE9CvF,EAAKiF,WAAW,SAAU,CACxB5C,GAAI,SACJvC,MAAO,CACLoI,WAAYD,EAAK5F,GACjBmF,YAAa,GACbM,cAAe,MAInB9H,EAAKiF,WAAW,SAAU,CACxB5C,GAAI,OACJvC,MAAO,CACLqI,OAAQ,CACNC,UAAU,GAEZC,MAAO,CACLC,UAAU,EACVF,UAAU,EACVG,gBAAgB,EAChBC,eAAe,WAQ3BvB,YAjCgB,SAkCd7B,EACAqD,GAEwB,IADxBC,EACuB,uDADZ,OAEL1B,EAAQhH,EAAKiF,WAAWyD,EAAUD,GAKxC,OAHArD,EAAKpB,QAAQ,QAASgD,GACtBA,EAAMhD,QAAQ,SAAUoB,GAEjB4B,GAGT2B,WA9CgB,SA8CLvD,GACTpF,EAAK2E,KAAKvB,OAAOgC,EAAK/C,KAGxBuG,2BAlDgB,WAkDc,IAAD,IACrBzI,EAAK,UAAGH,EAAKN,OAAOW,IAAI,QAAQA,IAAI,iBAA/B,aAAG,EAAuCA,IAAI,YACzD,UAAAL,EAAKN,OAAOW,IAAI,QAAQA,IAAI,iBAA5B,SAAuCJ,IAAI,YAAaE,IAG1D0I,0BAvDgB,WAuDa,IAAD,IACpB1I,EAAK,UAAGH,EAAKN,OAAOW,IAAI,QAAQA,IAAI,gBAA/B,aAAG,EAAsCA,IAAI,YACxD,UAAAL,EAAKN,OAAOW,IAAI,QAAQA,IAAI,gBAA5B,SAAsCJ,IAAI,YAAaE,QAG1DC,OAAM,SAAAJ,GAAI,MAAK,CACd,eACE,IAAMlC,EAASkC,EAAKN,OAAOW,IAAI,UAC/B,OAAOvC,GAAUkC,EAAK2E,KAAKtE,IAAIvC,EAAOuC,IAAI,gBAG5C,kBACE,IAAMvC,EAASkC,EAAKN,OAAOW,IAAI,UAC/B,cAAOvC,QAAP,IAAOA,OAAP,EAAOA,EAAQuC,IAAI,gBAGrB,oBAAqB,IAAD,EAClB,iBAAOL,EAAKN,OAAOW,IAAI,iBAAvB,aAAO,EAA2BA,IAAI,kBAGxC,0BAA2B,IAAD,IACxB,iBAAOL,EAAKN,OAAOW,IAAI,eAAvB,iBAAO,EAAyBA,IAAI,gBAApC,aAAO,EAAuCA,IAAI,iBChS3CyI,EAAeC,IAAMC,cAAsC,MAC3DC,EAER,SAAC,GAAD,IAAGC,EAAH,EAAGA,SAAU/I,EAAb,EAAaA,MAAb,OACH4I,IAAMI,cACJL,EAAaM,SACb,CAAEjJ,MAAK,OAAEA,QAAF,IAAEA,IAASgG,EAAMnF,UACxBkI,IAGG,SAASG,EAAYC,GAC1B,IAAMpI,EAAQ6H,IAAMQ,WAAWT,GAE/B,GAAI5H,EACF,OAAOsI,aAAY,kBAAMF,EAASpI,MAGpC,MAAMgC,MAAM,iC,uCClCDuG,EAAyC,SAAC,GAAkB,IAAhBP,EAAe,EAAfA,SACjDQ,EAAkBC,YAAc,gCAChCC,EAAQb,IAAMc,SAClB,kBACEC,YAAe,CACbC,WAAY,CACVC,WAAY,CACV,gBACA,YACA,qBACA,aACA,SACA,mBACA,QACA,cACAC,KAAK,OAGTC,QAAS,CACP1J,KAAMkJ,EAAkB,OAAS,QACjCS,WAAY,CACVC,QAASV,EAAkB,UAAY,WAEzCW,QAAS,CAAEC,KAAM,WACjBC,KAAM,CACJF,QAASX,EACL,2BACA,uBAIRc,MAAO,CACLC,aAAc,GAGhBtF,MAAO,CACLuF,cAAe,GAGfC,UAAW,CACTC,kBAAkB,IAItBC,UAAW,CACTC,eAAgB,CACd,UAAW,CACTC,KAAM,CACJC,WAAY,OACZC,mBAAoB,OACpB,wBAAyB,OACzBC,SAAU,QACVC,OAAQ,OACR,YAAa,CACXC,OAAQ,gBAYtB,CAAC1B,IAGH,OACE,kBAAC,IAAD,CAAkBE,MAAOA,GACvB,kBAACyB,EAAA,EAAD,MACCnC,I,+MClDDoC,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,GACNwD,OAAQ,CACNC,MAAO9B,EAAMM,QAAQyB,OAAOC,QAE9BC,aAAc,CACZH,MAAO9B,EAAMM,QAAQnL,MAAMuL,WAmClBwB,GA9BmC,WAChD,IAAMC,EAAUT,KAChB,OAAOjC,GAAS,SAAAnI,GAAK,OACnB,yBAAK8K,UAAWD,EAAQ9D,MAetB,kBAACgE,GAAA,EAAD,CACEC,UAAW,kBAAC,KAAD,MACXC,UAAUjL,EAAM4G,cAAc/D,aAASqI,EACvCJ,UAAW,CAACD,EAAQN,OAAQM,EAAQF,cAAc5B,KAAK,KACvDoC,QAAS,kBAAMnL,EAAM0G,wBAJvB,e,UC9BA0D,I,MAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,CACJqE,QAAS,GAGXC,UAAW,CACT,UAAW,CACTD,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,GAChCpB,OAAQ,eAcHqB,GAAyD,SAAC,GAMhE,IALLrH,EAKI,EALJA,KACAsH,EAII,EAJJA,WACAC,EAGI,EAHJA,YACAX,EAEI,EAFJA,UACAY,EACI,EADJA,OAEMb,EAAUT,KADZ,EAEgCvC,IAAM8D,SACxCH,EAAa,GAAKtH,EAAKG,OAHrB,mBAEGuH,EAFH,KAEeC,EAFf,KAMEC,EAAe,SAACC,GACpBF,EAAcE,EAAMpJ,OAAO1D,QAG7B,OAAOkJ,GAAS,SAAAnI,GASd,OACE,yBAAK8K,UAAW,CAACD,EAAQ9D,KAAM+D,GAAW/B,KAAK,MAC7C,0BAAMiD,SAVW,SAACD,GACpBA,EAAME,iBACFL,IACF5L,EAAM+F,YAAY7B,EAAM,CAAEG,MAAOuH,IACjCC,EAAc,MAMgBH,OAAQA,GACpC,kBAACQ,GAAA,EAAD,CACEC,WAAS,EACTV,YAAaA,EACbW,WAAY,CAAE,aAAc,SAC5BC,SAAUP,EACV7M,MAAO2M,EACPd,UAAWD,EAAQQ,UACnBiB,WAAS,UAQrBf,GAAYgB,aAAe,CACzBf,YAAY,EACZC,YAAa,SAGAF,UCtETnB,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,CACJyF,eAAgB,UAElBjC,OAAQ,GACRkC,cAAe,GACfC,YAAa,CACXC,MAAO,aA2FEC,GA/EgD,SAAC,GAGzD,IAFL1I,EAEI,EAFJA,KACA4G,EACI,EADJA,UAEMD,EAAUT,KADZ,EAEoBvC,IAAM8D,SAAqB,UAF/C,mBAEGtF,EAFH,KAESwG,EAFT,KAIJ,OAAO1E,GAAS,SAAAnI,GACd,IAAM8M,GAAkB,OAAJ5I,QAAI,IAAJA,OAAA,EAAAA,EAAM6I,YAAa,EACvC,OACE,kBAACC,EAAA,EAAD,CAASC,QAAQ,QAAQnC,UAAW,CAACD,EAAQ9D,KAAM+D,GAAW/B,KAAK,MACvD,WAAT1C,IAAsBrG,EAAMsG,YAAY1D,SAAS,WAChD,oCACE,kBAACmI,GAAA,EAAD,CACEC,UAAW,kBAAC,KAAD,MACXG,QAAS,kBAAM0B,EAAQ,QACvB/B,UAAWD,EAAQN,QAHrB,OAQCuC,GACC,kBAAC/B,GAAA,EAAD,CACEE,UAAQ,EACRD,UAAW,kBAAC,KAAD,MACXG,QAAS,kBAAMnL,EAAMuG,iBAAiB,SACtCuE,UAAW,CACTD,EAAQN,OACRvK,EAAMsG,YAAY1D,SAAS,QACvBiI,EAAQ4B,cACR,IACJ1D,KAAK,MATT,QAe4B,MAA7BzM,OAAOC,SAAS2Q,UACf,kBAACnC,GAAA,EAAD,CACEC,UAAW,kBAAC,KAAD,MACXG,QAAS,WACHnL,EAAMsG,YAAY1D,SAAS,SAC7B5C,EAAMkG,sBAENlG,EAAMkF,oBAAoBhB,IAG9BsG,MACExK,EAAMsG,YAAY1D,SAAS,SAAW,UAAY,UAEpDkI,UAAWD,EAAQN,QAZrB,UAoBI,WAATlE,GAAqBrG,EAAMsG,YAAY1D,SAAS,WAC/C,kBAAC,GAAD,MAGQ,QAATyD,GACC,kBAAC,GAAD,CACEoF,YAAY,QACZvH,KAAMA,EACNwH,OAAQ,kBAAMmB,EAAQ,WACtB/B,UAAWD,EAAQ6B,eAItB,GAEA,OC7FHtC,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,GACNoG,OAAQ,GACRC,OAAQ,CACN5C,MAAO9B,EAAMM,QAAQK,KAAKgE,UAC1BC,gBAAiB5E,EAAMM,QAAQC,WAAWC,QAC1CkC,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,IAElCzM,QAAS,CACP8N,MAAO,OACPY,UAAW,SACX/C,MAAO9B,EAAMM,QAAQK,KAAKgE,UAC1BC,gBAAiB5E,EAAMM,QAAQC,WAAWC,QAC1CkC,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,IAElCtD,SAAU,CACRwF,WAAY9E,EAAM4C,QAAQ,IAE5BmC,WAAY,CACV,cAAe,CACbC,WAAY,SACZC,cAAe,SAGnBC,eAAgB,GAChBC,MAAO,CACLC,SAAU,EACVP,UAAW,SACXQ,UAAW,SACXC,WAAY,SACZC,aAAc,WACdzD,MAAO9B,EAAMM,QAAQK,KAAKF,cAwDjB+E,GA9CsC,SAAC,GAI/C,IAHLhK,EAGI,EAHJA,KACA4G,EAEI,EAFJA,UACA9C,EACI,EADJA,SAEM6C,EAAUT,KAChB,OAAOjC,GAAS,SAAAnI,GAAK,OACnB,kBAACmO,EAAA,EAAD,CAAKrD,UAAW,CAACD,EAAQ9D,KAAM+D,GAAW/B,KAAK,MAC7C,kBAACqF,EAAA,EAAD,CAAQC,UAAW,EAAGC,SAAS,SAASxD,UAAWD,EAAQsC,QACzD,kBAACH,EAAA,EAAD,CAASC,QAAQ,QAAQnC,UAAWD,EAAQuC,QAC1C,kBAACmB,EAAA,EAAD,CACEtD,SAAuC,MAA7B3O,OAAOC,SAAS2Q,eAA0BhC,EACpDsD,KAAK,QACLC,aAAW,OACXtD,QAAS,kBAAM7O,OAAOoS,QAAQC,QAC9B7D,UAAWD,EAAQ4C,YAEnB,kBAAC,IAAD,OAGDvJ,EAAKG,OACJ,kBAACuK,EAAA,EAAD,CAAY3B,QAAQ,KAAKnC,UAAWD,EAAQgD,OACzC3J,EAAKG,OAIV,kBAACkK,EAAA,EAAD,CACEtD,UAAQ,EACRuD,KAAK,MACLK,UAAWC,IACXC,GAAE,YACFN,aAAW,WACX3D,UAAWD,EAAQ+C,gBAElB,kBAAC,KAAD,CAAcoB,SAAS,YAI3B9K,GAAQ,kBAAC,GAAD,CAAaA,KAAMA,EAAM4G,UAAWD,EAAQhM,WAGvD,kBAACsP,EAAA,EAAD,CAAKrD,UAAWD,EAAQ7C,UAAWA,Q,oGC5EnCoC,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,GACNkI,SAAS,eACNvG,EAAMwG,YAAYC,GAAG,MAAQ,CAC5B5F,aAAcb,EAAMY,MAAMC,eAG9B6F,SAAS,aACPC,QAAS,eACTpF,OAAQ,EACR8D,UAAW,SACXC,WAAY,SACZC,aAAc,YACXvF,EAAMG,WAAWyG,OAEtBC,uBAAwB,CACtBnE,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,GAChC,+BAAgC,CAC9BgC,gBAAiB,UAGrBkC,aAAc,CACZC,SAAU,QAEZC,aAAa,yBACXL,QAAS,eACTpF,OAAQ,EACR8D,UAAW,SACXC,WAAY,SACZC,aAAc,YACXvF,EAAMG,WAAWyG,OANV,IAOV,UAAW,CACTpF,OAAQ,OACRkB,QAAS,KAGbuE,KAAM,CACJhC,cAAe,OACfnD,MAAO9B,EAAMM,QAAQK,KAAKuG,KAC1BtC,gBAAiB,cACjB,UAAW,CACT9C,MAAO9B,EAAMM,QAAQG,QAAQC,KAC7ByG,OAAQ,QAEV,QAAS,CACPlC,cAAe,OACfnD,MAAO,WAET,8BAA+B,CAC7BsF,aAAc,IAGlBC,iBAAkB,CAChBC,MAAO,EACPxF,MAAO9B,EAAMM,QAAQK,KAAKgE,WAE5B4C,YAAa,CACXzF,MAAO9B,EAAMM,QAAQK,KAAKgE,UAC1B,mBAAoB,CAClB7C,MAAO9B,EAAMM,QAAQG,QAAQC,KAC7BH,WAAY,iBAiILiH,GAvHkD,SAAC,GAG3D,IAFLhM,EAEI,EAFJA,KAGM2G,GADF,wBACYT,MADZ,EAE8BvC,IAAM8D,UAAS,GAF7C,mBAEGwE,EAFH,KAGEC,GAHF,KAGaC,eAIXC,EAAczI,IAAM0I,QAAO,GAC3BC,EAAQ3I,IAAM0I,SAEpB,OAAOpI,GAAS,SAAAnI,GAAU,IAAD,EACjByQ,EAAU,UAAGzQ,EAAMxB,OAAOW,IAAI,eAApB,aAAG,EAA0BA,IAAI,SAE3CkI,EAAc,OAAGoJ,QAAH,IAAGA,OAAH,EAAGA,EAAYtR,IAAI,kBACjCmI,EAAa,OAAGmJ,QAAH,IAAGA,OAAH,EAAGA,EAAYtR,IAAI,iBAEhCuR,EAAwD,SAAAC,GAC5DA,EAAE1E,iBAEFqE,EAAYM,SAAU,EACtBJ,EAAMI,QAAUC,YAAW,WACzBP,EAAYM,SAAU,EAClBJ,EAAMI,SACRE,aAAaN,EAAMI,SAKrB5Q,EAAMuG,iBAAiB,UACnBvG,EAAMsG,YAAY1D,SAAS,WAC7B5C,EAAM6G,iBAAiB3C,KAExB,MAGC6M,EAAsD,SAAAJ,GAC1DA,EAAE1E,iBAEGqE,EAAYM,UAIb5Q,EAAMsG,YAAY1D,SAAS,UAC7B5C,EAAM6G,iBAAiB3C,GACdlE,EAAMsG,YAAY1D,SAAS,SAGpCwN,EAAS,SAAD,OAAUlM,EAAK/C,GAAf,MAGVmP,EAAYM,SAAU,EAClBJ,EAAMI,SACRE,aAAaN,EAAMI,WAIjBI,EAAahR,EAAM4G,cAAchE,SAASsB,EAAK/C,IAErD,OACE,kBAAC8P,GAAA,EAAD,CACE1G,QAAM,EACN2G,YAAaR,EACbS,aAAcT,EACdU,UAAWL,EACXM,WAAYN,EACZlC,UAAW,KACX/D,UAAWD,EAAQoE,UAElBjP,EAAMsG,YAAY1D,SAAS,WAC1B,kBAAC0O,GAAA,EAAD,CACEC,QAASP,EACTQ,UAAW,EACXhH,MAAM,UACNgE,KAAK,QACL1D,UAAWD,EAAQ0E,yBAGtBY,EACC,kBAAC,GAAD,CAAa3E,YAAU,EAACtH,KAAMA,IAE9B,kBAACuN,GAAA,EAAD,CACEtI,QAASjF,EAAKG,MACdqN,uBAAwB,CAAErC,QAAS,UACnCvE,UAAWD,EAAQuE,WAGvB,kBAACuC,GAAA,EAAD,CAAyB7G,UAAWD,EAAQkF,kBACzCzI,GACC,oCACE,kBAACsK,GAAA,EAAD,CACEvN,MAAOH,EAAK6I,WACZ8E,KAAM,kBAAC,KAAD,MACNC,KAAK,QACL/C,GAAE,WAAM7K,EAAK/C,GAAX,KACF0N,UAAWC,IACXhE,UAAWD,EAAQ8E,QAKxBtI,IAAmBC,GAAiBpD,EAAK6I,WAAa,GACrD,kBAAChC,GAAA,EAAD,CACEgH,QAAS,kBAAC,KAAD,MACThD,GAAE,gBAAW7K,EAAK/C,GAAhB,KACF0N,UAAWC,IACXhE,UAAWD,EAAQoF,aAElB/L,EAAK6I,kBChMd3C,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACX0H,KAAM,QA6BKC,GAnB0C,SAAC,GAInD,IAHL/N,EAGI,EAHJA,KACAgO,EAEI,EAFJA,QAGMrH,GADF,EADJC,UAEgBV,MAChB,OAAOjC,GAAS,SAAAnI,GAAK,aACnB,kBAACmS,GAAA,EAAD,CAAM1D,aAAW,YAAY3D,UAAWD,EAAQmH,MAAhD,UACG9N,EAAK5B,QACHnD,IAAI+S,UAFT,aACG,EAEGxQ,QACD0Q,UACA7T,KAAI,SAAC8T,GAAD,OACH,kBAAC,GAAD,CAAcnO,KAAMmO,EAAMrT,IAAG,UAAKkT,EAAL,YAAgBG,EAAKlR,cCH7CmR,GAnBsD,SAAC,GAAD,IACnEnR,EADmE,EACnEA,GADmE,EAEnE7B,KAFmE,OAInE6I,GAAS,SAAAnI,GACP,IAAImF,EAAWnF,EAAMgG,SACf9B,EAAOlE,EAAMyD,KAAKtE,IAAIgC,GAM5B,OAJI+C,IACFiB,EAAWjB,GAGNiB,EACL,kBAACoN,GAAD,CAAYrO,KAAMiB,GAChB,kBAAC,GAAD,CAAUjB,KAAMiB,EAAU+M,QAAQ,WAElC,S,UCpBF9H,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,GACNoG,OAAQ,GACRC,OAAQ,CACN5C,MAAO9B,EAAMM,QAAQK,KAAKgE,UAC1BC,gBAAiB5E,EAAMM,QAAQC,WAAWC,QAC1CkC,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,IAElCzM,QAAS,CACP8N,MAAO,OACPY,UAAW,SACX/C,MAAO9B,EAAMM,QAAQK,KAAKgE,UAC1BC,gBAAiB5E,EAAMM,QAAQC,WAAWC,QAC1CkC,QAAS1C,EAAM4C,QAAQ,EAAG,EAAG,EAAG,IAElCtD,SAAU,GACVyF,WAAY,CACV,cAAe,CACbC,WAAY,SACZC,cAAe,SAGnB6E,KAAM,CACJ9E,WAAY,SACZ+E,YAAa,QAEf7E,eAAgB,GAChBC,MAAO,CACLC,SAAU,EACVP,UAAW,SACXQ,UAAW,SACXC,WAAY,SACZC,aAAc,WACdzD,MAAO9B,EAAMM,QAAQK,KAAKF,cAa1B+E,GAA+C,SAAC,GAO/C,IANLL,EAMI,EANJA,MACAhP,EAKI,EALJA,QACA6T,EAII,EAJJA,eACAC,EAGI,EAHJA,mBACA7H,EAEI,EAFJA,UACA9C,EACI,EADJA,SAEM6C,EAAUT,KAChB,OACE,kBAAC+D,EAAA,EAAD,CAAKrD,UAAW,CAACD,EAAQ9D,KAAM+D,GAAW/B,KAAK,MAC7C,kBAACqF,EAAA,EAAD,CAAQC,UAAW,EAAGC,SAAS,SAASxD,UAAWD,EAAQsC,QACzD,kBAACH,EAAA,EAAD,CAASC,QAAQ,QAAQnC,UAAWD,EAAQuC,QAC1C,kBAACmB,EAAA,EAAD,CACEtD,SAAuC,MAA7B3O,OAAOC,SAAS2Q,eAA0BhC,EACpDsD,KAAK,QACLC,aAAW,OACXtD,QAAS,kBAAM7O,OAAOoS,QAAQC,QAC9B7D,UAAW,CACTD,EAAQ4C,WACRkF,EAAqB,GAAK9H,EAAQ2H,MAClCzJ,KAAK,MAEP,kBAAC,IAAD,OAGD8E,GACC,kBAACe,EAAA,EAAD,CAAY3B,QAAQ,KAAKnC,UAAWD,EAAQgD,OACzCA,GAIL,kBAACU,EAAA,EAAD,CACEtD,UAAQ,EACRuD,KAAK,MACLK,UAAWC,IACXC,GAAE,YACFN,aAAW,WACX3D,UAAW,CACTD,EAAQ+C,eACR8E,EAAiB,GAAK7H,EAAQ2H,MAC9BzJ,KAAK,MAEN,kBAAC,KAAD,CAAciG,SAAS,YAI3BnQ,GAGH,kBAACsP,EAAA,EAAD,CAAKrD,UAAWD,EAAQ7C,UAAWA,KAKzCkG,GAAO3B,aAAe,CACpBsB,MAAO,OACP6E,gBAAgB,EAChBC,oBAAoB,GAGPzE,UC5DA0E,GA3CoD,SAAC,GAAY,IAAVzR,EAAS,EAATA,GAAS,EAC3C0G,IAAM8D,SAAuB,MADc,mBACtEkH,EADsE,KAC3DC,EAD2D,OAEvCjL,IAAM8D,UAAS,GAFwB,mBAEtEoH,EAFsE,KAEzDC,EAFyD,KAGvE5C,EAAWC,cAEjB,OAAOlI,GAAS,SAAAnI,GAad,OACE,kBAAC,GAAD,KACE,kBAAC4O,EAAA,EAAD,CAAYqE,MAAM,UAAlB,2CAEE,6BAFF,2CAKA,kBAAC9E,EAAA,EAAD,CAAK+E,GAAI,EAAG3F,UAAU,UACnBsF,EACC,kBAACjE,EAAA,EAAD,CAAYpE,MAAM,SAASqI,GAE3B,kBAAC9H,GAAA,EAAD,CACEE,SAAU8H,EACV5H,QAzBqD,WAC7D6H,GAAe,GACfhT,EACGwF,mBAAmBrE,GACnBnE,MAAK,SAACmI,GACLiL,EAAS,SAAD,OAAUjL,EAAShE,QAE5BvD,OAAM,SAACC,GACNiV,EAAajV,OAkBT2M,MAAM,WAELuI,EAAc,kBAACI,GAAA,EAAD,CAAkBrB,KAAM,KAAS,gB,sEC5BxD1H,GAAYC,cAAW,SAAC3B,GAAD,OAC3B4B,aAAa,CACXvD,KAAM,QAwFKqM,GApF2B,WACxC,IAAMvI,EAAUT,KAEhB,OAAOjC,GAAS,SAAAnI,GAAK,aACnB,kBAAC,GAAD,KACE,kBAACmS,GAAA,EAAD,CACEkB,UAAW,kBAACC,GAAA,EAAD,eACXxI,UAAWD,EAAQ9D,MAEnB,kBAACkK,GAAA,EAAD,KACE,kBAACsC,GAAA,EAAD,KACE,kBAAC,KAAD,OAEF,kBAAC9B,GAAA,EAAD,CAActQ,GAAG,6BAA6BgI,QAAQ,aACtD,kBAACwI,GAAA,EAAD,KACE,kBAAC6B,GAAA,EAAD,CACEvI,UAAQ,EACRuD,KAAK,MACLpC,WAAY,CACV,kBAAmB,wCAM7B,kBAAC+F,GAAA,EAAD,CACEkB,UAAW,kBAACC,GAAA,EAAD,cACXxI,UAAWD,EAAQ9D,MAEnB,kBAACkK,GAAA,EAAD,KACE,kBAACsC,GAAA,EAAD,KACE,kBAAC,KAAD,OAEF,kBAAC9B,GAAA,EAAD,CACEtQ,GAAG,+BACHgI,QAAQ,eAEV,kBAACwI,GAAA,EAAD,KACE,kBAAC6B,GAAA,EAAD,CACEjC,QAAO,UAAEvR,EAAMyT,2BAAR,SACPpH,SAAU,kBAAMrM,EAAM2H,6BACtB6G,KAAK,MACLpC,WAAY,CACV,kBAAmB,yCAK3B,kBAAC6E,GAAA,EAAD,KACE,kBAACsC,GAAA,EAAD,KACE,kBAAC,KAAD,OAEF,kBAAC9B,GAAA,EAAD,CAActQ,GAAG,6BAA6BgI,QAAQ,aACtD,kBAACwI,GAAA,EAAD,KACE,kBAAC6B,GAAA,EAAD,CACEvI,UAAQ,EACRuD,KAAK,MACLpC,WAAY,CACV,kBAAmB,uCAK3B,kBAAC6E,GAAA,EAAD,KACE,kBAACsC,GAAA,EAAD,KACE,kBAAC,KAAD,OAEF,kBAAC9B,GAAA,EAAD,CACEtQ,GAAG,8BACHgI,QAAQ,0BAEV,kBAACwI,GAAA,EAAD,KACE,kBAAC6B,GAAA,EAAD,CACEvI,UAAQ,EACRuD,KAAK,MACLpC,WAAY,CAAE,kBAAmB,yCCvFlCsH,GAA6C,SAAC,GAAD,IAC7CC,EAD6C,EACxD9E,UACG5K,EAFqD,oCAGpD,kBAAC0P,EAAc1P,IAER2P,GAAkC,kBAC7CzL,GAAS,SAAAnI,GAAK,OACZA,EAAMgG,SACJ,kBAAC,IAAD,KACE,kBAAC,GAAD,CAAOxE,KAAK,IAAIqN,UAAWyD,KAC3B,kBAAC,GAAD,CAAO9Q,KAAK,YAAYqN,UAAWyD,KACnC,kBAAC,GAAD,CAAO9Q,KAAK,WAAWqN,UAAW+D,KAClC,kBAAC,GAAD,CAAOpR,KAAK,WAAWqN,UAAWuE,MAElC,SCjBRS,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,EAAD,KACE,kBAAC,EAAD,KACE,kBAAC,GAAD,SAINC,SAASC,eAAe,SpBPnB,SAAkBrX,GACvB,GAA6C,kBAAmBC,UAAW,CAGzE,GADkB,IAAIqX,IAAIC,GAAwB7X,OAAOC,SAAS6X,MACpDC,SAAW/X,OAAOC,SAAS8X,OAIvC,OAGF/X,OAAOgY,iBAAiB,QAAQ,WAC9B,IAAM3X,EAAK,UAAMwX,GAAN,sBAEP/X,IAgEV,SAAiCO,EAAeC,GAE9C2X,MAAM5X,EAAO,CACX6X,QAAS,CAAE,iBAAkB,YAE5BxX,MAAK,SAAAyX,GAEJ,IAAMC,EAAcD,EAASD,QAAQrV,IAAI,gBAEnB,MAApBsV,EAASE,QACO,MAAfD,IAA8D,IAAvCA,EAAYE,QAAQ,cAG5C/X,UAAUC,cAAc+X,MAAM7X,MAAK,SAAAC,GACjCA,EAAa6X,aAAa9X,MAAK,WAC7BV,OAAOC,SAASwY,eAKpBrY,EAAgBC,EAAOC,MAG1BgB,OAAM,WACLJ,QAAQC,IACN,oEAvFAuX,CAAwBrY,EAAOC,GAI/BC,UAAUC,cAAc+X,MAAM7X,MAAK,WACjCQ,QAAQC,IACN,iHAMJf,EAAgBC,EAAOC,OoBlB/BE,I,sDCvCA,SAASmY,EAAoBC,GAC5B,IAAIvE,EAAI,IAAI3O,MAAM,uBAAyBkT,EAAM,KAEjD,MADAvE,EAAEwE,KAAO,mBACHxE,EAEPsE,EAAoB3U,KAAO,WAAa,MAAO,IAC/C2U,EAAoBrP,QAAUqP,EAC9BG,EAAOC,QAAUJ,EACjBA,EAAoB9T,GAAK,K","file":"static/js/main.7dd272cd.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\n/* eslint-disable no-console */\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n)\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void\n  onUpdate?: (registration: ServiceWorkerRegistration) => void\n}\n\nexport function register(config?: Config): void {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href)\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config)\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA',\n          )\n        })\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config)\n      }\n    })\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config): void {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing\n        if (installingWorker == null) {\n          return\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.',\n              )\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration)\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.')\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration)\n              }\n            }\n          }\n        }\n      }\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error)\n    })\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config): void {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type')\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload()\n          })\n        })\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config)\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      )\n    })\n}\n\nexport function unregister(): void {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister()\n    })\n  }\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types as t, SnapshotIn, IAnyType, Instance } from 'mobx-state-tree'\n\nconst Basic = t.union(\n  t.null,\n  t.boolean,\n  t.string,\n  t.number,\n  t.array(t.late((): IAnyType => Basic)),\n  t.map(t.late((): IAnyType => Basic)),\n)\n\nexport const Config = t\n  .model('Config', {\n    name: t.maybe(t.string),\n    items: t.map(Basic),\n  })\n  .actions(self => ({\n    set(key: string, value: SnapshotIn<typeof Basic>) {\n      self.items.set(key, value)\n    },\n  }))\n  .views(self => ({\n    get(key: string): Instance<typeof Basic> {\n      return self.items.get(key)\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, IAnyType } from 'mobx-state-tree'\n\nconst Basic = types.union(\n  types.null,\n  types.boolean,\n  types.string,\n  types.number,\n  types.late((): IAnyType => types.array(Basic)),\n)\n\nexport const Event = types.model('Event', {\n  type: types.string,\n  date: types.Date,\n  payload: types.maybe(Basic),\n})\n\nexport const Log = types\n  .model('Log', {\n    events: types.array(Event),\n  })\n  .actions(self => ({\n    logEvent(type: string, payload?: typeof Basic) {\n      self.events.push(\n        Event.create({\n          date: Date.now(),\n          payload,\n          type,\n        }),\n      )\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  Instance,\n  onPatch,\n  getSnapshot,\n  getMembers,\n  applySnapshot,\n  IAnyModelType,\n} from 'mobx-state-tree'\nimport Dexie from 'dexie'\n\nexport async function persist(graph: Instance<IAnyModelType>): Promise<void> {\n  const db = new Dexie('default')\n  const tableNames = Object.keys(getMembers(graph).properties)\n  const tableConfig = Object.fromEntries(tableNames.map(name => [name, 'id']))\n\n  db.version(1).stores(tableConfig)\n\n  return Promise.all(\n    tableNames.map(name =>\n      db\n        .table(name)\n        .toArray()\n        .then(rows => [name, Object.fromEntries(rows.map(r => [r.id, r]))]),\n    ),\n  ).then(resolved => {\n    applySnapshot(graph, Object.fromEntries(resolved))\n    onPatch(graph, patch => {\n      const [typeName, id, propName] = patch.path.split('/').slice(1)\n      if (patch.op === 'add') {\n        db.table(typeName).put(getSnapshot(graph[typeName].get(id)))\n      } else if (patch.op === 'replace' || patch.op === 'remove') {\n        if (propName) {\n          db.table(typeName).update(id, {\n            [propName]: getSnapshot(graph[typeName].get(id)[propName]),\n          })\n        } else {\n          db.table(typeName).delete(id)\n        }\n      } else {\n        throw Error(`Unknown patch op '${patch.op}'`)\n      }\n    })\n  })\n}\n\nexport default persist\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  IAnyModelType,\n  IAnyType,\n  Instance,\n  isIdentifierType,\n  SnapshotIn,\n  isModelType,\n  types,\n} from 'mobx-state-tree'\nimport { v4 as uuid } from 'uuid'\n\nexport type ModelOrUnion = IAnyModelType | IAnyType\nexport type EdgeResolver = () => ModelOrUnion\nexport type ModelTable = Record<string, IAnyModelType>\n\nexport const edgeMapFactory = (getEdgeType: EdgeResolver): IAnyModelType =>\n  types\n    .model('EdgeMap', {\n      edgeMap: types.map(\n        types.array(\n          types.safeReference(types.late(getEdgeType), {\n            acceptsUndefined: false,\n          }),\n        ),\n      ),\n    })\n    .actions(self => ({\n      hasEdge(tag: string, target?: Instance<IAnyModelType>): boolean {\n        if (target) {\n          return Boolean(self.edgeMap.get(tag)?.includes(target))\n        } else {\n          return Boolean(self.edgeMap.get(tag)?.length)\n        }\n      },\n    }))\n    .actions(self => ({\n      addEdge(tag: string, target: Instance<IAnyModelType>): void {\n        if (!self.edgeMap.has(tag)) {\n          self.edgeMap.set(tag, [])\n        }\n\n        self.edgeMap.get(tag)?.push(target)\n      },\n\n      removeEdge(tag: string, target: Instance<IAnyModelType>): void {\n        if (!self.edgeMap.get(tag)?.remove(target)) {\n          throw Error(`Node '${self}' has no '${tag}' edge for '${target}'`)\n        }\n      },\n    }))\n    .views(self => ({\n      getEdgeTag(tag: string): void | Array<Instance<IAnyModelType>> {\n        return self.edgeMap.get(tag)\n      },\n    }))\n\nexport const nodeFactory = (\n  models: IAnyModelType | Array<IAnyModelType> = [],\n): IAnyModelType =>\n  types\n    .compose(\n      // @ts-ignore\n      ...[\n        types.model({\n          id: types.identifier,\n        }),\n      ].concat(models),\n    )\n    .named('Node')\n\nexport const Node = nodeFactory(edgeMapFactory(() => Node))\n\ninterface GraphFactoryOptions {\n  getId?: () => string\n}\n\nexport const graphFactory = (\n  nodeModels: ModelTable = { Node },\n  options: GraphFactoryOptions = {},\n): IAnyModelType =>\n  types\n    .model(\n      'Graph',\n      Object.fromEntries(\n        Object.keys(nodeModels).map(key => {\n          const model = nodeModels[key]\n\n          if (isModelType(model) && isIdentifierType(model.properties.id)) {\n            return [key, types.map(nodeModels[key])]\n          }\n\n          // Can't add an identifier because the model may be referenced\n          throw Error(`Model '${key}' requires 'id' identifier`)\n        }),\n      ),\n    )\n    .actions(self => ({\n      createNode(\n        modelName = 'Node',\n        props: SnapshotIn<IAnyModelType> = {},\n      ): Instance<IAnyModelType> {\n        if (!nodeModels[modelName]) {\n          throw Error(`No model named '${modelName}'`)\n        }\n\n        const node = nodeModels[modelName].create({\n          id: options.getId?.() ?? uuid(),\n          ...props,\n        })\n\n        self[modelName].put(node)\n\n        return node\n      },\n    }))\n\nexport const Graph = graphFactory()\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport { types, IAnyType } from 'mobx-state-tree'\n\nimport { nodeFactory, edgeMapFactory } from 'graph/factories'\nimport * as models from 'graph/models'\n\nexport const Config = nodeFactory(models.Config)\nexport const Node = nodeFactory([\n  models.Log,\n  edgeMapFactory(() =>\n    types.union(\n      types.late((): IAnyType => Node),\n      Config,\n    ),\n  ),\n])\n  .props({\n    label: types.maybe(types.string),\n  })\n  .actions(self => ({\n    afterCreate() {\n      self.logEvent('create')\n    },\n  }))\n  .views(self => ({\n    get childCount(): number {\n      return self.edgeMap.get('child')?.length ?? 0\n    },\n\n    get createDate(): Date {\n      return self.events[0]?.date\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport {\n  Instance,\n  SnapshotIn,\n  SnapshotOut,\n  IAnyModelType,\n  applyPatch,\n  onPatch,\n  getSnapshot,\n} from 'mobx-state-tree'\nimport { v4 as uuid } from 'uuid'\nimport Peer from 'peerjs'\n\nimport persist from '../persist'\nimport { graphFactory } from 'graph/factories'\nimport { Node, Config } from './Node'\n\nconst peerMaker = (graph: Instance<typeof Graph>, id: string): Peer => {\n  const peer = new Peer(id, {\n    host: 'peerbroker.herokuapp.com',\n    port: 80,\n    // host: 'localhost',\n    // port: 9000,\n    debug: 0,\n  })\n\n  let patchDisposer: null | ReturnType<typeof onPatch>\n\n  peer.on('connection', connection => {\n    console.log('CONNECT')\n    connection.on('open', () => {\n      console.log('OPEN')\n      patchDisposer = onPatch(graph, patch => {\n        const pathParts = patch.path.split('/').slice(1)\n        if (pathParts[0] === 'Node') {\n          console.log('sent patch', patch)\n          connection?.send(patch)\n        }\n      })\n\n      connection.on('close', () => {\n        patchDisposer?.()\n      })\n    })\n  })\n\n  return peer\n}\n\n// limit references to only those accessible beneath a Node\n// and then produce a hash of Nodes ready to be applied to peer mst map\nfunction getSafeFlatSnapshot(\n  instance: Instance<typeof Node>,\n): Record<string, SnapshotOut<typeof Node>> {\n  return { [instance.id]: { ...getSnapshot(instance), edgeMap: {} } }\n}\n\nexport const Graph = graphFactory({ Node, Config })\n  // Peer\n  .actions(self => {\n    let peer: null | Peer = null\n    let connection: null | Peer.DataConnection = null\n    let patchDisposer: null | ReturnType<typeof onPatch>\n\n    // TODO untangle\n\n    return {\n      offerPeerConnection(instance: Instance<typeof Node>) {\n        peer = peerMaker(self, instance.id)\n\n        peer.on('open', () => {\n          self.setActiveMode('share')\n        })\n\n        peer.on('connection', c => {\n          connection = c\n\n          connection.on('open', () => {\n            connection?.send({ ...getSnapshot(instance), edgeMap: {} })\n          })\n\n          connection.on('data', data => {\n            if (data.op) {\n              console.log('unsent to avoid loop', data)\n              // applyPatch(self.Node.get(instance), data)\n            }\n          })\n\n          connection.on('close', () => {\n            self.unsetActiveMode('share')\n          })\n        })\n      },\n\n      async seekPeerConnection(peerId: string): Promise<Instance<typeof Node>> {\n        peer = peerMaker(self, uuid())\n        connection = peer.connect(peerId, { reliable: true })\n\n        connection.on('close', () => {\n          self.unsetActiveMode('share')\n        })\n\n        connection.on('disconnect', () => {\n          self.unsetActiveMode('share')\n        })\n\n        return new Promise((resolve, reject) => {\n          if (!connection) {\n            throw Error('No connection to use')\n          }\n\n          connection.on('data', data => {\n            if (data.id) {\n              const child = self.createChild(self.rootNode, data)\n              self.setActiveMode('share')\n              resolve(child)\n            } else if (data.op) {\n              console.log('apply', data)\n              applyPatch(self, data)\n            }\n          })\n\n          connection.on('error', error => {\n            reject(error)\n          })\n        })\n      },\n\n      closePeerConnection() {\n        connection?.close()\n        peer?.disconnect()\n        self.unsetActiveMode('share')\n      },\n    }\n  })\n\n  // Modes\n  .actions(self => ({\n    setActiveMode(mode: string) {\n      const activeModes = self.Config.get('system').get('activeModes')\n      if (activeModes && !activeModes?.includes(mode)) {\n        activeModes.push(mode)\n      }\n    },\n\n    unsetActiveMode(mode: string) {\n      const activeModes = self.Config.get('system').get('activeModes')\n      if (activeModes?.includes(mode)) {\n        activeModes.remove(mode)\n      }\n    },\n\n    toggleActiveMode(mode: string) {\n      const activeModes = self.Config.get('system').get('activeModes')\n\n      if (!activeModes) {\n        return\n      }\n\n      if (activeModes.includes(mode)) {\n        activeModes.remove(mode)\n\n        // TODO mode logic doesn't belong here\n        if (mode === 'select') {\n          self.clearSelectedNodes()\n        }\n      } else {\n        activeModes.push(mode)\n      }\n    },\n  }))\n\n  // Selection\n  .actions(self => ({\n    clearSelectedNodes() {\n      self.Config.get('system').get('selectedNodes')?.clear()\n    },\n\n    deleteSelectedNodes() {\n      const selectedNodes = self.Config.get('system')?.get('selectedNodes')\n      selectedNodes.forEach((id: string) => self.Node.delete(id))\n      self.clearSelectedNodes()\n      if (self.selectedNodes.length === 0) {\n        self.unsetActiveMode('select')\n      }\n    },\n\n    toggleSelectNode(node: Instance<typeof Node>) {\n      const selectedNodes = self.Config.get('system').get('selectedNodes')\n      if (selectedNodes?.includes(node.id)) {\n        selectedNodes?.remove(node.id)\n      } else {\n        selectedNodes?.push(node.id)\n      }\n\n      if (selectedNodes.length === 0) {\n        self.toggleActiveMode('select')\n      }\n    },\n\n    // selectNode(node: Instance<typeof Node>) {\n\n    // },\n\n    // deselectNode(node: Instance<typeof Node>) {\n\n    // },\n\n    selectAllChildNodes(node: Instance<typeof Node>) {\n      node.edgeMap\n        .get('child')\n        .forEach((child: Instance<typeof Node>) => console.log('child'))\n    },\n\n    // deselectAllChildNodes(node: Instance<typeof Node>) {\n\n    // },\n  }))\n\n  .actions(self => ({\n    afterCreate() {\n      persist(self).then(() => {\n        if (!self.Config.has('system')) {\n          const root = self.createNode('Node', { label: 'Exuo' })\n\n          self.createNode('Config', {\n            id: 'system',\n            items: {\n              rootNodeId: root.id,\n              activeModes: [],\n              selectedNodes: [],\n            },\n          })\n\n          self.createNode('Config', {\n            id: 'user',\n            items: {\n              global: {\n                dividers: false,\n              },\n              lists: {\n                checkbox: false,\n                dividers: false,\n                showChildCount: true,\n                showEdgeChips: false,\n              },\n            },\n          })\n        }\n      })\n    },\n\n    createChild<T extends IAnyModelType>(\n      node: Instance<typeof Node>,\n      edgeProps: SnapshotIn<T>,\n      edgeType = 'Node',\n    ): Instance<typeof Node> {\n      const child = self.createNode(edgeType, edgeProps)\n\n      node.addEdge('child', child)\n      child.addEdge('parent', node)\n\n      return child\n    },\n\n    deleteNode(node: Instance<typeof Node>) {\n      self.Node.delete(node.id)\n    },\n\n    toggleGlobalDividerSetting() {\n      const value = self.Config.get('user').get('global')?.get('dividers')\n      self.Config.get('user').get('global')?.set('dividers', !value)\n    },\n\n    toggleListCheckboxSetting() {\n      const value = self.Config.get('user').get('lists')?.get('checkbox')\n      self.Config.get('user').get('lists')?.set('checkbox', !value)\n    },\n  }))\n  .views(self => ({\n    get rootNode() {\n      const config = self.Config.get('system')\n      return config && self.Node.get(config.get('rootNodeId'))\n    },\n\n    get activeModes() {\n      const config = self.Config.get('system')\n      return config?.get('activeModes')\n    },\n\n    get selectedNodes() {\n      return self.Config.get('system')?.get('selectedNodes')\n    },\n\n    get listCheckboxSetting() {\n      return self.Config.get('user')?.get('lists')?.get('checkbox')\n    },\n  }))\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { useObserver } from 'mobx-react-lite'\n\nimport { Graph } from './models'\n\nexport const graphContext = React.createContext<Instance<typeof Graph>>(null)\nexport const GraphProvider: React.FunctionComponent<{\n  value?: Instance<typeof Graph>\n}> = ({ children, value }) =>\n  React.createElement(\n    graphContext.Provider,\n    { value: value ?? Graph.create() },\n    children,\n  )\n\nexport function useGraph<S>(selector: (s: Instance<typeof Graph>) => S): S {\n  const graph = React.useContext(graphContext)\n\n  if (graph) {\n    return useObserver(() => selector(graph))\n  }\n\n  throw Error('Cannot use graph before setup')\n}\n","import React from 'react'\nimport {\n  createMuiTheme,\n  ThemeProvider as MuiThemeProvider,\n} from '@material-ui/core/styles'\nimport useMediaQuery from '@material-ui/core/useMediaQuery'\nimport CssBaseline from '@material-ui/core/CssBaseline'\n\nexport const ThemeProvider: React.FunctionComponent = ({ children }) => {\n  const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\n  const theme = React.useMemo(\n    () =>\n      createMuiTheme({\n        typography: {\n          fontFamily: [\n            '-apple-system',\n            'system-ui',\n            'BlinkMacSystemFont',\n            '\"Segoe UI\"',\n            'Roboto',\n            '\"Helvetica Neue\"',\n            'Arial',\n            'sans-serif',\n          ].join(', '),\n        },\n\n        palette: {\n          type: prefersDarkMode ? 'dark' : 'light',\n          background: {\n            default: prefersDarkMode ? '#000000' : '#ffffff',\n          },\n          primary: { main: '#f94d94' },\n          text: {\n            primary: prefersDarkMode\n              ? 'rgba(255, 255, 255, .75)'\n              : 'rgba(0, 0, 0, .75)',\n          },\n        },\n\n        shape: {\n          borderRadius: 6,\n        },\n\n        props: {\n          MuiButtonBase: {\n            /* disableRipple: true, */\n          },\n          MuiButton: {\n            disableElevation: true,\n          },\n        },\n\n        overrides: {\n          MuiCssBaseline: {\n            '@global': {\n              html: {\n                userSelect: 'none',\n                overscrollBehavior: 'none',\n                '-webkit-touch-callout': 'none',\n                maxWidth: '600px',\n                margin: 'auto',\n                '&, & body': {\n                  height: '100%',\n                },\n              },\n              /* '#root': { */\n              /*   height: '100%', */\n              /*   backgroundImage: 'url(/background.jpg)', */\n              /*   backgroundSize: 'cover', */\n              /* }, */\n            },\n          },\n        },\n      }),\n    [prefersDarkMode],\n  )\n\n  return (\n    <MuiThemeProvider theme={theme}>\n      <CssBaseline />\n      {children}\n    </MuiThemeProvider>\n  )\n}\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Button, Typography } from '@material-ui/core'\nimport Delete from '@material-ui/icons/Delete'\nimport Edit from '@material-ui/icons/Edit'\nimport Folder from '@material-ui/icons/Folder'\nimport FileCopy from '@material-ui/icons/FileCopy'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Instance } from 'mobx-state-tree'\n\nimport { Node, useGraph } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    button: {\n      color: theme.palette.action.active,\n    },\n    deleteButton: {\n      color: theme.palette.error.main,\n    },\n  }),\n)\n\nconst SelectionActions: React.FunctionComponent = () => {\n  const classes = useStyles()\n  return useGraph(graph => (\n    <div className={classes.root}>\n      {/*\n      <Button startIcon={<Edit />} disabled className={classes.button}>\n        Modify\n      </Button>\n\n      <Button startIcon={<FileCopy />} disabled className={classes.button}>\n        Copy\n      </Button>\n\n      <Button startIcon={<Folder />} disabled className={classes.button}>\n        Move\n      </Button>\n      */}\n\n      <Button\n        startIcon={<Delete />}\n        disabled={graph.selectedNodes.length ? undefined : true}\n        className={[classes.button, classes.deleteButton].join(' ')}\n        onClick={() => graph.deleteSelectedNodes()}\n      >\n        Delete\n      </Button>\n    </div>\n  ))\n}\n\nexport default SelectionActions\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Instance } from 'mobx-state-tree'\nimport { makeStyles, Theme, createStyles } from '@material-ui/core/styles'\nimport InputBase from '@material-ui/core/InputBase'\nimport IconButton from '@material-ui/core/IconButton'\nimport AddIcon from '@material-ui/icons/Add'\nimport { Editor, EditorState } from 'draft-js'\nimport 'draft-js/dist/Draft.css'\n\nimport { useGraph, Node } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      padding: 0,\n    },\n\n    inputBase: {\n      '& input': {\n        padding: theme.spacing(1, 0, 1, 0),\n        height: 'auto',\n      },\n    },\n  }),\n)\n\ninterface LabelEditorProps {\n  node: Instance<typeof Node>\n  createMode?: boolean\n  placeholder?: string\n  className?: string\n  onBlur?: React.EventHandler<React.SyntheticEvent>\n}\n\nexport const LabelEditor: React.FunctionComponent<LabelEditorProps> = ({\n  node,\n  createMode,\n  placeholder,\n  className,\n  onBlur,\n}) => {\n  const classes = useStyles()\n  const [inputValue, setInputValue] = React.useState(\n    createMode ? '' : node.label,\n  )\n\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>): void => {\n    setInputValue(event.target.value)\n  }\n\n  return useGraph(graph => {\n    const handleSubmit = (event: React.FormEvent<HTMLFormElement>): void => {\n      event.preventDefault()\n      if (inputValue) {\n        graph.createChild(node, { label: inputValue })\n        setInputValue('')\n      }\n    }\n\n    return (\n      <div className={[classes.root, className].join(' ')}>\n        <form onSubmit={handleSubmit} onBlur={onBlur}>\n          <InputBase\n            autoFocus\n            placeholder={placeholder}\n            inputProps={{ 'aria-label': 'label' }}\n            onChange={handleChange}\n            value={inputValue}\n            className={classes.inputBase}\n            fullWidth\n          />\n        </form>\n      </div>\n    )\n  })\n}\n\nLabelEditor.defaultProps = {\n  createMode: true,\n  placeholder: 'Label',\n}\n\nexport default LabelEditor\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Box, Toolbar, Button } from '@material-ui/core'\nimport AddIcon from '@material-ui/icons/Add'\nimport EditIcon from '@material-ui/icons/Edit'\nimport GroupWorkIcon from '@material-ui/icons/GroupWork'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Instance } from 'mobx-state-tree'\n\nimport { Node, useGraph } from 'graph'\nimport SelectionActions from './SelectionActions'\nimport LabelEditor from './LabelEditor'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {\n      justifyContent: 'center',\n    },\n    button: {},\n    toggledButton: {},\n    labelEditor: {\n      width: '100%',\n    },\n  }),\n)\n\ninterface NodeActionsProps {\n  node: Instance<typeof Node>\n  className?: string\n}\n\ntype ActionMode = 'normal' | 'add' | 'share'\n\nconst NodeActions: React.FunctionComponent<NodeActionsProps> = ({\n  node,\n  className,\n}) => {\n  const classes = useStyles()\n  const [mode, setMode] = React.useState<ActionMode>('normal')\n\n  return useGraph(graph => {\n    const hasChildren = node?.childCount > 0\n    return (\n      <Toolbar variant=\"dense\" className={[classes.root, className].join(' ')}>\n        {mode === 'normal' && !graph.activeModes.includes('select') && (\n          <>\n            <Button\n              startIcon={<AddIcon />}\n              onClick={() => setMode('add')}\n              className={classes.button}\n            >\n              new\n            </Button>\n\n            {hasChildren && (\n              <Button\n                disabled\n                startIcon={<EditIcon />}\n                onClick={() => graph.toggleActiveMode('edit')}\n                className={[\n                  classes.button,\n                  graph.activeModes.includes('edit')\n                    ? classes.toggledButton\n                    : '',\n                ].join(' ')}\n              >\n                edit\n              </Button>\n            )}\n\n            {window.location.pathname === '/' || (\n              <Button\n                startIcon={<GroupWorkIcon />}\n                onClick={() => {\n                  if (graph.activeModes.includes('share')) {\n                    graph.closePeerConnection()\n                  } else {\n                    graph.offerPeerConnection(node)\n                  }\n                }}\n                color={\n                  graph.activeModes.includes('share') ? 'primary' : 'default'\n                }\n                className={classes.button}\n              >\n                share\n              </Button>\n            )}\n          </>\n        )}\n\n        {mode === 'normal' && graph.activeModes.includes('select') && (\n          <SelectionActions />\n        )}\n\n        {mode === 'add' && (\n          <LabelEditor\n            placeholder=\"Label\"\n            node={node}\n            onBlur={() => setMode('normal')}\n            className={classes.labelEditor}\n          />\n        )}\n\n        {false && graph.activeModes.includes('select') && <div>edit</div>}\n\n        {false && graph.activeModes.includes('share') && <div>share</div>}\n      </Toolbar>\n    )\n  })\n}\n\nexport default NodeActions\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Typography, AppBar, Toolbar, IconButton, Box } from '@material-ui/core'\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Instance } from 'mobx-state-tree'\nimport { Link } from '@reach/router'\nimport { getSnapshot } from 'mobx-state-tree'\n\nimport NodeActions from './NodeActions'\nimport { Node, useGraph } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    appBar: {},\n    header: {\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    actions: {\n      width: '100%',\n      textAlign: 'center',\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    children: {\n      marginTop: -theme.spacing(1),\n    },\n    backButton: {\n      '&[disabled]': {\n        visibility: 'hidden',\n        pointerEvents: 'none',\n      },\n    },\n    settingsButton: {},\n    title: {\n      flexGrow: 1,\n      textAlign: 'center',\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      color: theme.palette.text.primary,\n    },\n  }),\n)\n\ninterface LayoutProps {\n  node?: Instance<typeof Node>\n  className?: string\n}\n\nconst Layout: React.FunctionComponent<LayoutProps> = ({\n  node,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  return useGraph(graph => (\n    <Box className={[classes.root, className].join(' ')}>\n      <AppBar elevation={0} position=\"sticky\" className={classes.appBar}>\n        <Toolbar variant=\"dense\" className={classes.header}>\n          <IconButton\n            disabled={window.location.pathname === '/' ? true : undefined}\n            edge=\"start\"\n            aria-label=\"back\"\n            onClick={() => window.history.back()}\n            className={classes.backButton}\n          >\n            <ChevronLeftIcon />\n          </IconButton>\n\n          {node.label && (\n            <Typography variant=\"h6\" className={classes.title}>\n              {node.label}\n            </Typography>\n          )}\n\n          <IconButton\n            disabled\n            edge=\"end\"\n            component={Link}\n            to={`/settings`}\n            aria-label=\"settings\"\n            className={classes.settingsButton}\n          >\n            {<SettingsIcon fontSize=\"small\" />}\n          </IconButton>\n        </Toolbar>\n\n        {node && <NodeActions node={node} className={classes.actions} />}\n      </AppBar>\n\n      <Box className={classes.children}>{children}</Box>\n    </Box>\n  ))\n}\n\nexport default Layout\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { useNavigate, Link } from '@reach/router'\nimport {\n  Chip,\n  Checkbox,\n  Button,\n  ListItem,\n  ListItemSecondaryAction,\n  ListItemText,\n} from '@material-ui/core'\nimport AccountTreeIcon from '@material-ui/icons/AccountTree'\nimport ChevronRight from '@material-ui/icons/ChevronRight'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport 'draft-js/dist/Draft.css'\nimport { Instance } from 'mobx-state-tree'\n\nimport LabelEditor from './LabelEditor'\nimport { useGraph, Node } from 'graph'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    listItem: {\n      [theme.breakpoints.up('sm')]: {\n        borderRadius: theme.shape.borderRadius,\n      },\n    },\n    itemText: {\n      display: 'inline-block',\n      margin: 0,\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      ...theme.typography.body1,\n    },\n    listItemSelectCheckbox: {\n      padding: theme.spacing(0, 1, 0, 1),\n      '&:hover, &.Mui-checked:hover': {\n        backgroundColor: 'unset',\n      },\n    },\n    listItemIcon: {\n      minWidth: 'auto',\n    },\n    editItemText: {\n      display: 'inline-block',\n      margin: 0,\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      ...theme.typography.body1,\n      '& input': {\n        height: 'auto',\n        padding: 0,\n      },\n    },\n    chip: {\n      pointerEvents: 'auto',\n      color: theme.palette.text.hint,\n      backgroundColor: 'transparent',\n      '&:hover': {\n        color: theme.palette.primary.main,\n        cursor: 'auto',\n      },\n      '& svg': {\n        pointerEvents: 'auto',\n        color: 'inherit',\n      },\n      '&:last-child .MuiChip-label': {\n        paddingRight: 0,\n      },\n    },\n    secondaryActions: {\n      right: 0,\n      color: theme.palette.text.secondary,\n    },\n    childButton: {\n      color: theme.palette.text.secondary,\n      '&:hover, &:focus': {\n        color: theme.palette.primary.main,\n        background: 'inherit',\n      },\n    },\n  }),\n)\n\ninterface NodeListItemProps {\n  node: Instance<typeof Node>\n}\n\nconst NodeListItem: React.FunctionComponent<NodeListItemProps> = ({\n  node,\n  ...props\n}) => {\n  const classes = useStyles()\n  const [isFocused, setIsFocused] = React.useState(false)\n  const navigate = useNavigate()\n  /* const [editorState, setEditorState] = React.useState(() => */\n  /*   EditorState.createEmpty(), */\n  /* ) */\n  const isMouseDown = React.useRef(false)\n  const timer = React.useRef<ReturnType<typeof setTimeout>>()\n\n  return useGraph(graph => {\n    const listConfig = graph.Config.get('user')?.get('lists')\n\n    const showChildCount = listConfig?.get('showChildCount')\n    const showEdgeChips = listConfig?.get('showEdgeChips')\n\n    const downHandler: React.EventHandler<React.SyntheticEvent> = e => {\n      e.preventDefault()\n\n      isMouseDown.current = true\n      timer.current = setTimeout(() => {\n        isMouseDown.current = false\n        if (timer.current) {\n          clearTimeout(timer.current)\n        }\n\n        /* setIsFocused(true) */\n\n        graph.toggleActiveMode('select')\n        if (graph.activeModes.includes('select')) {\n          graph.toggleSelectNode(node)\n        }\n      }, 390)\n    }\n\n    const upHandler: React.EventHandler<React.SyntheticEvent> = e => {\n      e.preventDefault()\n\n      if (!isMouseDown.current) {\n        return\n      }\n\n      if (graph.activeModes.includes('select')) {\n        graph.toggleSelectNode(node)\n      } else if (graph.activeModes.includes('edit')) {\n        /* setIsFocused(true) */\n      } else {\n        navigate(`/node/${node.id}/`)\n      }\n\n      isMouseDown.current = false\n      if (timer.current) {\n        clearTimeout(timer.current)\n      }\n    }\n\n    const isSelected = graph.selectedNodes.includes(node.id)\n\n    return (\n      <ListItem\n        button\n        onMouseDown={downHandler}\n        onTouchStart={downHandler}\n        onMouseUp={upHandler}\n        onTouchEnd={upHandler}\n        component={'li'}\n        className={classes.listItem}\n      >\n        {graph.activeModes.includes('select') && (\n          <Checkbox\n            checked={isSelected}\n            tabIndex={-1}\n            color=\"primary\"\n            edge=\"start\"\n            className={classes.listItemSelectCheckbox}\n          />\n        )}\n        {isFocused ? (\n          <LabelEditor createMode node={node} />\n        ) : (\n          <ListItemText\n            primary={node.label}\n            primaryTypographyProps={{ display: 'inline' }}\n            className={classes.itemText}\n          />\n        )}\n        <ListItemSecondaryAction className={classes.secondaryActions}>\n          {showEdgeChips && (\n            <>\n              <Chip\n                label={node.childCount}\n                icon={<AccountTreeIcon />}\n                size=\"small\"\n                to={`/${node.id}/`}\n                component={Link}\n                className={classes.chip}\n              />\n            </>\n          )}\n\n          {showChildCount && !showEdgeChips && node.childCount > 0 && (\n            <Button\n              endIcon={<ChevronRight />}\n              to={`/node/${node.id}/`}\n              component={Link}\n              className={classes.childButton}\n            >\n              {node.childCount}\n            </Button>\n          )}\n        </ListItemSecondaryAction>\n      </ListItem>\n    )\n  })\n}\n\nexport default NodeListItem\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { List } from '@material-ui/core'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { IAnyModelType, Instance } from 'mobx-state-tree'\n\nimport { Node, useGraph } from 'graph'\nimport NodeListItem from './NodeListItem'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    list: {},\n  }),\n)\n\ninterface EdgeListProps {\n  node: Instance<IAnyModelType>\n  edgeTag: string\n  className?: string\n}\n\nconst EdgeList: React.FunctionComponent<EdgeListProps> = ({\n  node,\n  edgeTag,\n  className,\n}) => {\n  const classes = useStyles()\n  return useGraph(graph => (\n    <List aria-label=\"edge list\" className={classes.list}>\n      {node.edgeMap\n        .get(edgeTag)\n        ?.slice()\n        .reverse()\n        .map((item: Instance<typeof Node>) => (\n          <NodeListItem node={item} key={`${edgeTag}-${item.id}`} />\n        ))}\n    </List>\n  ))\n}\n\nexport default EdgeList\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\n\nimport { useGraph } from 'graph'\nimport NodeLayout from './NodeLayout'\nimport EdgeList from './EdgeList'\n\ninterface InstanceViewerProps {\n  id?: string\n  type?: string\n}\n\nconst InstanceViewer: React.FunctionComponent<InstanceViewerProps> = ({\n  id,\n  type,\n}) =>\n  useGraph(graph => {\n    let instance = graph.rootNode\n    const node = graph.Node.get(id)\n\n    if (node) {\n      instance = node\n    }\n\n    return instance ? (\n      <NodeLayout node={instance}>\n        <EdgeList node={instance} edgeTag=\"child\" />\n      </NodeLayout>\n    ) : null\n  })\n\nexport default InstanceViewer\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Typography, AppBar, Toolbar, IconButton, Box } from '@material-ui/core'\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\nimport { Link } from '@reach/router'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n    appBar: {},\n    header: {\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    actions: {\n      width: '100%',\n      textAlign: 'center',\n      color: theme.palette.text.secondary,\n      backgroundColor: theme.palette.background.default,\n      padding: theme.spacing(0, 2, 0, 2),\n    },\n    children: {},\n    backButton: {\n      '&[disabled]': {\n        visibility: 'hidden',\n        pointerEvents: 'none',\n      },\n    },\n    hide: {\n      visibility: 'hidden',\n      mouseEvents: 'none',\n    },\n    settingsButton: {},\n    title: {\n      flexGrow: 1,\n      textAlign: 'center',\n      overflowX: 'hidden',\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      color: theme.palette.text.primary,\n    },\n  }),\n)\n\ninterface LayoutProps {\n  title?: string\n  actions?: React.ReactElement\n  showBackButton?: boolean\n  showSettingsButton?: boolean\n  className?: string\n}\n\nconst Layout: React.FunctionComponent<LayoutProps> = ({\n  title,\n  actions,\n  showBackButton,\n  showSettingsButton,\n  className,\n  children,\n}) => {\n  const classes = useStyles()\n  return (\n    <Box className={[classes.root, className].join(' ')}>\n      <AppBar elevation={0} position=\"sticky\" className={classes.appBar}>\n        <Toolbar variant=\"dense\" className={classes.header}>\n          <IconButton\n            disabled={window.location.pathname === '/' ? true : undefined}\n            edge=\"start\"\n            aria-label=\"back\"\n            onClick={() => window.history.back()}\n            className={[\n              classes.backButton,\n              showSettingsButton ? '' : classes.hide,\n            ].join(' ')}\n          >\n            <ChevronLeftIcon />\n          </IconButton>\n\n          {title && (\n            <Typography variant=\"h6\" className={classes.title}>\n              {title}\n            </Typography>\n          )}\n\n          <IconButton\n            disabled\n            edge=\"end\"\n            component={Link}\n            to={`/settings`}\n            aria-label=\"settings\"\n            className={[\n              classes.settingsButton,\n              showBackButton ? '' : classes.hide,\n            ].join(' ')}\n          >\n            {<SettingsIcon fontSize=\"small\" />}\n          </IconButton>\n        </Toolbar>\n\n        {actions}\n      </AppBar>\n\n      <Box className={classes.children}>{children}</Box>\n    </Box>\n  )\n}\n\nLayout.defaultProps = {\n  title: 'Exuo',\n  showBackButton: false,\n  showSettingsButton: false,\n}\n\nexport default Layout\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport { Box, Button, Typography, CircularProgress } from '@material-ui/core'\nimport { useNavigate } from '@reach/router'\nimport { IAnyStateTreeNode } from 'mobx-state-tree'\n\nimport { useGraph } from 'graph'\nimport Layout from './Layout'\n\ninterface PeerConnectorProps {\n  id?: string\n}\n\nconst PeerConnector: React.FunctionComponent<PeerConnectorProps> = ({ id }) => {\n  const [peerError, setPeerError] = React.useState<null | Error>(null)\n  const [hasAccepted, setHasAccepted] = React.useState(false)\n  const navigate = useNavigate()\n\n  return useGraph(graph => {\n    const handleAccept: React.EventHandler<React.SyntheticEvent> = () => {\n      setHasAccepted(true)\n      graph\n        .seekPeerConnection(id)\n        .then((instance: IAnyStateTreeNode) => {\n          navigate(`/node/${instance.id}`)\n        })\n        .catch((error: Error) => {\n          setPeerError(error)\n        })\n    }\n\n    return (\n      <Layout>\n        <Typography align=\"center\">\n          Someone wants to share content with you.\n          <br />\n          Do not accept if you do not trust them.\n        </Typography>\n        <Box mt={1} textAlign=\"center\">\n          {peerError ? (\n            <Typography color=\"error\">{peerError}</Typography>\n          ) : (\n            <Button\n              disabled={hasAccepted}\n              onClick={handleAccept}\n              color=\"primary\"\n            >\n              {hasAccepted ? <CircularProgress size={24} /> : 'Accept'}\n            </Button>\n          )}\n        </Box>\n      </Layout>\n    )\n  })\n}\n\nexport default PeerConnector\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport {\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemSecondaryAction,\n  ListItemText,\n  ListSubheader,\n  Switch,\n} from '@material-ui/core'\nimport PlaylistAddCheckIcon from '@material-ui/icons/PlaylistAddCheck'\nimport BorderAllIcon from '@material-ui/icons/BorderAll'\nimport AccountTreeIcon from '@material-ui/icons/AccountTree'\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles'\n\nimport { useGraph } from 'graph'\nimport Layout from './Layout'\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    root: {},\n  }),\n)\n\nconst Settings: React.FunctionComponent = () => {\n  const classes = useStyles()\n\n  return useGraph(graph => (\n    <Layout>\n      <List\n        subheader={<ListSubheader>Global</ListSubheader>}\n        className={classes.root}\n      >\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n      <List\n        subheader={<ListSubheader>Lists</ListSubheader>}\n        className={classes.root}\n      >\n        <ListItem>\n          <ListItemIcon>\n            <PlaylistAddCheckIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-checkboxes\"\n            primary=\"Checkboxes\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              checked={graph.listCheckboxSetting ?? false}\n              onChange={() => graph.toggleListCheckboxSetting()}\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-checkboxes',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <BorderAllIcon />\n          </ListItemIcon>\n          <ListItemText id=\"switch-list-label-dividers\" primary=\"Dividers\" />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{\n                'aria-labelledby': 'switch-list-label-list-dividers',\n              }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n        <ListItem>\n          <ListItemIcon>\n            <AccountTreeIcon />\n          </ListItemIcon>\n          <ListItemText\n            id=\"switch-list-label-bluetooth\"\n            primary=\"Show Extra Edge Types\"\n          />\n          <ListItemSecondaryAction>\n            <Switch\n              disabled\n              edge=\"end\"\n              inputProps={{ 'aria-labelledby': 'switch-list-label-bluetooth' }}\n            />\n          </ListItemSecondaryAction>\n        </ListItem>\n      </List>\n    </Layout>\n  ))\n}\n\nexport default Settings\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport * as reach from '@reach/router'\n\nimport { useGraph } from 'graph'\nimport InstanceViewer from './components/InstanceViewer'\nimport PeerConnector from './components/PeerConnector'\nimport Settings from './components/Settings'\n\nexport type RouteProps<T = unknown> = {\n  component: React.FunctionComponent<T>\n} & reach.RouteComponentProps\n\nexport const Route: React.FunctionComponent<RouteProps> = ({\n  component: Component,\n  ...props\n}) => <Component {...props} />\n\nexport const Router: React.FunctionComponent = () =>\n  useGraph(graph =>\n    graph.rootNode ? (\n      <reach.Router>\n        <Route path=\"/\" component={InstanceViewer} />\n        <Route path=\":type/:id\" component={InstanceViewer} />\n        <Route path=\"peer/:id\" component={PeerConnector} />\n        <Route path=\"settings\" component={Settings} />\n      </reach.Router>\n    ) : null,\n  )\n","/*\n * Copyright © 2020 Ty Dira <ty@dira.dev>\n *\n * This file is part of Exuo.\n\n * Exuo is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n\n * Exuo is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n\n * You should have received a copy of the GNU Affero General Public License\n * along with Exuo.  If not, see <https://www.gnu.org/licenses/>.\n */\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport 'mobx-react-lite/batchingForReactDom'\nimport * as serviceWorker from './serviceWorker'\n\nimport { GraphProvider } from './graph'\nimport { ThemeProvider } from './theme'\nimport { Router } from './router'\n\nReactDOM.render(\n  <React.StrictMode>\n    <GraphProvider>\n      <ThemeProvider>\n        <Router />\n      </ThemeProvider>\n    </GraphProvider>\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n\nserviceWorker.register()\n","function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 94;"],"sourceRoot":""}